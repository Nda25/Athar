<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ù…Ø³Ù€Ù€Ø§Ø± â€” Ø¬Ø¯ÙˆÙ„ÙŠ Ù„Ù„ØªØ±Ù…</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;800&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="style.css" />
<meta name="color-scheme" content="dark light">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js" defer></script>
<style>
  /* Ù„Ù…Ø³Ø§Øª ÙˆØ§Ø¬Ù‡Ø© ÙÙˆÙ‚ style.css */
  .field{ margin:10px 0 }
  .field label{ display:block; font-weight:700; margin:6px 0 }
  .field input,.field select{
    width:100%; padding:12px 14px; border-radius:12px;
    border:1px solid rgba(59,130,246,.35); background:#fff; color:#0f172a;
  }
  .dark .field input,.dark .field select{ background:#0f172a; color:#f1f5f9; border-color:#3b82f6 }

  .row{ display:grid; gap:12px }
  .row.cols-2{ grid-template-columns:1fr 1fr }
  .row.cols-3{ grid-template-columns:1fr 1fr 1fr }
  @media(max-width:800px){ .row.cols-2,.row.cols-3{ grid-template-columns:1fr } }

  .btn{ padding:12px 18px; font-weight:800; border-radius:12px }
  .btn.primary{ padding:13px 22px }
  .actions-row{ display:flex; gap:12px; flex-wrap:wrap; margin-top:12px }

  .edit-cell{ display:grid; gap:8px; grid-template-columns:120px 1fr 1fr }
  .edit-cell .tag{ font-weight:800; text-align:center; padding:6px 10px; border-radius:999px;
    border:1px solid rgba(59,130,246,.25); background:var(--card) }

  .wrap{ background:var(--card); border:1px solid rgba(59,130,246,.18); border-radius:16px; padding:14px }

  /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†Ø§ØªØ¬ */
  .tt-wrap{
    overflow:auto; border:1px solid rgba(59,130,246,.22);
    border-radius:16px; background:
      radial-gradient(18px 18px at 6% 14%, #e0f2fe33 10%, transparent 60%),
      radial-gradient(20px 20px at 96% 88%, #ede9fe33 10%, transparent 60%),
      var(--card);
    box-shadow:var(--shadow);
  }
  table.timetable{ width:100%; border-collapse:separate; border-spacing:0; min-width:900px }
  .timetable th,.timetable td{
    border-bottom:1px solid rgba(59,130,246,.14);
    border-inline-end:1px solid rgba(59,130,246,.10);
    padding:12px; text-align:center; vertical-align:middle;
  }
  .timetable thead th{
    position:sticky; top:0; background:linear-gradient(180deg,#ffffffcc,#ffffffaa);
    backdrop-filter:blur(4px); font-weight:800; color:var(--sea-700);
  }
  .dark .timetable thead th{ background:linear-gradient(180deg,#0f172acc,#0f172aaa); color:#93c5fd }

  .sub-chip{
    display:inline-flex; gap:8px; align-items:center; justify-content:center;
    padding:8px 12px; border-radius:999px; font-weight:800; border:1px solid rgba(0,0,0,.06);
    box-shadow:0 6px 18px rgba(0,0,0,.10); white-space:nowrap;
  }
  .meta{ display:block; font-size:12px; opacity:.85; margin-top:4px }

  .legend{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px }
  .legend .chip{ display:inline-flex; gap:8px; align-items:center; padding:6px 10px; border-radius:999px;
    border:1px solid rgba(59,130,246,.22); background:var(--card) }
  .legend .dot{ width:12px; height:12px; border-radius:50% }

  .quote{ margin-top:14px; text-align:center; color:var(--muted); font-weight:700; border-top:1px dashed rgba(59,130,246,.25); padding-top:10px }

  @media print{
    .topbar,.inputs-card,.actions-row,.toast{ display:none !important }
    header{ padding-bottom:0 }
    .tt-wrap{ box-shadow:none; border:none }
    .quote{ border:none; padding-top:0 }
  }
</style>
</head>
<body>
  <div class="backdrop"></div>
  <div class="pattern"></div>

  <div class="topbar">
    <div class="left-actions"><a class="btn" href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></div>
    <div class="actions"><button class="btn" id="themeToggle">ğŸŒ“</button></div>
    <div class="user"><a class="btn" href="programs.html">Ù…Ø³Ø§Ø­Ø© Ø¥Ø¨Ø¯Ø§Ø¹ÙŠ</a></div>
  </div>

  <header>
    <div class="hero">
      <h1 class="logo">Ù…Ø³Ù€Ù€Ø§Ø±</h1>
      <div class="tag"><span class="dot"></span>Ø±ØªÙ‘Ø¨ Ø­ØµØµÙƒâ€¦ ÙˆØ¯Ø¹ Ø§Ù„ØªØ®Ø·ÙŠØ· ÙŠÙ…Ø¶ÙŠ ÙÙŠ Ù…Ø³Ø§Ø±Ù‡.</div>
    </div>
  </header>

  <main>
    <div class="container">
      <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙˆÙÙ‚ ØªØ³Ù„Ø³Ù„ Ø§Ù„ÙŠÙˆÙ… â†’ Ø§Ø®ØªÙŠØ§Ø±Ø§Øª -->
      <section class="card inputs-card" id="inputsCard">
        <h2 class="title" style="margin-top:0">Ù…Ø¯Ø®Ù„Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„</h2>

        <div class="row cols-3">
          <div class="field">
            <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ ÙÙŠ Ø§Ù„ÙŠÙˆÙ…</label>
            <select id="dayCount">
              <option value="7" selected>7</option>
              <option value="8">8</option>
              <option value="6">6</option>
              <option value="5">5</option>
            </select>
          </div>

          <div class="field">
            <label>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙŠÙˆÙ…</label>
            <select id="daySelect">
              <option>Ø§Ù„Ø£Ø­Ø¯</option><option>Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†</option><option>Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option><option>Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option><option>Ø§Ù„Ø®Ù…ÙŠØ³</option>
            </select>
          </div>

          <div class="field">
            <label>Ø¹Ø¯Ø¯ Ø­ØµØµ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</label>
            <select id="slotsCount">
              <option value="0">Ù„Ø§ ÙŠÙˆØ¬Ø¯</option>
              <option value="1">Ø­ØµØ© ÙˆØ§Ø­Ø¯Ø©</option>
              <option value="2">Ø­ØµØªØ§Ù†</option>
              <option value="3">3 Ø­ØµØµ</option>
              <option value="4">4 Ø­ØµØµ</option>
              <option value="5">5 Ø­ØµØµ</option>
              <option value="6">6 Ø­ØµØµ</option>
              <option value="7">7 Ø­ØµØµ</option>
              <option value="8">8 Ø­ØµØµ</option>
            </select>
          </div>
        </div>

        <div id="dayEditor" class="wrap" style="margin-top:10px; display:none"></div>

        <div class="actions-row">
          <button class="btn" id="saveDay">Ø­ÙØ¸ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</button>
          <button class="btn" id="nextDay">Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ â†¦</button>
          <button class="btn primary" id="build" title="ÙŠÙ†Ø´Ø¦ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ">ÙˆÙ„Ù‘Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ âœ¨</button>
        </div>
      </section>

      <!-- Ø§Ù„Ù†Ø§ØªØ¬ -->
      <section class="card" id="outCard" style="display:none">
        <h2 class="title">Ø¬Ø¯ÙˆÙ„ Ù…Ø³Ù€Ù€Ø§Ø±ÙŠ</h2>
        <div class="tt-wrap" id="ttWrap">
          <table class="timetable" id="tt"></table>
        </div>
        <div class="legend" id="legend"></div>

        <div class="actions-row" id="exportRow" style="display:none">
          <button class="btn primary" id="printBtn">Ø·Ø¨Ø§Ø¹Ø©</button>
          <button class="btn" id="pngBtn">Ø­ÙØ¸ ÙƒØµÙˆØ±Ø© PNG</button>
          <button class="btn" id="editBtn">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª</button>
        </div>

        <div class="quote" id="quote"></div>
      </section>
    </div>
  </main>

  <footer>
    <p class="foot-line">Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø´Ø±Ø§Ø±Ø© ØµØºÙŠØ±Ø©â€¦ ØªÙØ¶ÙŠØ¡ Ø¹Ù‚ÙˆÙ„Ù‹Ø§ ÙƒØ¨ÙŠØ±Ø©.</p>
    <p class="foot-name">Ù†Ø¯Ù‰ Ø§Ù„Ù…Ø¬ÙŠØ±Ø´</p>
  </footer>

  <div class="toast" id="toast"></div>
  <script src="app.js"></script>
  <script>
  // ØµØºØ§Ø± Ø£Ø¯ÙˆØ§Øª
  const $  = (s,r=document)=>r.querySelector(s);
  const $$ = (s,r=document)=>Array.from(r.querySelectorAll(s));
  function toast(m){ let t=$('.toast'); if(!t){t=document.createElement('div');t.className='toast';document.body.appendChild(t);} t.textContent=m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1400); }

  // ØªÙƒÙˆÙŠÙ†
  const DAYS = ['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³'];
  const COLORS = [
    ['#e0f2fe','#0369a1'],['#dbeafe','#1d4ed8'],['#e9d5ff','#7e22ce'],
    ['#fee2e2','#b91c1c'],['#dcfce7','#166534'],['#fef9c3','#a16207'],
    ['#ffe4e6','#be123c'],['#ede9fe','#6d28d9']
  ];
  const QUOTES = [
    'Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… Ø³ÙŠÙ…Ø¶ÙŠ ÙƒÙ…Ø§ Ù…Ø¶Ù‰ Ø§Ù„Ø£Ù…Ø³â€¦ ÙˆÙ„Ù† ÙŠØ¨Ù‚Ù‰ Ù…Ù†Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ø£Ø«Ø±. ğŸŒ¿',
    'Ø®Ø·Ø© Ø¨Ø³ÙŠØ·Ø© Ø§Ù„ÙŠÙˆÙ…â€¦ Ø£Ø«Ø± Ø¹Ù…ÙŠÙ‚ ØºØ¯Ù‹Ø§.',
    'ÙƒÙ„ Ø­ØµØ© ÙØ±ØµØ© Ù„ØµÙ†Ø§Ø¹Ø© Ø£Ø«Ø± Ø¬Ø¯ÙŠØ¯.',
    'Ø§Ù„Ù†Ø¸Ø§Ù… Ø³ÙÙ„Ù‘Ù… Ù„Ù„ÙˆØµÙˆÙ„ØŒ Ù„Ø§ Ù‚ÙŠØ¯.',
  ];
  const KEY='athar:masar:v2';

  // Ø­Ø§Ù„Ø© Ø¯Ø§Ø®Ù„ÙŠØ©: Ù„ÙƒÙ„ ÙŠÙˆÙ… Ù…ØµÙÙˆÙØ© Ù…Ù† Ø§Ù„Ø¹Ù†Ø§ØµØ± {p,sub,cls}
  let state = load() || { periods:7, days: Object.fromEntries(DAYS.map(d=>[d,[]])) };

  // Ø¹Ù†Ø§ØµØ±
  const dayCount  = $('#dayCount');
  const daySelect = $('#daySelect');
  const slotsCount= $('#slotsCount');
  const dayEditor = $('#dayEditor');
  const buildBtn  = $('#build');
  const saveDayBtn= $('#saveDay');
  const nextDayBtn= $('#nextDay');

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
  dayCount.value = state.periods;
  renderDayEditor();

  dayCount.addEventListener('change', ()=>{
    state.periods = +dayCount.value || 7;
    save(); renderDayEditor();
  });

  daySelect.addEventListener('change', ()=> renderDayEditor());
  slotsCount.addEventListener('change', ()=> renderDayEditor());

  saveDayBtn.addEventListener('click', ()=>{
    const d = daySelect.value;
    const items = readEditor();
    if(!validate(items)){ toast('ØªØ­Ù‚Ù‘Ù‚ÙŠ Ù…Ù† Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø­ØµØµ ÙˆØ¹Ø¯Ù… Ø§Ù„ØªÙƒØ±Ø§Ø±.'); return; }
    state.days[d] = items;
    save(); toast(`Ø­ÙÙØ¸ ${d}.`);
  });

  nextDayBtn.addEventListener('click', ()=>{
    const idx = DAYS.indexOf(daySelect.value);
    daySelect.value = DAYS[(idx+1)%DAYS.length];
    renderDayEditor();
  });

  buildBtn.addEventListener('click', ()=>{
    // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    const allEmpty = DAYS.every(d => (state.days[d]||[]).length===0);
    if(allEmpty){ toast('Ø£Ø¯Ø®Ù„ÙŠ Ø­ØµØµ ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.'); return; }
    paintTable();
    $('#outCard').style.display = '';
    $('#exportRow').style.display = 'flex';
    window.scrollTo({ top: $('#outCard').offsetTop-10, behavior:'smooth' });
  });

  // Ø¨Ù†Ø§Ø¡ Ù…Ø­Ø±Ø± Ø§Ù„ÙŠÙˆÙ…
  function renderDayEditor(){
    const d = daySelect.value;
    const count = +slotsCount.value || 0;
    const maxP = +dayCount.value || 7;

    // Ø­Ù…Ù„ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…
    const prev = state.days[d] || [];
    dayEditor.innerHTML = '';
    dayEditor.style.display = count>0 ? '' : 'none';

    for(let i=0;i<count;i++){
      const row = document.createElement('div');
      row.className='edit-cell';
      const cur = prev[i] || {};
      row.innerHTML = `
        <div class="tag">Ø§Ù„Ø­ØµØ©</div>
        <select data-k="p">
          ${Array.from({length:maxP},(_,x)=>`<option value="${x+1}" ${cur.p==(x+1)?'selected':''}>${x+1}</option>`).join('')}
        </select>
        <input data-k="sub" placeholder="Ø§Ù„Ù…Ø§Ø¯Ø©" value="${cur.sub||''}">
        <input data-k="cls" placeholder="Ø§Ù„ÙØµÙ„/Ø§Ù„Ø´Ø¹Ø¨Ø©" value="${cur.cls||''}">
      `;
      dayEditor.appendChild(row);
    }
  }

  function readEditor(){
    return $$('.edit-cell', dayEditor).map(el=>{
      return {
        p: +$('select[data-k="p"]',el).value,
        sub: $('input[data-k="sub"]',el).value.trim(),
        cls: $('input[data-k="cls"]',el).value.trim()
      };
    }).filter(x=> x.sub || x.cls);
  }

  function validate(items){
    // Ù„Ø§ ØªÙƒØ±Ø§Ø± Ù„Ù†ÙØ³ Ø±Ù‚Ù… Ø§Ù„Ø­ØµØ©
    const ps = items.map(x=>x.p);
    return (new Set(ps)).size === ps.length;
  }

  function save(){ localStorage.setItem(KEY, JSON.stringify(state)); }
  function load(){ try{ return JSON.parse(localStorage.getItem(KEY)||'null'); }catch(_){ return null; } }

  // Ø£Ù„ÙˆØ§Ù† Ø¨Ø­Ø³Ø¨ Ø§Ù„Ù…Ø§Ø¯Ø©
  function colorFor(s){
    s=(s||'').trim(); let h=0; for(let i=0;i<s.length;i++) h=(h*31+s.charCodeAt(i))>>>0;
    const [bg,fg]=COLORS[h%COLORS.length]; return {bg,fg};
  }

  // Ø±Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„
  function paintTable(){
    const tt = $('#tt'); const legend = $('#legend');
    const periods = +state.periods || 7;

    tt.innerHTML='';
    const thead = document.createElement('thead');
    thead.innerHTML = `<tr><th>Ø§Ù„Ø­ØµØ©</th>${DAYS.map(d=>`<th>${d}</th>`).join('')}</tr>`;
    tt.appendChild(thead);

    const tbody = document.createElement('tbody');

    for(let p=1;p<=periods;p++){
      const tr = document.createElement('tr');
      tr.appendChild(cellTh('Ø§Ù„Ø­ØµØ© '+p));
      DAYS.forEach(d=>{
        const it = (state.days[d]||[]).find(x=>x.p===p);
        const td = document.createElement('td');
        if(it){
          const {bg,fg} = colorFor(it.sub || d);
          td.innerHTML = `
            <div class="sub-chip" style="background:${bg}; color:${fg}">${it.sub||'â€”'}</div>
            ${it.cls? `<span class="meta">${it.cls}</span>`:''}
          `;
        }
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    }
    tt.appendChild(tbody);

    // ÙˆØ³ÙŠÙ„Ø© Ø¥ÙŠØ¶Ø§Ø­
    legend.innerHTML = '';
    const subs = new Set();
    DAYS.forEach(d => (state.days[d]||[]).forEach(x=> subs.add(x.sub)));
    [...subs].filter(Boolean).slice(0,15).forEach(s=>{
      const {bg,fg}=colorFor(s);
      const chip = document.createElement('div'); chip.className='chip';
      chip.innerHTML = `<span class="dot" style="background:${bg}"></span><span style="color:${fg};font-weight:800">${s}</span>`;
      legend.appendChild(chip);
    });

    $('#quote').textContent = QUOTES[Math.floor(Math.random()*QUOTES.length)];
  }
  function cellTh(t){ const th=document.createElement('th'); th.textContent=t; return th; }

  // ØªØµØ¯ÙŠØ±/Ø·Ø¨Ø§Ø¹Ø©
  $('#printBtn').addEventListener('click', ()=>window.print());
  $('#pngBtn').addEventListener('click', async ()=>{
    const wrap = $('#ttWrap'); if(!window.html2canvas){ toast('Ù„Ù… ØªØ­Ù…Ù„ Ù…ÙƒØªØ¨Ø© Ø§Ù„ØµÙˆØ±Ø©'); return; }
    const canvas = await html2canvas(wrap, { scale:2, useCORS:true, backgroundColor:null });
    const a=document.createElement('a'); a.href=canvas.toDataURL('image/png'); a.download='masar.png'; a.click();
  });
  $('#editBtn').addEventListener('click', ()=>{
    window.scrollTo({ top: $('#inputsCard').offsetTop-10, behavior:'smooth' });
  });
  </script>
</body>
</html>
