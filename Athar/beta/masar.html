<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù…Ø³Ù€Ù€Ø§Ø± â€” Ø¬Ø¯ÙˆÙ„ÙŠ Ù„Ù„ØªØ±Ù…</title>

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <meta name="color-scheme" content="dark light">

  <!-- Ø­ÙØ¸ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙƒØµÙˆØ±Ø© -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js" defer></script>

  <style>
    /* Ø£Ø²Ø±Ø§Ø± Ø£Ø¹Ø±Ø¶ Ø´ÙˆÙŠ */
    .btn{ min-width:170px }

    /* Ø­Ù‚ÙˆÙ„ Ø£ÙƒØ¨Ø± ÙˆÙ…Ø±ÙŠØ­Ø© */
    .wizard{ display:grid; gap:16px }
    .field{ margin:10px 0 }
    .field label{ display:block; font-weight:700; margin:6px 0 }
    .field input,.field select{
      width:100%; padding:14px 12px; border-radius:14px; font-size:16px;
      border:1px solid rgba(59,130,246,.35); background:#fff; color:#0f172a;
    }
    .dark .field input,.dark .field select{
      background:#0f172a; color:#f1f5f9; border-color:#3b82f6;
    }

    /* Ø£Ø²Ø±Ø§Ø± Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø­ØµØµ */
    .slots{ display:flex; flex-wrap:wrap; gap:8px }
    .slot{
      border:1px solid rgba(59,130,246,.28); background:var(--card);
      padding:10px 14px; border-radius:999px; cursor:pointer; user-select:none;
      font-weight:700; font-size:15px;
    }
    .slot.active{
      font-weight:800; border-color:#3b82f6; background:var(--sea-100);
    }
    .dark .slot.active{ background:#0f172a; border-color:#60a5fa }

    /* Ø¥Ø¯Ø®Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø§Ø¯Ø©/Ø§Ù„ÙØµÙ„ */
    .inputs{ display:grid; gap:10px }
    .row{
      display:grid; grid-template-columns:120px 1fr 1fr; gap:10px; align-items:center;
    }
    .row input{ padding:12px 10px; border-radius:12px; font-size:15px;
      border:1px solid rgba(59,130,246,.35);
    }
    .pill{
      font-weight:800; text-align:center; padding:10px 12px; border-radius:999px;
      border:1px solid rgba(59,130,246,.25); background:var(--card)
    }

    /* Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†Ø§ØªØ¬ */
    .tt-wrap{ overflow:auto; border:1px solid rgba(59,130,246,.22);
      border-radius:16px; background:var(--card); box-shadow:var(--shadow) }
    table.timetable{ width:100%; border-collapse:separate; border-spacing:0; min-width:720px }
    .timetable th,.timetable td{
      border-bottom:1px solid rgba(59,130,246,.18);
      border-inline-end:1px solid rgba(59,130,246,.12);
      padding:12px; text-align:center; vertical-align:middle
    }
    .timetable th{
      position:sticky; top:0; background:linear-gradient(180deg,#ffffffcc,#ffffffaa);
      backdrop-filter:blur(4px); font-weight:800; color:var(--sea-700)
    }
    .dark .timetable th{ background:linear-gradient(180deg,#0f172acc,#0f172aaa); color:#93c5fd }
    .timetable td .sub{
      display:inline-flex; gap:8px; align-items:center; justify-content:center;
      padding:8px 10px; border-radius:999px; font-weight:800; border:1px solid rgba(0,0,0,.06);
      box-shadow:0 6px 18px rgba(0,0,0,.12); white-space:nowrap
    }
    .timetable td .cls{ display:block; font-size:12px; opacity:.85; margin-top:4px }

    .legend{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px }
    .legend .chip{ display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px;
      border:1px solid rgba(59,130,246,.22); background:var(--card) }
    .legend .dot{ width:12px; height:12px; border-radius:50% }

    .quote{ margin-top:14px; text-align:center; color:var(--muted); font-weight:700;
      border-top:1px dashed rgba(59,130,246,.25); padding-top:10px }

    /* Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© */
    @media print{
      .topbar,.wizard-card,.toast{ display:none!important }
      header{ padding-bottom:0 }
      .tt-wrap{ box-shadow:none; border:none }
      .quote{ border:none; padding-top:0 }
    }
  </style>
</head>
<body>
  <div class="backdrop"></div>
  <div class="pattern"></div>

  <!-- Ø§Ù„Ø´Ø±ÙŠØ· -->
  <div class="topbar">
    <div class="left-actions"><a class="btn" href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></div>
    <div class="actions"><button class="btn" id="themeToggle">ğŸŒ“</button></div>
    <div class="user"><a class="btn" href="programs.html">Ù…Ø³Ø§Ø­Ø© Ø¥Ø¨Ø¯Ø§Ø¹ÙŠ</a></div>
  </div>

  <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
  <header>
    <div class="hero">
      <h1 class="logo">Ù…Ø³Ù€Ù€Ø§Ø±</h1>
      <div class="tag"><span class="dot"></span>Ø±ØªÙ‘Ø¨ Ø­ØµØµÙƒâ€¦ Ø­ØªÙ‰ ÙŠØªØ¶Ø­ Ø§Ù„Ù…Ø³Ù€Ø§Ø±.</div>
    </div>
  </header>

  <main>
    <div class="container">
      <!-- Ø§Ù„Ø³Ø§Ø­Ø± (Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©) -->
      <section class="card wizard-card">
        <h2 class="title" style="margin-top:0">Ù…Ø¯Ø®Ù„Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„</h2>

        <div class="wizard">
          <div class="field">
            <label>Ø§Ø®ØªØ± Ø§Ù„ÙŠÙˆÙ…</label>
            <select id="daySel">
              <option value="Ø§Ù„Ø£Ø­Ø¯">Ø§Ù„Ø£Ø­Ø¯</option>
              <option value="Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†">Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†</option>
              <option value="Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option>
              <option value="Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option>
              <option value="Ø§Ù„Ø®Ù…ÙŠØ³">Ø§Ù„Ø®Ù…ÙŠØ³</option>
            </select>
          </div>

          <div class="field">
            <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ø«Ø§Ø¨Øª)</label>
            <select id="totalSlots">
              <option>5</option>
              <option>6</option>
              <option>7</option>
              <option selected>8</option>
            </select>
            <div class="muted-mini">ÙŠÙØ³ØªØ®Ø¯Ù… Ù„Ø±Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (Ù…Ø«Ù„Ù‹Ø§ 8 Ø£Ø¹Ù…Ø¯Ø© Ù„Ù„Ø­ØµØµ).</div>
          </div>

          <div class="field">
            <label>Ø¹Ø¯Ø¯ Ø­ØµØµ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</label>
            <select id="countToday">
              <option value="0">Ù„Ø§ ÙŠÙˆØ¬Ø¯</option>
              <option value="1">Ø­ØµØ©</option>
              <option value="2">Ø­ØµØªØ§Ù†</option>
              <option value="3">3 Ø­ØµØµ</option>
              <option value="4">4 Ø­ØµØµ</option>
              <option value="5">5 Ø­ØµØµ</option>
              <option value="6">6 Ø­ØµØµ</option>
              <option value="7">7 Ø­ØµØµ</option>
              <option value="8">8 Ø­ØµØµ</option>
            </select>
          </div>

          <div class="field">
            <label>Ø§Ø®ØªØ§Ø±ÙŠ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø­ØµØµ Ù„Ù„ÙŠÙˆÙ…</label>
            <div id="slots" class="slots"></div>
            <div class="muted-mini">Ø§Ø®ØªØ§Ø±ÙŠ Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø­ØµØµ Ù…Ù† 1 Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ.</div>
          </div>

          <div id="inputs" class="inputs"></div>

          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:6px">
            <button class="btn" id="saveDay">Ø­ÙØ¸ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</button>
            <button class="btn" id="nextDay">Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ â†’</button>
            <button class="btn primary" id="build" style="display:none">ÙˆÙ„Ù‘Ø¯ Ù„ÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ âœ¨</button>
          </div>
        </div>
      </section>

      <!-- Ø§Ù„Ù†Ø§ØªØ¬ -->
      <section class="card" id="outCard" style="display:none">
        <h2 class="title">Ø¬Ø¯ÙˆÙ„ Ù…Ø³Ù€Ù€Ø§Ø±ÙŠ</h2>
        <div class="tt-wrap" id="ttWrap">
          <table class="timetable" id="tt"></table>
        </div>
        <div class="legend" id="legend"></div>

        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
          <button class="btn" id="printBtn">Ø·Ø¨Ø§Ø¹Ø©</button>
          <button class="btn" id="pngBtn">Ø­ÙØ¸ ÙƒØµÙˆØ±Ø© PNG</button>
          <button class="btn" id="editBtn">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª</button>
        </div>

        <div class="quote" id="quote"></div>
      </section>
    </div>
  </main>

  <footer>
    <p class="foot-line">Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø´Ø±Ø§Ø±Ø© ØµØºÙŠØ±Ø©â€¦ ØªÙØ¶ÙŠØ¡ Ø¹Ù‚ÙˆÙ„Ù‹Ø§ ÙƒØ¨ÙŠØ±Ø©.</p>
    <p class="foot-name">Ù†Ø¯Ù‰ Ø§Ù„Ù…Ø¬ÙŠØ±Ø´</p>
  </footer>

  <div class="toast" id="toast"></div>

  <!-- Ù„Ùˆ Ø¹Ù†Ø¯Ùƒ app.js (Ø§Ù„Ø«ÙŠÙ…/Ø§Ù„ØªÙˆØ³Øªâ€¦) Ø®Ù„ÙŠÙ‡ Ù‡Ù†Ø§ -->
  <script src="app.js"></script>

  <script>
    // Ø£Ø¯ÙˆØ§Øª ØµØºÙŠØ±Ø©
    const $=(s,r=document)=>r.querySelector(s);
    const $$=(s,r=document)=>Array.from(r.querySelectorAll(s));
    function toast(m){ let t=$('.toast'); if(!t){t=document.createElement('div');t.className='toast';document.body.appendChild(t);} t.textContent=m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1500); }

    // Ø«Ø§Ø¨Øª
    const DAYS=['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³'];
    const KEY='athar:masar2';

    // Ø­Ø§Ù„Ø©
    let state = load() || { totalSlots:8, data:{} }; // data[day][slot]={sub,cls}

    // Ø¹Ù†Ø§ØµØ±
    const daySel=$('#daySel');
    const totalSel=$('#totalSlots');
    const countSel=$('#countToday');
    const slotsWrap=$('#slots');
    const inputsWrap=$('#inputs');
    const buildBtn=$('#build');
    const nextBtn=$('#nextDay');

    // Ø£Ù„ÙˆØ§Ù† Ù„Ù„Ù…ÙˆØ§Ø¯
    const PALETTE=[
      ['#e0f2fe','#0284c7'],['#dbeafe','#1d4ed8'],['#e9d5ff','#7e22ce'],
      ['#fee2e2','#b91c1c'],['#dcfce7','#166534'],['#fef9c3','#a16207'],
      ['#ffe4e6','#be123c'],['#ede9fe','#6d28d9'],['#fce7f3','#be185d']
    ];
    function colorFor(s){
      s=(s||'').trim();let h=0;for(let i=0;i<s.length;i++)h=(h*31+s.charCodeAt(i))>>>0;
      const [bg,fg]=PALETTE[h%PALETTE.length];return{bg,fg};
    }

    const QUOTES=[
      'Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… Ø³ÙŠÙ…Ø¶ÙŠ ÙƒÙ…Ø§ Ù…Ø¶Ù‰ Ø§Ù„Ø£Ù…Ø³â€¦ ÙˆÙ„Ù† ÙŠØ¨Ù‚Ù‰ Ù…Ù†Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ø£Ø«Ø±. ğŸŒ¿',
      'Ø®Ø·Ø© Ø¨Ø³ÙŠØ·Ø© Ø§Ù„ÙŠÙˆÙ…â€¦ Ø£Ø«Ø± Ø¹Ù…ÙŠÙ‚ ØºØ¯Ù‹Ø§.',
      'ÙƒÙ„ Ø­ØµØ© ÙØ±ØµØ© Ù„ØµÙ†Ø§Ø¹Ø© Ø£Ø«Ø± Ø¬Ø¯ÙŠØ¯.'
    ];

    // ØªØ­Ù…ÙŠÙ„/Ø­ÙØ¸
    function load(){ try{return JSON.parse(localStorage.getItem(KEY)||'null');}catch(_){return null;} }
    function save(){ localStorage.setItem(KEY, JSON.stringify(state)); }

    // Ø±Ø³Ù… Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­ØµØµ
    function drawSlots(){
      slotsWrap.innerHTML='';
      const N=parseInt(totalSel.value,10)||8;
      const d=daySel.value;
      const dayData = state.data[d] || {};
      for(let p=1;p<=N;p++){
        const btn=document.createElement('div');
        btn.className='slot' + (dayData[p] ? ' active' : '');
        btn.textContent=p;
        btn.dataset.p=p;
        btn.addEventListener('click',()=>{
          toggleSlot(p);
          drawSlots();
          drawInputs();
          save();
          updateCountTodayFromState();
        });
        slotsWrap.appendChild(btn);
      }
    }

    // ØªÙØ¹ÙŠÙ„/ØªØ¹Ø·ÙŠÙ„ ÙØªØ­Ø©
    function toggleSlot(p){
      const d=daySel.value;
      if(!state.data[d]) state.data[d] = {};
      if(state.data[d][p]) delete state.data[d][p];
      else state.data[d][p]={sub:'',cls:''};
      limitByCountToday();
    }

    // Ø§Ø­ØªØ±Ø§Ù… Ø¹Ø¯Ø¯ Ø­ØµØµ Ø§Ù„ÙŠÙˆÙ…
    function limitByCountToday(){
      const d = daySel.value;
      const want = parseInt(countSel.value,10) || 0;
      if (want === 0) return;
      const ps = Object.keys(state.data[d]||{}).map(n=>+n).sort((a,b)=>a-b);
      if (ps.length > want) {
        ps.slice(want).forEach(p => delete state.data[d][p]);
      }
    }

    // Ø±Ø³Ù… Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø§Ø¯Ø©/Ø§Ù„ÙØµÙ„
    function drawInputs(){
      inputsWrap.innerHTML='';
      const d=daySel.value;
      const dayData=state.data[d]||{};
      const ps=Object.keys(dayData).map(n=>+n).sort((a,b)=>a-b);

      ps.forEach(p=>{
        const row=document.createElement('div');
        row.className='row';
        row.innerHTML=`
          <div class="pill">Ø§Ù„Ø­ØµØ© ${p}</div>
          <input type="text" placeholder="Ø§Ù„Ù…Ø§Ø¯Ø©" data-p="\${p}" data-k="sub">
          <input type="text" placeholder="Ø§Ù„ÙØµÙ„/Ø§Ù„Ø´Ø¹Ø¨Ø©" data-p="\${p}" data-k="cls">
        `;
        inputsWrap.appendChild(row);
        // ØªØ¹Ø¨Ø¦Ø© Ù…Ø­ÙÙˆØ¸
        row.querySelector('[data-k="sub"]').value = dayData[p]?.sub||'';
        row.querySelector('[data-k="cls"]').value = dayData[p]?.cls||'';
      });

      // Ø­ÙØ¸ Ù…Ø¨Ø§Ø´Ø±
      inputsWrap.oninput = (e)=>{
        const el=e.target; const p=+el.dataset.p; const k=el.dataset.k;
        if(!p||!k) return;
        if(!state.data[d]) state.data[d]={};
        state.data[d][p]=state.data[d][p]||{sub:'',cls:''};
        state.data[d][p][k]=el.value;
        save();
      };
    }

    // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø­ØµØµ Ø§Ù„ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ø­Ø§Ù„Ø©
    function updateCountTodayFromState() {
      const d = daySel.value;
      const dayData = state.data[d] || {};
      countSel.value = String(Object.keys(dayData).length || 0);
    }

    // Ø­ÙØ¸ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ
    $('#saveDay').addEventListener('click', ()=>{
      state.totalSlots = parseInt(totalSel.value,10)||8;
      limitByCountToday();
      save();
      drawSlots();
      drawInputs();
      toast('ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙŠÙˆÙ… âœ“');
      updateNextBuildButtons();
    });

    // Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ
    nextBtn.addEventListener('click', ()=>{
      const i = DAYS.indexOf(daySel.value);
      if(i < DAYS.length-1){
        daySel.value = DAYS[i+1];
        afterDayChange();
      }
      updateNextBuildButtons();
    });

    // ØªØºÙŠÙ‘Ø±Ø§Øª Ø§Ù„Ù‚ÙŠÙ…
    daySel.addEventListener('change', afterDayChange);
    totalSel.addEventListener('change', ()=>{
      state.totalSlots=parseInt(totalSel.value,10)||8; save(); drawSlots(); drawInputs();
    });
    countSel.addEventListener('change', ()=>{
      limitByCountToday(); save(); drawSlots(); drawInputs();
    });

    function afterDayChange(){
      totalSel.value = state.totalSlots || 8;
      updateCountTodayFromState();
      drawSlots();
      drawInputs();
      updateNextBuildButtons();
    }

    function updateNextBuildButtons(){
      if(daySel.value === 'Ø§Ù„Ø®Ù…ÙŠØ³'){
        nextBtn.style.display='none';
        buildBtn.style.display='';
      }else{
        nextBtn.style.display='';
        buildBtn.style.display='none';
      }
    }

    // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
    const tt=$('#tt'), legend=$('#legend'), outCard=$('#outCard');
    $('#build').addEventListener('click', ()=>{
      // Ø±Ø£Ø³ Ø§Ù„Ø¬Ø¯ÙˆÙ„
      const N=state.totalSlots||8;
      tt.innerHTML='';
      const thead=document.createElement('thead');
      const hr=document.createElement('tr');
      hr.innerHTML='<th>Ø§Ù„Ø­ØµØ©</th>'+DAYS.map(d=>`<th>${d}</th>`).join('');
      thead.appendChild(hr); tt.appendChild(thead);

      // Ø¬Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„
      const tbody=document.createElement('tbody');
      for(let p=1;p<=N;p++){
        const tr=document.createElement('tr');
        tr.innerHTML=`<th>Ø§Ù„Ø­ØµØ© ${p}</th>` + DAYS.map(d=>{
          const item=state.data?.[d]?.[p];
          if(!item || (!item.sub && !item.cls)) return '<td></td>';
          const {bg,fg}=colorFor(item.sub||d);
          return `<td>
            <div class="sub" style="background:${bg};color:${fg}">${item.sub||'â€”'}</div>
            ${item.cls? `<span class="cls">${item.cls}</span>`:''}
          </td>`;
        }).join('');
        tbody.appendChild(tr);
      }
      tt.appendChild(tbody);

      // ÙˆØ³ÙŠÙ„Ø© Ø§Ù„Ø¥ÙŠØ¶Ø§Ø­
      legend.innerHTML='';
      const subjects=new Set();
      DAYS.forEach(d=>{
        Object.values(state.data[d]||{}).forEach(v=>{ if(v?.sub) subjects.add(v.sub.trim()); });
      });
      Array.from(subjects).slice(0,15).forEach(s=>{
        const {bg,fg}=colorFor(s);
        const chip=document.createElement('div'); chip.className='chip';
        chip.innerHTML=`<span class="dot" style="background:${bg}"></span><span style="color:${fg};font-weight:800">${s}</span>`;
        legend.appendChild(chip);
      });

      // Ø¹Ø¨Ø§Ø±Ø© ØªØ­ÙÙŠØ²ÙŠØ©
      $('#quote').textContent = QUOTES[Math.floor(Math.random()*QUOTES.length)];
      outCard.style.display='';
      window.scrollTo({top:outCard.offsetTop-10,behavior:'smooth'});
      toast('ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„ âœ¨');
    });

    // Ø­ÙØ¸ ÙƒØµÙˆØ±Ø©
    $('#pngBtn').addEventListener('click', async ()=>{
      const wrap=$('#ttWrap');
      if(!window.html2canvas){ toast('Ù…ÙƒØªØ¨Ø© Ø§Ù„ØµÙˆØ±Ø© ØºÙŠØ± Ù…Ø­Ù…Ù‘Ù„Ø©.'); return; }
      const canvas=await html2canvas(wrap,{scale:2,useCORS:true,backgroundColor:null});
      const url=canvas.toDataURL('image/png'); const a=document.createElement('a');
      a.href=url; a.download='masar.png'; a.click();
    });

    // Ø·Ø¨Ø§Ø¹Ø©
    $('#printBtn').addEventListener('click', ()=>window.print());

    // ØªØ¹Ø¯ÙŠÙ„
    $('#editBtn').addEventListener('click', ()=>{
      document.querySelector('.wizard-card').scrollIntoView({behavior:'smooth',block:'start'});
    });

    // ØªÙ‡ÙŠØ¦Ø© Ø£ÙˆÙ„ÙŠØ©
    (function init(){
      const firstEmpty = DAYS.find(d=>!state.data[d] || Object.keys(state.data[d]).length===0) || 'Ø§Ù„Ø£Ø­Ø¯';
      daySel.value = firstEmpty;
      totalSel.value = state.totalSlots || 8;
      updateCountTodayFromState();
      drawSlots();
      drawInputs();
      updateNextBuildButtons();
    })();
  </script>

  <!-- Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø§Øª (Ø³ÙŠØ­ÙˆÙ„ ØºÙŠØ± Ø§Ù„Ù…ÙˆØ«Ù‘Ù‚ÙŠÙ† Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ø¨Ø­Ø³Ø¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ) -->
<script defer src="https://cdn.auth0.com/js/auth0-spa-js/2.1/auth0-spa-js.production.js"></script>
<script defer src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script defer src="assets/js/supabase-client.js"></script>
<script defer src="assets/js/require-auth.js"></script>
<script defer src="app.js"></script>
  script>
  document.getElementById('gen')?.addEventListener('click', async () => {
    await supaLogUsage('masar');
  });
</script>
</body>
</html>
