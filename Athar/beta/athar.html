<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ููููุทูููู </title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css" />
<meta name="color-scheme" content="dark light">
<style>
  /* ุฎุตูุตูุงุช ุจุณูุทุฉ ููุฐู ุงูุตูุญุฉ ููู style.css */

  .topbar .left-actions { display:flex; align-items:center; gap:10px; }
  .emoji-toggle { font-size:18px; line-height:1; }

  .controls.card { padding:20px; }
  .select-wrap{ position:relative }
  .select-wrap .sel{
    width:100%; background:#fff; color:#0f172a; border:1px solid rgba(59,130,246,.35);
    border-radius:12px; padding:.9rem 1rem; padding-inline-start:2.2rem; outline:none; appearance:none;
  }
  .dark .select-wrap .sel{ background:#0f172a; color:#f1f5f9; border-color:#3b82f6; }
  .select-wrap .sel-icon{
    position:absolute; inset-inline-start:.7rem; top:50%; transform:translateY(-50%);
    width:16px; height:16px; pointer-events:none; color:var(--sea-500);
  }
  .select-wrap .sel-icon svg{ width:16px; height:16px; display:block; fill:currentColor }
  .dark .select-wrap .sel-icon{ color:#93c5fd }

  .muted { color: var(--muted); font-size:.95rem; }

  /* ุงูุนูุงููู ุจุงูุฃุฒุฑู ูุซู ุทูุจู */
  #out h2, #out h3 { color: var(--sea-600); margin: 0 0 8px; }
  .dark #out h2, .dark #out h3 { color: #93c5fd; }

  #chips .chip{
    display:inline-block; padding:.28rem .65rem; border-radius:999px; background:var(--sea-100); color:#0c4a6e; font-size:.82rem; border:1px solid rgba(59,130,246,.25); margin-inline-start:6px;
  }
  .dark #chips .chip{ background:#0f172a; color:#e2e8f0; border-color:#3b82f6; }

  #regen{ display:none; }

  /* ุดุนุงุฑ ยซุฃุซููุฑยป ููุง ูู ุงูุฃุตู */
.brand-name{
  font-family:"Cairo", sans-serif; 
  font-weight:700; 
  letter-spacing:.5px;
  font-size:clamp(44px, 6.2vw, 84px); 
  margin:0;
  color:#1e40af; 
  text-shadow:0 1px 0 rgba(255,255,255,.55);
}
  .dark .brand-name{ color:#93c5fd; text-shadow:none; }
  .brand-tag{ color:var(--muted); font-weight:700; margin-top:.4rem; }

  /* ุชุตุบูุฑ ุดุนุงุฑ โุฃุซุฑโ ุนูู ุงูุดุงุดุงุช ุงูุตุบูุฑุฉ */
  @media (max-width: 640px){
    .brand-name{ font-size:2.4rem; }
  }
</style>
</head>
<body>
  <!-- ุงูุฎูููุงุช ุฌุงูุฒุฉ ูู style.css -->
  <div class="backdrop"></div>
  <div class="pattern"></div>

  <!-- ุงูุดุฑูุท ุงูุนููู -->
  <div class="topbar">
    <div class="left-actions">
      <a class="btn" href="index.html" title="ุงูุฑุฆูุณูุฉ">ุงูุฑุฆูุณูุฉ</a>
      <a class="btn" href="profile.html" title="ุงูููู ุงูุดุฎุตู">ุงูููู ุงูุดุฎุตู</a>
          <a id="nav-programs" class="btn" href="programs.html" style="display:none">ูุณุงุญุฉ ุฅุจุฏุงุนู </a>
    </div>
    <div class="actions">
      <button class="btn emoji-toggle" id="themeToggle" title="ุงููุถุน ุงูุฏุงูู/ุงููุงุชุญ">๐</button>
    </div>
  </div>

  <!-- ุงููููุฉ -->
  <header class="brand-wrap">
    <div class="brand-row">
    
      <h1 class="brand-name">ููููุทูููู</h1>
    </div>
    <div class="brand-tag">ุญููุซู ุชุจุฏุฃ ุงูุฎุทูุฉ.. ููุณุชููุฑู ุงูุฃุซูููุฑ</div>
  </header>
  
  <main class="container">
    <!-- ุจูุงุจุฉ ุจุณูุทุฉ: ูู ูุง ุนูุฏู ูุตูู ูุชุญููู ููุฎุทุท -->
    <section class="card" id="gate" style="display:none; margin-bottom:14px">
      <div class="muted">ูููู ุจุงูุชุญูู ูู ุญุงูุฉ ุงุดุชุฑุงููโฆ</div>
    </section>

    <!-- ุนูุงุตุฑ ุงูุชุญูู -->
    <section class="card controls">
      <div class="grid" style="grid-template-columns:1fr 1fr; gap:14px">
        <div>
          <label>ุงููุฑุญูุฉ ุงูุฏุฑุงุณูุฉ</label>
          <div class="select-wrap">
            <select id="stage" class="sel">
              <option value="" selected disabled>ุงุฎุชุฑ ุงููุฑุญูุฉ</option>
              <option value="primary-lower"> ุงููุฑุญูุฉ ุงูุฅุจุชุฏุงุฆู โ ุฏููุง </option>
              <option value="primary-upper"> ุงููุฑุญูุฉ ุงูุฅุจุชุฏุงุฆูุฉ โ ุนููุง </option>
              <option value="middle"> ุงููุฑุญูุฉ ุงููุชูุณุทุฉ </option>
              <option value="secondary">ุงููุฑุญูุฉ ุงูุซุงูููุฉ </option>
            </select>
            <span class="sel-icon" aria-hidden="true"><svg viewBox="0 0 20 20"><path d="M5 7l5 5 5-5H5z"/></svg></span>
          </div>
        </div>
        <div>
          <label>ุงููุงุฏุฉ</label>
          <div class="select-wrap">
            <select id="subject" class="sel" disabled>
              <option value="" selected disabled>ุงุฎุชุฑ ุงููุงุฏุฉ</option>
            </select>
            <span class="sel-icon" aria-hidden="true"><svg viewBox="0 0 20 20"><path d="M5 7l5 5 5-5H5z"/></svg></span>
          </div>
        </div>
      </div>

      <div class="grid" style="grid-template-columns:1fr 1fr; gap:14px; margin-top:12px">
        <div>
          <label>ุชุตููู ุจููู</label>
          <div class="select-wrap">
            <select id="type" class="sel">
              <option>ุงููู</option>
              <option>ุชุฐููุฑ</option><option>ููู</option><option>ุชุทุจูู</option>
              <option>ุชุญููู</option><option>ุชูููู</option><option>ุฅุจุฏุงุน</option>
            </select>
            <span class="sel-icon" aria-hidden="true"><svg viewBox="0 0 20 20"><path d="M5 7l5 5 5-5H5z"/></svg></span>
          </div>
        </div>
        <div>
          <label>ุงุณู ุงูุฏุฑุณ </label>
          <input id="lesson" placeholder="ูุซุงู: ุงูุงุชุฒุงู ุงูุฏูุฑุงูู">
        </div>
      </div>

      <div class="flex" style="display:flex; align-items:center; gap:8px; margin-top:12px">
        <button id="gen" class="btn primary"> โจุณุงุนุฏูู ุนูู ุงูุฅุจุฏุงุน</button>
        <button id="regen" class="btn">ุฃุจุฏุน ุจุงุณุชุฑุงุชูุฌูุฉ ุฃุฎุฑู</button>
        <span id="status" class="muted"></span>
      </div>
    </section>

    <!-- ุงููุฎุฑุฌุงุช -->
    <section id="out" class="card" style="display:none">
      <div class="flex" style="display:flex; align-items:center; justify-content:space-between; gap:10px">
        <h2 id="title" class="text-2xl" style="margin:0"></h2>
        <div id="chips"></div>
      </div>
      <div class="divider" style="height:12px; opacity:.25; margin:8px 0 12px; background:
        radial-gradient(circle at 6px 6px, var(--sea-500) 3px, transparent 4px) repeat-x left/26px 12px,
        radial-gradient(circle at 18px 6px, var(--sea-300) 2.2px, transparent 3.2px) repeat-x left/26px 12px;"></div>

      <div class="grid" style="grid-template-columns:1fr 1fr; gap:16px">
        <div>
          <h3>ุงูุฃูููุฉ</h3>
          <p id="importance"></p>
        </div>
        <div>
          <h3>ููุงุฏ/ุฃุฏูุงุช</h3>
          <p id="materials"></p>
        </div>
      </div>

      <div class="grid" style="grid-template-columns:1fr 1fr; gap:16px; margin-top:8px">
        <div>
          <h3>ุงูุฃูุฏุงู</h3>
          <ul id="goals" style="margin:6px 0 0 0; padding-inline-start:20px; list-style:disc"></ul>
        </div>
        <div>
          <h3>ุฎุทูุงุช ุงูุชุทุจูู</h3>
          <ol id="steps" style="margin:6px 0 0 0; padding-inline-start:20px; list-style:decimal"></ol>
        </div>
      </div>

      <div style="margin-top:10px">
        <h3>ุฃูุซูุฉ ุนูููุฉ</h3>
        <ul id="examples" style="margin:6px 0 0 0; padding-inline-start:20px; list-style:disc"></ul>
      </div>

      <div class="grid" style="grid-template-columns:1fr 1fr; gap:16px; margin-top:8px">
        <div>
          <h3>ุงูุชูููู</h3>
          <p id="assessment"></p>
        </div>
        <div>
          <h3>ุชูุฑูู ุงูุชุนููู</h3>
          <ul id="diff" style="margin:6px 0 0 0; padding-inline-start:20px; list-style:disc"></ul>
        </div>
      </div>

      <div style="margin-top:10px">
        <h3>ุงูุฃุซุฑ ุงููุชููุน</h3>
        <p id="impact"></p>
      </div>

      <div style="margin-top:10px">
        <h3>ูุฑุงุฌุน/ูุตุงุฏุฑ</h3>
        <ul id="cites" style="margin:6px 0 0 0; padding-inline-start:20px; list-style:disc"></ul>
      </div>

      <div style="margin-top:12px; display:flex; gap:8px">
        <button id="copy" class="btn">ูุณุฎ</button>
      </div>
    </section>

    <p id="err" class="muted" style="text-align:center; display:none">ุฑุฌุงุกู ุงุฎุชุงุฑู ุงููุฑุญูุฉ ูุงููุงุฏุฉ.</p>
  </main>

  <footer>
    <p class="foot-line">ุงูุชุนููู ุดุฑุงุฑุฉ ุตุบูุฑุฉโฆ ุชูุถูุก ุนููููุง ูุจูุฑุฉ.</p>
    <p class="foot-name">ูุฏู ุงููุฌูุฑุด</p>
  </footer>

  <div class="toast"></div>

  <!-- ูุนุชูุฏ ุนูู app.js (ุงููุตูู/ุงูุซูู/ุงูุชูุณุช โฆ) -->
  <script src="app.js"></script>

<script>
  // ุชุฃููุฏ ุงููุตูู: ูู ูุง ููู ุงุดุชุฑุงู/ุชุฌุฑุจุฉ โ ุชุญููู ููุฎุทุท
  document.addEventListener('DOMContentLoaded', ()=>{
    try{
      if(typeof hasAccess === 'function'){
        const ok = hasAccess();
        if(!ok){ location.href = 'pricing.html'; }
        else { const g=document.getElementById('gate'); if(g) g.style.display='none'; }
      }
    }catch(_){}
  });

  // ุงูููุงุฏ ุญุณุจ ุงููุฑุญูุฉ (ูููุฌ ุงูุณุนูุฏูุฉ 2025 โ ุชุจุณูุท ุนููู)
  const SUBJECTS = {
    "primary-lower": [ // 1-3
      "ุงููุบุฉ ุงูุนุฑุจูุฉ","ุงูุฑูุงุถูุงุช","ุงูุนููู","ููุงุฑุงุช ุฑูููุฉ","ุงููุบุฉ ุงูุฅูุฌููุฒูุฉ",
      "ุงูุฏุฑุงุณุงุช ุงูุฅุณูุงููุฉ","ุงูุชุฑุจูุฉ ุงููููุฉ","ุงูุชุฑุจูุฉ ุงูุจุฏููุฉ ูุงูุฏูุงุน ุนู ุงูููุณ","ููุงุฑุงุช ุญูุงุชูุฉ ูุฃุณุฑูุฉ"
    ],
    "primary-upper": [ // 4-6
      "ุงููุบุฉ ุงูุนุฑุจูุฉ","ุงูุฑูุงุถูุงุช","ุงูุนููู","ุงูููุงุฑุงุช ุงูุฑูููุฉ","ุงููุบุฉ ุงูุฅูุฌููุฒูุฉ",
      "ุงูุฏุฑุงุณุงุช ุงูุฅุฌุชูุงุนูุฉ","ุงูุฏุฑุงุณุงุช ุงูุฅุณูุงููุฉ","ุงูุชูููุฑ ุงููุงูุฏ","ุงูุชุฑุจูุฉ ุงููููุฉ","ุงูุชุฑุจูุฉ ุงูุจุฏููุฉ ูุงูุฏูุงุน ุนู ุงูููุณ"
    ],
    "middle": [ // 1-3 ูุชูุณุท
      "ุงููุบุฉ ุงูุนุฑุจูุฉ","ุงูุฑูุงุถูุงุช","ุงูุนููู","ุงููุบุฉ ุงูุฅูุฌููุฒูุฉ","ุงูุฏุฑุงุณุงุช ุงูุฅุฌุชูุงุนูุฉ",
      "ุงูุฏุฑุงุณุงุช ุงูุฅุณูุงููุฉ","ุงูุชูููุฑ ุงููุงูุฏ ูุงูููุทู","ููุงุฑุงุช ุฑูููุฉ","ุงูุชุฑุจูุฉ ุงููููุฉ","ุงูุชุฑุจูุฉ ุงูุจุฏููุฉ ูุงูุฏูุงุน ุนู ุงูููุณ"
    ],
    "secondary": [ // ุซุงููู ูุณุงุฑุงุช (ุนุงูุฉ)
      "ุงูููุฒูุงุก","ุงูููููุงุก","ุงูุฃุญูุงุก","ุงูุฑูุงุถูุงุช","ุงููุบุฉ ุงูุนุฑุจูุฉ","ุงููุบุฉ ุงูุฅูุฌููุฒูุฉ",
      "ุงูุชุงุฑูุฎ","ุงูุฏุฑุงุณุงุช ุงูุฅุณูุงููุฉ","ููุงุฑุงุช ุฑูููุฉ","ุนูู ุงูุฃุฑุถ ูุงููุถุงุก","ุงูุชูููุฑ ุงููุงูุฏ"
    ]
  };

  // ูุณุชุฎุฏู $ ู $$ ุงูุฌุงูุฒุฉ ูู app.js (ูุง ุชุนูุฏูู ุชุนุฑูููุง ููุง)
  const stageSel   = $('#stage');
  const subjectSel = $('#subject');
  const bloomSel   = $('#type');
  const lessonInp  = $('#lesson');
  const genBtn     = $('#gen');
  const regenBtn   = $('#regen');
  const statusEl   = $('#status');

  // ุชุญููู ููุงุฏ ุงููุฑุญูุฉ
  stageSel.addEventListener('change', ()=>{
    const s = stageSel.value;
    subjectSel.innerHTML = '<option value="" selected disabled>ุงุฎุชุฑ ุงููุงุฏุฉ</option>';
    (SUBJECTS[s]||[]).forEach(m=>{
      const opt = document.createElement('option'); opt.value = m; opt.textContent = m;
      subjectSel.appendChild(opt);
    });
    subjectSel.disabled = !(SUBJECTS[s] && SUBJECTS[s].length);
  });

  function listTo(el, arr){
    el.innerHTML = "";
    (arr||[]).forEach(v=>{
      const t = (v||"").toString().trim();
      if(!t) return;
      const li = document.createElement('li'); li.textContent = t;
      el.appendChild(li);
    });
  }
  function toast(msg){
    let t = document.querySelector('.toast'); 
    if(!t){ t=document.createElement('div'); t.className='toast'; document.body.appendChild(t); }
    t.textContent = msg; t.classList.add('show');
    setTimeout(()=>t.classList.remove('show'), 2000);
  }
  function setLoading(isLoading){
    if(isLoading){
      genBtn.dataset._label = genBtn.textContent;
      genBtn.textContent = "ูุญููู ุดุบูู ูุงุณุชุฑุงุชูุฌูุฉโฆ โจ";
      genBtn.disabled = true; regenBtn.disabled = true;
    }else{
      genBtn.textContent = genBtn.dataset._label || "ุณุงุนุฏูู ุนูู ุงูุฅุจุฏุงุน";
      genBtn.disabled = false; regenBtn.disabled = false;
    }
  }
  function readStageLabel(val){
    return {
      "primary-lower":"ุงุจุชุฏุงุฆู โ ุฏููุง",
      "primary-upper":"ุงุจุชุฏุงุฆู โ ุนููุง",
      "middle":"ูุชูุณุท",
      "secondary":"ุซุงููู"
    }[val] || val;
  }

  // ูุฏุงุก ุงูู Function
  async function callStrategy({stage, subject, bloomType, lesson, variant}){
    const res = await fetch("/.netlify/functions/strategy", {
      method: "POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify({ stage, subject, bloomType, lesson, variant })
    });
    if(!res.ok){
      const txt = await res.text();
      throw new Error("ุฎุทุฃ ูู ุงูุฎุงุฏู: "+res.status+" | "+txt);
    }
    return res.json();
  }

  function paintOutput(data, meta){
    $("#title").textContent = data.strategy_name || "โ";
    // Chips
    const chips=[];
    if(meta.stage)   chips.push(meta.stageLabel || meta.stage);
    if(meta.subject) chips.push(meta.subject);
    if(data.bloom || meta.bloomType) chips.push(data.bloom || meta.bloomType);
    if(meta.lesson)  chips.push("ุงูุฏุฑุณ: "+meta.lesson);
    $("#chips").innerHTML = chips.map(t=>`<span class="chip">${t}</span>`).join("");

    $("#importance").textContent = data.importance || "โ";
    $("#materials").textContent  = data.materials  || "โ";
    $("#assessment").textContent = data.assessment || "โ";
    $("#impact").textContent     = data.expected_impact || "โ";

    const diffUl = $("#diff"); diffUl.innerHTML = "";
    [["ุฏุนู: ",data.diff_support],["ุฃุณุงุณู: ",data.diff_core],["ุชุญุฏูู: ",data.diff_challenge]].forEach(([k,v])=>{
      if(v){ const li=document.createElement('li'); li.textContent = k+v; diffUl.appendChild(li); }
    });

    listTo($("#goals"),    data.goals);
    listTo($("#steps"),    data.steps);
    listTo($("#examples"), data.examples);

    const citesUl = $("#cites"); citesUl.innerHTML = "";
    (data.citations||[]).forEach(c=>{
      if(!c || !c.title) return;
      const li = document.createElement('li');
      const strong = document.createElement('strong'); strong.textContent = c.title;
      li.appendChild(strong);
      if(c.benefit){
        const p = document.createElement('p'); p.style.margin = "4px 0 0 0"; p.className = "muted"; p.textContent = c.benefit;
        li.appendChild(p);
      }
      citesUl.appendChild(li);
    });

    $("#out").style.display = "block";
    $("#err").style.display = "none";
    $("#regen").style.display = "inline-flex";
  }

  async function generate(variant=null){
    const stage   = stageSel.value;
    const subject = subjectSel.value;
    const bloom   = bloomSel.value;
    const lesson  = lessonInp.value.trim();

    if(!stage || !subject){
      $("#err").style.display = "block";
      toast("ุงุฎุชุงุฑู ุงููุฑุญูุฉ ูุงููุงุฏุฉ ุฃููุงู.");
      return;
    }
    $("#err").style.display = "none";
    statusEl.textContent = "ุฌุงุฑู ุชุญููู ุดุบูู ุฅูู ุงุณุชุฑุงุชูุฌูุฉ ููููุณุฉ โฆโจ";
    setLoading(true);
    try{
      const data = await callStrategy({
        stage,
        subject,
        bloomType: bloom,
        lesson,
        variant: variant || Math.floor(Math.random()*1e9)
      });
      paintOutput(data, { stage, stageLabel: readStageLabel(stage), subject, bloomType: bloom, lesson });
      statusEl.textContent = "ุชูููู  โจ";
    }catch(err){
      console.error(err);
      statusEl.textContent = err.message || "ุชุนุฐุฑ ุงูุชูููุฏ.";
      toast("ุชุนุฐูุฑ ุงูุชูููุฏ. ุฌุฑูุจ ุซุงููุฉ.");
    }finally{
      setLoading(false);
    }
  }

  $("#gen").addEventListener("click", ()=> generate(null));
  $("#regen").addEventListener("click", ()=> generate(Date.now()));

  // ูุณุฎ ุงููุงุชุฌ
  $("#copy").addEventListener("click", ()=>{
    const text = document.querySelector("#out").innerText;
    if(navigator.clipboard && window.isSecureContext){
      navigator.clipboard.writeText(text).then(()=> toast("ุชู ุงููุณุฎ โ"));
    }else{
      const ta=document.createElement("textarea"); ta.value=text;
      document.body.appendChild(ta); ta.select();
      try{ document.execCommand("copy"); toast("ุชู ุงููุณุฎ โ"); }
      finally{ document.body.removeChild(ta); }
    }
  });

  // ุชููุฆุฉ ุฒุฑ ุงููุงุฏุฉ ุฅุฐุง ูุงูุช ุงููุฑุญูุฉ ูุญุฏุฏุฉ ูุณุจููุง ูุฃู ุณุจุจ
  document.addEventListener('DOMContentLoaded', ()=>{
    if(stageSel.value){
      stageSel.dispatchEvent(new Event('change'));
    }
  });
</script>
</body>
</html>
