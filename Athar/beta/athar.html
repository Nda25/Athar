<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ù…ÙÙ€Ù†Ø·Ù€Ù€Ù„Ù‚ </title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css" />
<meta name="color-scheme" content="dark light">
<style>
  /* Ø®ØµÙˆØµÙŠØ§Øª Ø¨Ø³ÙŠØ·Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© ÙÙˆÙ‚ style.css */

  .topbar .left-actions { display:flex; align-items:center; gap:10px; }
  .emoji-toggle { font-size:18px; line-height:1; }

  .controls.card { padding:20px; }
  .select-wrap{ position:relative }
  .select-wrap .sel{
    width:100%; background:#fff; color:#0f172a; border:1px solid rgba(59,130,246,.35);
    border-radius:12px; padding:.9rem 1rem; padding-inline-start:2.2rem; outline:none; appearance:none;
  }
  .dark .select-wrap .sel{ background:#0f172a; color:#f1f5f9; border-color:#3b82f6; }
  .select-wrap .sel-icon{
    position:absolute; inset-inline-start:.7rem; top:50%; transform:translateY(-50%);
    width:16px; height:16px; pointer-events:none; color:var(--sea-500);
  }
  .select-wrap .sel-icon svg{ width:16px; height:16px; display:block; fill:currentColor }
  .dark .select-wrap .sel-icon{ color:#93c5fd }

  .muted { color: var(--muted); font-size:.95rem; }

  /* Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø¨Ø§Ù„Ø£Ø²Ø±Ù‚ Ù…Ø«Ù„ Ø·Ù„Ø¨Ùƒ */
  #out h2, #out h3 { color: var(--sea-600); margin: 0 0 8px; }
  .dark #out h2, .dark #out h3 { color: #93c5fd; }

  #chips .chip{
    display:inline-block; padding:.28rem .65rem; border-radius:999px; background:var(--sea-100); color:#0c4a6e; font-size:.82rem; border:1px solid rgba(59,130,246,.25); margin-inline-start:6px;
  }
  .dark #chips .chip{ background:#0f172a; color:#e2e8f0; border-color:#3b82f6; }

  #regen{ display:none; }

  /* Ø´Ø¹Ø§Ø± Â«Ø£Ø«Ù€Ù€Ø±Â» ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„Ø£ØµÙ„ */
.brand-name{
  font-family:"Cairo", sans-serif; 
  font-weight:700; 
  letter-spacing:.5px;
  font-size:clamp(44px, 6.2vw, 84px); 
  margin:0;
  color:#1e40af; 
  text-shadow:0 1px 0 rgba(255,255,255,.55);
}
  .dark .brand-name{ color:#93c5fd; text-shadow:none; }
  .brand-tag{ color:var(--muted); font-weight:700; margin-top:.4rem; }

  /* ØªØµØºÙŠØ± Ø´Ø¹Ø§Ø± â€œØ£Ø«Ø±â€ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
  @media (max-width: 640px){
    .brand-name{ font-size:2.4rem; }
  }
</style>
</head>
<body>
  <!-- Ø§Ù„Ø®Ù„ÙÙŠØ§Øª Ø¬Ø§Ù‡Ø²Ø© Ù…Ù† style.css -->
  <div class="backdrop"></div>
  <div class="pattern"></div>

  <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
  <div class="topbar">
    <div class="left-actions">
      <a class="btn" href="index.html" title="Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      <a class="btn" href="profile.html" title="Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</a>
          <a id="nav-programs" class="btn" href="programs.html" style="display:none">Ù…Ø³Ø§Ø­Ø© Ø¥Ø¨Ø¯Ø§Ø¹ÙŠ </a>
    </div>
    <div class="actions">
      <button class="btn emoji-toggle" id="themeToggle" title="Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†/Ø§Ù„ÙØ§ØªØ­">ğŸŒ“</button>
    </div>
  </div>

  <!-- Ø§Ù„Ù‡ÙˆÙŠØ© -->
  <header class="brand-wrap">
    <div class="brand-row">
    
      <h1 class="brand-name">Ù…ÙÙ€Ù†Ø·Ù€Ù€Ù„Ù‚</h1>
    </div>
    <div class="brand-tag">Ø­ÙŠÙ€Ø«Ù ØªØ¨Ø¯Ø£ Ø§Ù„Ø®Ø·ÙˆØ©.. ÙˆÙŠØ³ØªÙ…Ù€Ø±Ù Ø§Ù„Ø£Ø«Ù€ÙÙ€Ø±</div>
  </header>
  
  <main class="container">
    <!-- Ø¨ÙˆØ§Ø¨Ø© Ø¨Ø³ÙŠØ·Ø©: Ù„Ùˆ Ù…Ø§ Ø¹Ù†Ø¯Ù‡ ÙˆØµÙˆÙ„ ÙŠØªØ­ÙˆÙ‘Ù„ Ù„Ù„Ø®Ø·Ø· -->
    <section class="card" id="gate" style="display:none; margin-bottom:14px">
      <div class="muted">Ù†Ù‚ÙˆÙ… Ø¨Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ø´ØªØ±Ø§ÙƒÙƒâ€¦</div>
    </section>

    <!-- Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… -->
    <section class="card controls">
      <div class="grid" style="grid-template-columns:1fr 1fr; gap:14px">
        <div>
          <label>Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</label>
          <div class="select-wrap">
            <select id="stage" class="sel">
              <option value="" selected disabled>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø©</option>
              <option value="primary-lower"> Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø¨ØªØ¯Ø§Ø¦ÙŠ â€” Ø¯Ù†ÙŠØ§ </option>
              <option value="primary-upper"> Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø¨ØªØ¯Ø§Ø¦ÙŠØ© â€” Ø¹Ù„ÙŠØ§ </option>
              <option value="middle"> Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø© </option>
              <option value="secondary">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ© </option>
            </select>
            <span class="sel-icon" aria-hidden="true"><svg viewBox="0 0 20 20"><path d="M5 7l5 5 5-5H5z"/></svg></span>
          </div>
        </div>
        <div>
          <label>Ø§Ù„Ù…Ø§Ø¯Ø©</label>
          <div class="select-wrap">
            <select id="subject" class="sel" disabled>
              <option value="" selected disabled>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</option>
            </select>
            <span class="sel-icon" aria-hidden="true"><svg viewBox="0 0 20 20"><path d="M5 7l5 5 5-5H5z"/></svg></span>
          </div>
        </div>
      </div>

      <div class="grid" style="grid-template-columns:1fr 1fr; gap:14px; margin-top:12px">
        <div>
          <label>ØªØµÙ†ÙŠÙ Ø¨Ù„ÙˆÙ…</label>
          <div class="select-wrap">
            <select id="type" class="sel">
              <option>Ø§Ù„ÙƒÙ„</option>
              <option>ØªØ°ÙƒÙ‘Ø±</option><option>ÙÙ‡Ù…</option><option>ØªØ·Ø¨ÙŠÙ‚</option>
              <option>ØªØ­Ù„ÙŠÙ„</option><option>ØªÙ‚ÙŠÙŠÙ…</option><option>Ø¥Ø¨Ø¯Ø§Ø¹</option>
            </select>
            <span class="sel-icon" aria-hidden="true"><svg viewBox="0 0 20 20"><path d="M5 7l5 5 5-5H5z"/></svg></span>
          </div>
        </div>
        <div>
          <label>Ø§Ø³Ù… Ø§Ù„Ø¯Ø±Ø³ </label>
          <input id="lesson" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø§ØªØ²Ø§Ù† Ø§Ù„Ø¯ÙˆØ±Ø§Ù†ÙŠ">
        </div>
      </div>

      <div class="flex" style="display:flex; align-items:center; gap:8px; margin-top:12px">
        <button id="gen" class="btn primary"> âœ¨Ø³Ø§Ø¹Ø¯Ù†ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹</button>
        <button id="regen" class="btn">Ø£Ø¨Ø¯Ø¹ Ø¨Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø£Ø®Ø±Ù‰</button>
        <span id="status" class="muted"></span>
      </div>
    </section>

    <!-- Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª -->
    <section id="out" class="card" style="display:none">
      <div class="flex" style="display:flex; align-items:center; justify-content:space-between; gap:10px">
        <h2 id="title" class="text-2xl" style="margin:0"></h2>
        <div id="chips"></div>
      </div>
      <div class="divider" style="height:12px; opacity:.25; margin:8px 0 12px; background:
        radial-gradient(circle at 6px 6px, var(--sea-500) 3px, transparent 4px) repeat-x left/26px 12px,
        radial-gradient(circle at 18px 6px, var(--sea-300) 2.2px, transparent 3.2px) repeat-x left/26px 12px;"></div>

      <div class="grid" style="grid-template-columns:1fr 1fr; gap:16px">
        <div>
          <h3>Ø§Ù„Ø£Ù‡Ù…ÙŠØ©</h3>
          <p id="importance"></p>
        </div>
        <div>
          <h3>Ù…ÙˆØ§Ø¯/Ø£Ø¯ÙˆØ§Øª</h3>
          <p id="materials"></p>
        </div>
      </div>

      <div class="grid" style="grid-template-columns:1fr 1fr; gap:16px; margin-top:8px">
        <div>
          <h3>Ø§Ù„Ø£Ù‡Ø¯Ø§Ù</h3>
          <ul id="goals" style="margin:6px 0 0 0; padding-inline-start:20px; list-style:disc"></ul>
        </div>
        <div>
          <h3>Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</h3>
          <ol id="steps" style="margin:6px 0 0 0; padding-inline-start:20px; list-style:decimal"></ol>
        </div>
      </div>

      <div style="margin-top:10px">
        <h3>Ø£Ù…Ø«Ù„Ø© Ø¹Ù…Ù„ÙŠØ©</h3>
        <ul id="examples" style="margin:6px 0 0 0; padding-inline-start:20px; list-style:disc"></ul>
      </div>

      <div class="grid" style="grid-template-columns:1fr 1fr; gap:16px; margin-top:8px">
        <div>
          <h3>Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</h3>
          <p id="assessment"></p>
        </div>
        <div>
          <h3>ØªÙØ±ÙŠÙ‚ Ø§Ù„ØªØ¹Ù„ÙŠÙ…</h3>
          <ul id="diff" style="margin:6px 0 0 0; padding-inline-start:20px; list-style:disc"></ul>
        </div>
      </div>

      <div style="margin-top:10px">
        <h3>Ø§Ù„Ø£Ø«Ø± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</h3>
        <p id="impact"></p>
      </div>

      <div style="margin-top:10px">
        <h3>Ù…Ø±Ø§Ø¬Ø¹/Ù…ØµØ§Ø¯Ø±</h3>
        <ul id="cites" style="margin:6px 0 0 0; padding-inline-start:20px; list-style:disc"></ul>
      </div>

      <div style="margin-top:12px; display:flex; gap:8px">
        <button id="copy" class="btn">Ù†Ø³Ø®</button>
      </div>
    </section>

    <p id="err" class="muted" style="text-align:center; display:none">Ø±Ø¬Ø§Ø¡Ù‹ Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ù„Ù…Ø±Ø­Ù„Ø© ÙˆØ§Ù„Ù…Ø§Ø¯Ø©.</p>
  </main>

  <footer>
    <p class="foot-line">Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø´Ø±Ø§Ø±Ø© ØµØºÙŠØ±Ø©â€¦ ØªÙØ¶ÙŠØ¡ Ø¹Ù‚ÙˆÙ„Ù‹Ø§ ÙƒØ¨ÙŠØ±Ø©.</p>
    <p class="foot-name">Ù†Ø¯Ù‰ Ø§Ù„Ù…Ø¬ÙŠØ±Ø´</p>
  </footer>

  <div class="toast"></div>

  <!-- ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ app.js (Ø§Ù„ÙˆØµÙˆÙ„/Ø§Ù„Ø«ÙŠÙ…/Ø§Ù„ØªÙˆØ³Øª â€¦) -->
  <script src="app.js"></script>

<script>
  // ØªØ£ÙƒÙŠØ¯ Ø§Ù„ÙˆØµÙˆÙ„: Ù„Ùˆ Ù…Ø§ ÙÙŠÙ‡ Ø§Ø´ØªØ±Ø§Ùƒ/ØªØ¬Ø±Ø¨Ø© â†’ ØªØ­ÙˆÙŠÙ„ Ù„Ù„Ø®Ø·Ø·
  document.addEventListener('DOMContentLoaded', ()=>{
    try{
      if(typeof hasAccess === 'function'){
        const ok = hasAccess();
        if(!ok){ location.href = 'pricing.html'; }
        else { const g=document.getElementById('gate'); if(g) g.style.display='none'; }
      }
    }catch(_){}
  });

  // Ø§Ù„Ù…ÙˆØ§Ø¯ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø±Ø­Ù„Ø© (Ù…Ù†Ù‡Ø¬ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© 2025 â€” ØªØ¨Ø³ÙŠØ· Ø¹Ù…Ù„ÙŠ)
  const SUBJECTS = {
    "primary-lower": [ // 1-3
      "Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©","Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª","Ø§Ù„Ø¹Ù„ÙˆÙ…","Ù…Ù‡Ø§Ø±Ø§Øª Ø±Ù‚Ù…ÙŠØ©","Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©",
      "Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©","Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„ÙÙ†ÙŠØ©","Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¨Ø¯Ù†ÙŠØ© ÙˆØ§Ù„Ø¯ÙØ§Ø¹ Ø¹Ù† Ø§Ù„Ù†ÙØ³","Ù…Ù‡Ø§Ø±Ø§Øª Ø­ÙŠØ§ØªÙŠØ© ÙˆØ£Ø³Ø±ÙŠØ©"
    ],
    "primary-upper": [ // 4-6
      "Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©","Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª","Ø§Ù„Ø¹Ù„ÙˆÙ…","Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ©","Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©",
      "Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¥Ø¬ØªÙ…Ø§Ø¹ÙŠØ©","Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©","Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ù†Ø§Ù‚Ø¯","Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„ÙÙ†ÙŠØ©","Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¨Ø¯Ù†ÙŠØ© ÙˆØ§Ù„Ø¯ÙØ§Ø¹ Ø¹Ù† Ø§Ù„Ù†ÙØ³"
    ],
    "middle": [ // 1-3 Ù…ØªÙˆØ³Ø·
      "Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©","Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª","Ø§Ù„Ø¹Ù„ÙˆÙ…","Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©","Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¥Ø¬ØªÙ…Ø§Ø¹ÙŠØ©",
      "Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©","Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ù†Ø§Ù‚Ø¯ ÙˆØ§Ù„Ù…Ù†Ø·Ù‚","Ù…Ù‡Ø§Ø±Ø§Øª Ø±Ù‚Ù…ÙŠØ©","Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„ÙÙ†ÙŠØ©","Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¨Ø¯Ù†ÙŠØ© ÙˆØ§Ù„Ø¯ÙØ§Ø¹ Ø¹Ù† Ø§Ù„Ù†ÙØ³"
    ],
    "secondary": [ // Ø«Ø§Ù†ÙˆÙŠ Ù…Ø³Ø§Ø±Ø§Øª (Ø¹Ø§Ù…Ø©)
      "Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡","Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡","Ø§Ù„Ø£Ø­ÙŠØ§Ø¡","Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª","Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©","Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©",
      "Ø§Ù„ØªØ§Ø±ÙŠØ®","Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©","Ù…Ù‡Ø§Ø±Ø§Øª Ø±Ù‚Ù…ÙŠØ©","Ø¹Ù„Ù… Ø§Ù„Ø£Ø±Ø¶ ÙˆØ§Ù„ÙØ¶Ø§Ø¡","Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ù†Ø§Ù‚Ø¯"
    ]
  };

  // Ù†Ø³ØªØ®Ø¯Ù… $ Ùˆ $$ Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© Ù…Ù† app.js (Ù„Ø§ ØªØ¹ÙŠØ¯ÙŠÙ† ØªØ¹Ø±ÙŠÙÙ‡Ø§ Ù‡Ù†Ø§)
  const stageSel   = $('#stage');
  const subjectSel = $('#subject');
  const bloomSel   = $('#type');
  const lessonInp  = $('#lesson');
  const genBtn     = $('#gen');
  const regenBtn   = $('#regen');
  const statusEl   = $('#status');

  // ØªØ­Ù…ÙŠÙ„ Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø±Ø­Ù„Ø©
  stageSel.addEventListener('change', ()=>{
    const s = stageSel.value;
    subjectSel.innerHTML = '<option value="" selected disabled>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</option>';
    (SUBJECTS[s]||[]).forEach(m=>{
      const opt = document.createElement('option'); opt.value = m; opt.textContent = m;
      subjectSel.appendChild(opt);
    });
    subjectSel.disabled = !(SUBJECTS[s] && SUBJECTS[s].length);
  });

  function listTo(el, arr){
    el.innerHTML = "";
    (arr||[]).forEach(v=>{
      const t = (v||"").toString().trim();
      if(!t) return;
      const li = document.createElement('li'); li.textContent = t;
      el.appendChild(li);
    });
  }
  function toast(msg){
    let t = document.querySelector('.toast'); 
    if(!t){ t=document.createElement('div'); t.className='toast'; document.body.appendChild(t); }
    t.textContent = msg; t.classList.add('show');
    setTimeout(()=>t.classList.remove('show'), 2000);
  }
  function setLoading(isLoading){
    if(isLoading){
      genBtn.dataset._label = genBtn.textContent;
      genBtn.textContent = "Ù†Ø­ÙˆÙ‘Ù„ Ø´ØºÙÙƒ Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©â€¦ âœ¨";
      genBtn.disabled = true; regenBtn.disabled = true;
    }else{
      genBtn.textContent = genBtn.dataset._label || "Ø³Ø§Ø¹Ø¯Ù†ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹";
      genBtn.disabled = false; regenBtn.disabled = false;
    }
  }
  function readStageLabel(val){
    return {
      "primary-lower":"Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ â€” Ø¯Ù†ÙŠØ§",
      "primary-upper":"Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ â€” Ø¹Ù„ÙŠØ§",
      "middle":"Ù…ØªÙˆØ³Ø·",
      "secondary":"Ø«Ø§Ù†ÙˆÙŠ"
    }[val] || val;
  }

  // Ù†Ø¯Ø§Ø¡ Ø§Ù„Ù€ Function
  async function callStrategy({stage, subject, bloomType, lesson, variant}){
    const res = await fetch("/.netlify/functions/strategy", {
      method: "POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify({ stage, subject, bloomType, lesson, variant })
    });
    if(!res.ok){
      const txt = await res.text();
      throw new Error("Ø®Ø·Ø£ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…: "+res.status+" | "+txt);
    }
    return res.json();
  }

  function paintOutput(data, meta){
    $("#title").textContent = data.strategy_name || "â€”";
    // Chips
    const chips=[];
    if(meta.stage)   chips.push(meta.stageLabel || meta.stage);
    if(meta.subject) chips.push(meta.subject);
    if(data.bloom || meta.bloomType) chips.push(data.bloom || meta.bloomType);
    if(meta.lesson)  chips.push("Ø§Ù„Ø¯Ø±Ø³: "+meta.lesson);
    $("#chips").innerHTML = chips.map(t=>`<span class="chip">${t}</span>`).join("");

    $("#importance").textContent = data.importance || "â€”";
    $("#materials").textContent  = data.materials  || "â€”";
    $("#assessment").textContent = data.assessment || "â€”";
    $("#impact").textContent     = data.expected_impact || "â€”";

    const diffUl = $("#diff"); diffUl.innerHTML = "";
    [["Ø¯Ø¹Ù…: ",data.diff_support],["Ø£Ø³Ø§Ø³ÙŠ: ",data.diff_core],["ØªØ­Ø¯Ù‘ÙŠ: ",data.diff_challenge]].forEach(([k,v])=>{
      if(v){ const li=document.createElement('li'); li.textContent = k+v; diffUl.appendChild(li); }
    });

    listTo($("#goals"),    data.goals);
    listTo($("#steps"),    data.steps);
    listTo($("#examples"), data.examples);

    const citesUl = $("#cites"); citesUl.innerHTML = "";
    (data.citations||[]).forEach(c=>{
      if(!c || !c.title) return;
      const li = document.createElement('li');
      const strong = document.createElement('strong'); strong.textContent = c.title;
      li.appendChild(strong);
      if(c.benefit){
        const p = document.createElement('p'); p.style.margin = "4px 0 0 0"; p.className = "muted"; p.textContent = c.benefit;
        li.appendChild(p);
      }
      citesUl.appendChild(li);
    });

    $("#out").style.display = "block";
    $("#err").style.display = "none";
    $("#regen").style.display = "inline-flex";
  }

  async function generate(variant=null){
    const stage   = stageSel.value;
    const subject = subjectSel.value;
    const bloom   = bloomSel.value;
    const lesson  = lessonInp.value.trim();

    if(!stage || !subject){
      $("#err").style.display = "block";
      toast("Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ù„Ù…Ø±Ø­Ù„Ø© ÙˆØ§Ù„Ù…Ø§Ø¯Ø© Ø£ÙˆÙ„Ø§Ù‹.");
      return;
    }
    $("#err").style.display = "none";
    statusEl.textContent = "Ø¬Ø§Ø±ÙŠ ØªØ­ÙˆÙŠÙ„ Ø´ØºÙÙƒ Ø¥Ù„Ù‰ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ù…Ù„Ù…ÙˆØ³Ø© â€¦âœ¨";
    setLoading(true);
    try{
      const data = await callStrategy({
        stage,
        subject,
        bloomType: bloom,
        lesson,
        variant: variant || Math.floor(Math.random()*1e9)
      });
      paintOutput(data, { stage, stageLabel: readStageLabel(stage), subject, bloomType: bloom, lesson });
      statusEl.textContent = "ØªÙ€Ù€Ù€Ù…  âœ¨";
    }catch(err){
      console.error(err);
      statusEl.textContent = err.message || "ØªØ¹Ø°Ø± Ø§Ù„ØªÙˆÙ„ÙŠØ¯.";
      toast("ØªØ¹Ø°Ù‘Ø± Ø§Ù„ØªÙˆÙ„ÙŠØ¯. Ø¬Ø±Ù‘Ø¨ Ø«Ø§Ù†ÙŠØ©.");
    }finally{
      setLoading(false);
    }
  }

  $("#gen").addEventListener("click", ()=> generate(null));
  $("#regen").addEventListener("click", ()=> generate(Date.now()));

  // Ù†Ø³Ø® Ø§Ù„Ù†Ø§ØªØ¬
  $("#copy").addEventListener("click", ()=>{
    const text = document.querySelector("#out").innerText;
    if(navigator.clipboard && window.isSecureContext){
      navigator.clipboard.writeText(text).then(()=> toast("ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ“"));
    }else{
      const ta=document.createElement("textarea"); ta.value=text;
      document.body.appendChild(ta); ta.select();
      try{ document.execCommand("copy"); toast("ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ“"); }
      finally{ document.body.removeChild(ta); }
    }
  });

  // ØªÙ‡ÙŠØ¦Ø© Ø²Ø± Ø§Ù„Ù…Ø§Ø¯Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ù…Ø­Ø¯Ø¯Ø© Ù…Ø³Ø¨Ù‚Ù‹Ø§ Ù„Ø£ÙŠ Ø³Ø¨Ø¨
  document.addEventListener('DOMContentLoaded', ()=>{
    if(stageSel.value){
      stageSel.dispatchEvent(new Event('change'));
    }
  });
</script>
</body>
</html>
