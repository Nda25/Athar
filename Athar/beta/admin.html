<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>لوحة الإدارة — أثر</title>
    <link rel="icon" type="image/x-icon" href="assets/icons/favicon.ico" />
    <link rel="shortcut icon" href="assets/icons/favicon.ico" />
    <link rel="apple-touch-icon" href="assets/icons/logo.png" />
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
    <meta name="color-scheme" content="dark light" />
    <style>
      .card {
        margin: 20px 0;
        padding: 24px;
      }

      .grid {
        display: grid;
        gap: 16px;
        grid-template-columns: 1fr;
      }

      @media (min-width: 1100px) {
        .grid-2 {
          grid-template-columns: 1fr 1fr;
        }
        .grid-3 {
          grid-template-columns: 1fr 1fr 1fr;
        }
      }

      .field {
        margin: 12px 0;
      }

      .field label {
        display: block;
        font-weight: 700;
        margin: 0 0 8px 0;
        font-size: 14px;
      }

      .field input,
      .field select,
      .field textarea {
        width: 100%;
        padding: 12px 16px;
        border-radius: 8px;
        border: 1px solid rgba(59, 130, 246, 0.35);
        font-size: 14px;
      }

      .muted {
        opacity: 0.7;
        font-size: 14px;
      }

      .actions-row {
        margin-top: 16px;
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        align-items: center;
      }

      .pill {
        background: rgba(59, 130, 246, 0.12);
        padding: 4px 12px;
        border-radius: 999px;
        font-size: 13px;
        display: inline-block;
      }

      .table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
      }

      .table th,
      .table td {
        padding: 14px 12px;
        border-bottom: 1px solid rgba(229, 231, 235, 0.2);
        vertical-align: middle;
      }

      .table th {
        text-align: right;
        font-weight: 700;
        background: rgba(59, 130, 246, 0.05);
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .table tr:hover {
        background: rgba(59, 130, 246, 0.03);
      }

      .status-new {
        background: #fef9c3;
        color: #713f12;
      }
      .status-in_progress {
        background: #e0f2fe;
        color: #0c4a6e;
      }
      .status-resolved {
        background: #dcfce7;
        color: #14532d;
      }
      .status-rejected {
        background: #fee2e2;
        color: #7f1d1d;
      }

      .toolbar {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        align-items: center;
        margin-bottom: 20px;
      }

      .hidden {
        display: none;
      }

      .mini-actions {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        align-items: center;
      }

      .btn.sm {
        padding: 8px 12px;
        font-size: 12px;
        white-space: nowrap;
      }

      .nowrap {
        white-space: nowrap;
      }

      /* تحسينات إضافية */
      .title {
        margin: 0 0 20px 0;
        font-size: 24px;
      }

      input[type="search"],
      input[type="email"],
      input[type="text"],
      input[type="number"],
      select,
      textarea {
        transition: border-color 0.2s, box-shadow 0.2s;
      }

      input[type="search"]:focus,
      input[type="email"]:focus,
      input[type="text"]:focus,
      input[type="number"]:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: rgba(59, 130, 246, 0.6);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      .table-wrapper {
        overflow-x: auto;
        margin-top: 16px;
      }
    </style>
  </head>

  <body>
    <div id="navbar" data-component="components/navbar.html"></div>

    <div class="user"><span class="muted" id="whoami"></span></div>

    <header>
      <div class="hero">
        <h1 class="logo">لوحة التحكم لأحلى عموورة</h1>
        <div class="tag">
          <span class="dot"></span>أحلى مصممة برامج بالعالم ، ملكة أثر
        </div>
      </div>
    </header>

    <main class="container">
      <!-- الوصول مرفوض -->
      <section class="card" id="denyCard" style="display: none">
        <h2 class="title">الوصول مرفوض</h2>
        <p>هذه الصفحة للمشرفين فقط.</p>
      </section>

      <!-- تبويبات -->
      <section class="card" id="tabsCard" style="display: none">
        <div class="actions-row" style="margin-top: 0; gap: 8px">
          <button class="btn primary" data-tab="t-users">
            المشتركون الجدد
          </button>
          <button class="btn" data-tab="t-activate">التفعيل اليدوي</button>
          <button class="btn" data-tab="t-ann">الإعلانات</button>
          <button class="btn" data-tab="t-complaints">
            الشكاوى والاقتراحات
          </button>
        </div>
      </section>

      <!-- المشتركون الجدد -->
      <section class="card" id="t-users" style="display: none">
        <h2 class="title">المشتركون الجدد</h2>

        <div class="toolbar">
          <input
            id="u-q"
            type="search"
            placeholder="بحث (اسم/إيميل)"
            style="flex: 1; min-width: 200px"
          />
          <select id="u-active">
            <option value="">الكل</option>
            <option value="true">نشط</option>
            <option value="false">غير نشط</option>
          </select>
          <button class="btn" id="u-refresh">تحديث</button>
        </div>

        <div class="table-wrapper">
          <table class="table">
            <thead>
              <tr>
                <th style="width: 200px">المستخدم</th>
                <th style="width: 250px">الإيميل</th>
                <th style="width: 120px">انضمّ</th>
                <th style="width: 100px">الحالة</th>
                <th style="width: 120px">ينتهي</th>
                <th style="min-width: 450px">تفعيل سريع</th>
              </tr>
            </thead>
            <tbody id="u-rows">
              <tr>
                <td
                  colspan="6"
                  class="muted"
                  style="text-align: center; padding: 30px"
                >
                  جاري التحميل...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- التفعيل -->
      <section class="card" id="t-activate" style="display: none">
        <h2 class="title">التفعيل اليدوي للاشتراك</h2>

        <div class="grid grid-3">
          <div class="field">
            <label>البريد الإلكتروني للمستخدم</label>
            <input
              id="act-email"
              type="email"
              placeholder="example@email.com"
            />
          </div>

          <div class="field">
            <label>UID (اختياري)</label>
            <input
              id="act-userid"
              type="text"
              placeholder="Auth0 sub إن كان متاحًا"
            />
          </div>

          <div class="field">
            <label>المدّة</label>
            <div style="display: flex; gap: 10px; align-items: center">
              <input
                id="act-amount"
                type="number"
                min="1"
                value="12"
                style="max-width: 120px"
              />
              <select id="act-unit" style="max-width: 140px">
                <option value="months" selected>شهر/أشهر</option>
                <option value="days">يوم/أيام</option>
                <option value="years">سنة/سنوات</option>
              </select>
            </div>
          </div>

          <div class="field" style="grid-column: 1/-1">
            <label>ملاحظة (اختياري)</label>
            <input id="act-note" type="text" placeholder="سبب/مرجع" />
          </div>
        </div>

        <div class="actions-row">
          <button class="btn primary" id="btn-activate">تفعيل/تمديد</button>
          <span id="act-status" class="muted"></span>
        </div>
      </section>

      <!-- الإعلانات -->
      <section class="card" id="t-ann" style="display: none">
        <h2 class="title">إعلان عام</h2>

        <div class="field">
          <label>نص الإعلان</label>
          <textarea
            id="ann-text"
            rows="3"
            placeholder="سيظهر لمستخدمي الموقع"
          ></textarea>
        </div>

        <div class="grid grid-3">
          <div class="field">
            <label>الحالة</label>
            <select id="ann-active">
              <option value="true" selected>مُفعّل</option>
              <option value="false">موقّف</option>
            </select>
          </div>

          <div class="field">
            <label>تاريخ البدء (اختياري)</label>
            <div
              style="
                display: flex;
                gap: 10px;
                align-items: center;
                flex-wrap: wrap;
              "
            >
              <select id="ann-start-cal" style="max-width: 140px">
                <option value="greg" selected>ميلادي</option>
                <option value="hijri">هجري</option>
              </select>
              <input id="ann-start-g" type="date" />
              <input
                id="ann-start-h"
                type="text"
                inputmode="numeric"
                placeholder="مثال: 1447-02-10"
                style="display: none"
              />
            </div>
          </div>

          <div class="field">
            <label>تاريخ الانتهاء (اختياري)</label>
            <div
              style="
                display: flex;
                gap: 10px;
                align-items: center;
                flex-wrap: wrap;
              "
            >
              <select id="ann-end-cal" style="max-width: 140px">
                <option value="greg" selected>ميلادي</option>
                <option value="hijri">هجري</option>
              </select>
              <input id="ann-end-g" type="date" />
              <input
                id="ann-end-h"
                type="text"
                inputmode="numeric"
                placeholder="مثال: 1447-02-15"
                style="display: none"
              />
            </div>
          </div>
        </div>

        <div class="actions-row">
          <button class="btn" id="btn-publish">نشر/تحديث</button>
          <span id="ann-status" class="muted"></span>
        </div>

        <div class="card" style="margin-top: 20px">
          <h3 class="title" style="font-size: 18px; margin: 0 0 12px">
            الإعلانات
          </h3>
          <div id="ann-current" class="muted" style="margin-bottom: 12px">
            —
          </div>
          <div
            id="ann-list"
            class="grid"
            style="grid-template-columns: 1fr"
          ></div>
        </div>
      </section>

      <!-- الشكاوى والاقتراحات -->
      <section class="card" id="t-complaints" style="display: none">
        <h2 class="title">الشكاوى والاقتراحات</h2>

        <div class="toolbar">
          <select id="c-type">
            <option value="">الكل</option>
            <option value="complaint">شكاوى</option>
            <option value="suggestion">اقتراحات</option>
          </select>

          <select id="c-status">
            <option value="">كل الحالات</option>
            <option value="new">جديدة</option>
            <option value="in_progress">قيد المعالجة</option>
            <option value="resolved">مغلقة</option>
            <option value="rejected">مرفوضة</option>
          </select>

          <input
            id="c-q"
            type="search"
            placeholder="بحث (عنوان/نص/إيميل)"
            style="flex: 1; min-width: 200px"
          />
          <button class="btn" id="c-refresh">تحديث</button>
        </div>

        <div class="grid grid-2">
          <div class="card">
            <div class="table-wrapper">
              <table class="table" id="c-table">
                <thead>
                  <tr>
                    <th style="width: 250px">العنوان</th>
                    <th style="width: 180px">المرسل</th>
                    <th style="width: 80px">النوع</th>
                    <th style="width: 120px">الحالة</th>
                    <th style="width: 140px">التاريخ</th>
                  </tr>
                </thead>
                <tbody id="c-rows">
                  <tr>
                    <td
                      colspan="5"
                      class="muted"
                      style="text-align: center; padding: 30px"
                    >
                      —
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="card" id="c-detail">
            <h3 style="margin-top: 0; font-size: 18px">التفاصيل</h3>
            <div id="c-empty" class="muted">اختر عنصرًا من القائمة…</div>

            <div id="c-box" class="hidden">
              <p style="margin: 10px 0">
                <strong>العنوان:</strong> <span id="cd-subject">—</span>
              </p>
              <p style="margin: 10px 0">
                <strong>المرسل:</strong> <span id="cd-user">—</span>
              </p>
              <p style="margin: 10px 0">
                <strong>الطلب:</strong> <span id="cd-kind">—</span>
              </p>
              <p style="margin: 10px 0">
                <strong>الحالة:</strong>
                <span id="cd-status" class="pill">—</span>
              </p>

              <div class="field">
                <label>سجل الرسائل</label>
                <div
                  id="cd-thread"
                  style="
                    border: 1px solid rgba(229, 231, 235, 0.2);
                    border-radius: 8px;
                    padding: 16px;
                    max-height: 340px;
                    overflow: auto;
                    background: rgba(0, 0, 0, 0.02);
                  "
                ></div>
              </div>

              <div class="field">
                <label>تغيير الحالة</label>
                <select id="cd-next">
                  <option value="">لا تغيير</option>
                  <option value="in_progress">قيد المعالجة</option>
                  <option value="resolved">مغلقة</option>
                  <option value="rejected">مرفوضة</option>
                </select>
              </div>

              <div class="field">
                <label>الرد على المرسل</label>
                <textarea
                  id="cd-reply"
                  rows="4"
                  placeholder="اكتب الرد هنا…"
                ></textarea>
              </div>

              <div class="actions-row">
                <button class="btn primary" id="cd-send">إرسال الرد</button>
                <span id="cd-statusmsg" class="muted"></span>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <div id="footer" data-component="components/footer.html"></div>

    <div class="toast" id="toast"></div>

    <!-- Auth0 SDK -->
    <script
      src="https://cdn.auth0.com/js/auth0-spa-js/2.1/auth0-spa-js.production.js"
      onerror="this.onerror=null;this.src='/assets/vendor/auth0-spa-js.production.js'"
    ></script>

    <!-- Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="assets/js/supabase-client.js"></script>

    <!-- الحارس العام -->
    <script src="assets/js/require-auth.js"></script>
    <!-- Componnet Loader -->
    <script src="assets/js/component-loader.js"></script>
    <script src="assets/js/navbar.js"></script>

    <!-- moment + hijri -->
    <script src="https://cdn.jsdelivr.net/npm/moment@2.30.1/min/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment-hijri@2.3.1/moment-hijri.js"></script>

    <!-- سكربت عام (ثيم/أزرار) -->
    <script src="app.js"></script>
    <script src="assets/js/admin.js"></script>
  </body>
</html>
