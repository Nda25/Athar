<!-- admin.html -->
<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>لوحة الإدارة — أثر</title>
    <link rel="icon" type="image/x-icon" href="assets/icons/favicon.ico" />
    <link rel="shortcut icon" href="assets/icons/favicon.ico" />
    <link rel="apple-touch-icon" href="assets/icons/logo.png" />
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
    <meta name="color-scheme" content="dark light" />
    <style>
      .card {
        margin: 16px 0;
      }
      .grid {
        display: grid;
        gap: 12px;
        grid-template-columns: 1fr;
      }
      @media (min-width: 1100px) {
        .grid-2 {
          grid-template-columns: 1fr 1fr;
        }
        .grid-3 {
          grid-template-columns: 1fr 1fr 1fr;
        }
      }
      .field {
        margin: 10px 0;
      }
      .field label {
        display: block;
        font-weight: 700;
        margin: 6px 0;
      }
      .field input,
      .field select,
      .field textarea {
        width: 100%;
        padding: 12px;
        border-radius: 12px;
        border: 1px solid rgba(59, 130, 246, 0.35);
      }
      .muted {
        opacity: 0.8;
      }
      .actions-row {
        margin-top: 8px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .pill {
        background: rgba(59, 130, 246, 0.12);
        padding: 2px 8px;
        border-radius: 999px;
      }
      .table {
        width: 100%;
        border-collapse: collapse;
      }
      .table th,
      .table td {
        padding: 10px;
        border-bottom: 1px solid #e5e7eb33;
        vertical-align: top;
      }
      .table th {
        text-align: right;
        font-weight: 700;
      }
      .status-new {
        background: #fef9c3;
        color: #713f12;
      }
      .status-in_progress {
        background: #e0f2fe;
        color: #0c4a6e;
      }
      .status-resolved {
        background: #dcfce7;
        color: #14532d;
      }
      .status-rejected {
        background: #fee2e2;
        color: #7f1d1d;
      }
      .toolbar {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        align-items: center;
      }
      .hidden {
        display: none;
      }
      .mini-actions {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
      }
      .btn.sm {
        padding: 6px 10px;
        font-size: 12px;
      }
      .nowrap {
        white-space: nowrap;
      }
    </style>
  </head>
  <body>
    <div id="navbar" data-component="components/navbar.html"></div>

    <div class="user"><span class="muted" id="whoami"></span></div>

    <header>
      <div class="hero">
        <h1 class="logo">لوحة التحكم لأحلى ندو</h1>
        <div class="tag">
          <span class="dot"></span>أحلى مصممة يرامج بالعالم ، ملكة أثر
        </div>
      </div>
    </header>

    <main class="container">
      <!-- الوصول مرفوض -->
      <section class="card" id="denyCard" style="display: none">
        <h2 class="title">الوصول مرفوض</h2>
        <p>هذه الصفحة للمشرفين فقط.</p>
      </section>

      <!-- تبويبات -->
      <section class="card" id="tabsCard" style="display: none">
        <div class="actions-row" style="gap: 6px">
          <button class="btn" data-tab="t-activate">التفعيل اليدوي</button>
          <button class="btn" data-tab="t-ann">الإعلانات</button>
          <button class="btn" data-tab="t-complaints">
            الشكاوى والاقتراحات
          </button>
          <button class="btn primary" data-tab="t-users">
            المشتركون الجدد
          </button>
        </div>
      </section>

      <!-- التفعيل -->
      <section class="card" id="t-activate" style="display: none">
        <h2 class="title">التفعيل اليدوي للاشتراك</h2>
        <div class="grid grid-3">
          <div class="field">
            <label>البريد الإلكتروني للمستخدم</label>
            <input
              id="act-email"
              type="email"
              placeholder="example@email.com"
            />
          </div>
          <div class="field">
            <label>UID (اختياري)</label>
            <input
              id="act-userid"
              type="text"
              placeholder="Auth0 sub إن كان متاحًا"
            />
          </div>
          <div class="field">
            <label>المدّة</label>
            <div style="display: flex; gap: 8px; align-items: center">
              <input
                id="act-amount"
                type="number"
                min="1"
                value="12"
                style="max-width: 120px"
              />
              <select id="act-unit" style="max-width: 140px">
                <option value="months" selected>شهر/أشهر</option>
                <option value="days">يوم/أيام</option>
                <option value="years">سنة/سنوات</option>
              </select>
            </div>
          </div>
          <div class="field" style="grid-column: 1/-1">
            <label>ملاحظة (اختياري)</label>
            <input id="act-note" type="text" placeholder="سبب/مرجع" />
          </div>
        </div>
        <div class="actions-row">
          <button class="btn primary" id="btn-activate">تفعيل/تمديد</button>
          <span id="act-status" class="muted"></span>
        </div>
      </section>

      <!-- الإعلانات -->
      <section class="card" id="t-ann" style="display: none">
        <h2 class="title">إعلان عام</h2>
        <div class="field">
          <label>نص الإعلان</label>
          <textarea
            id="ann-text"
            rows="3"
            placeholder="سيظهر لمستخدمي الموقع"
          ></textarea>
        </div>

        <div class="grid grid-3">
          <div class="field">
            <label>الحالة</label>
            <select id="ann-active">
              <option value="true" selected>مُفعّل</option>
              <option value="false">موقّف</option>
            </select>
          </div>

          <div class="field">
            <label>تاريخ البدء (اختياري)</label>
            <div
              style="
                display: flex;
                gap: 8px;
                align-items: center;
                flex-wrap: wrap;
              "
            >
              <select id="ann-start-cal" style="max-width: 140px">
                <option value="greg" selected>ميلادي</option>
                <option value="hijri">هجري</option>
              </select>
              <input id="ann-start-g" type="date" />
              <input
                id="ann-start-h"
                type="text"
                inputmode="numeric"
                placeholder="مثال: 1447-02-10"
                style="display: none"
              />
            </div>
          </div>

          <div class="field">
            <label>تاريخ الانتهاء (اختياري)</label>
            <div
              style="
                display: flex;
                gap: 8px;
                align-items: center;
                flex-wrap: wrap;
              "
            >
              <select id="ann-end-cal" style="max-width: 140px">
                <option value="greg" selected>ميلادي</option>
                <option value="hijri">هجري</option>
              </select>
              <input id="ann-end-g" type="date" />
              <input
                id="ann-end-h"
                type="text"
                inputmode="numeric"
                placeholder="مثال: 1447-02-15"
                style="display: none"
              />
            </div>
          </div>
        </div>

        <div class="actions-row">
          <button class="btn" id="btn-publish">نشر/تحديث</button>
          <span id="ann-status" class="muted"></span>
        </div>

        <div class="card" style="margin-top: 14px">
          <h3 class="title" style="margin: 0 0 8px">الإعلانات</h3>
          <div id="ann-current" class="muted" style="margin-bottom: 8px">—</div>
          <div
            id="ann-list"
            class="grid"
            style="grid-template-columns: 1fr"
          ></div>
        </div>
      </section>

      <!-- الشكاوى والاقتراحات -->
      <section class="card" id="t-complaints" style="display: none">
        <h2 class="title">الشكاوى والاقتراحات</h2>

        <div class="toolbar">
          <select id="c-type">
            <option value="">الكل</option>
            <option value="complaint">شكاوى</option>
            <option value="suggestion">اقتراحات</option>
          </select>

          <select id="c-status">
            <option value="">كل الحالات</option>
            <option value="new">جديدة</option>
            <option value="in_progress">قيد المعالجة</option>
            <option value="resolved">مغلقة</option>
            <option value="rejected">مرفوضة</option>
          </select>

          <input
            id="c-q"
            type="search"
            placeholder="بحث (عنوان/نص/إيميل)"
            style="flex: 1; min-width: 200px"
          />
          <button class="btn" id="c-refresh">تحديث</button>
        </div>

        <div class="grid grid-2" style="margin-top: 12px">
          <div class="card">
            <table class="table" id="c-table">
              <thead>
                <tr>
                  <th>العنوان</th>
                  <th>المرسل</th>
                  <th>النوع</th>
                  <th>الحالة</th>
                  <th>التاريخ</th>
                </tr>
              </thead>
              <tbody id="c-rows">
                <tr>
                  <td colspan="5" class="muted">—</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="card" id="c-detail">
            <h3 style="margin-top: 0">التفاصيل</h3>
            <div id="c-empty" class="muted">اختر عنصرًا من القائمة…</div>

            <div id="c-box" class="hidden">
              <p><strong>العنوان:</strong> <span id="cd-subject">—</span></p>
              <p><strong>المرسل:</strong> <span id="cd-user">—</span></p>
              <p><strong>الطلب:</strong> <span id="cd-kind">—</span></p>
              <p>
                <strong>الحالة:</strong>
                <span id="cd-status" class="pill">—</span>
              </p>
              <div class="field">
                <label>سجل الرسائل</label>
                <div
                  id="cd-thread"
                  style="
                    border: 1px solid #e5e7eb33;
                    border-radius: 10px;
                    padding: 10px;
                    max-height: 340px;
                    overflow: auto;
                  "
                ></div>
              </div>

              <div class="grid">
                <div class="field">
                  <label>تغيير الحالة</label>
                  <select id="cd-next">
                    <option value="">لا تغيير</option>
                    <option value="in_progress">قيد المعالجة</option>
                    <option value="resolved">مغلقة</option>
                    <option value="rejected">مرفوضة</option>
                  </select>
                </div>
              </div>

              <div class="field">
                <label>الرد على المرسل</label>
                <textarea
                  id="cd-reply"
                  rows="4"
                  placeholder="اكتب الرد هنا…"
                ></textarea>
              </div>
              <div class="actions-row">
                <button class="btn primary" id="cd-send">إرسال الرد</button>
                <span id="cd-statusmsg" class="muted"></span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- المشتركون الجدد -->
      <section class="card" id="t-users" style="display: none">
        <h2 class="title">المشتركون الجدد</h2>
        <div class="toolbar">
          <input
            id="u-q"
            type="search"
            placeholder="بحث (اسم/إيميل)"
            style="flex: 1; min-width: 200px"
          />
          <select id="u-active">
            <option value="">الكل</option>
            <option value="true">نشط</option>
            <option value="false">غير نشط</option>
          </select>
          <button class="btn" id="u-refresh">تحديث</button>
        </div>

        <div class="card" style="margin-top: 10px">
          <table class="table">
            <thead>
              <tr>
                <th>المستخدم</th>
                <th>الإيميل</th>
                <th>انضمّ</th>
                <th>الحالة</th>
                <th>ينتهي</th>
                <th class="nowrap">تفعيل سريع</th>
              </tr>
            </thead>
            <tbody id="u-rows">
              <tr>
                <td colspan="6" class="muted">—</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
    </main>

    <div id="footer" data-component="components/footer.html"></div>

    <div class="toast" id="toast"></div>

    <!-- Auth0 SDK -->
    <script
      src="https://cdn.auth0.com/js/auth0-spa-js/2.1/auth0-spa-js.production.js"
      onerror="this.onerror=null;this.src='/assets/vendor/auth0-spa-js.production.js'"
    ></script>

    <!-- Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="assets/js/supabase-client.js"></script>

    <!-- الحارس العام -->
    <script src="assets/js/require-auth.js"></script>
    <!-- Componnet Loader -->
    <script src="assets/js/component-loader.js"></script>
    <script src="assets/js/navbar.js"></script>

    <!-- moment + hijri -->
    <script src="https://cdn.jsdelivr.net/npm/moment@2.30.1/min/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment-hijri@2.3.1/moment-hijri.js"></script>

    <!-- سكربت عام (ثيم/أزرار) -->
    <script src="app.js"></script>

    <script src="assets/js/admin.js"></script>
  </body>
</html>
