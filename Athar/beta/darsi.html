<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>مُـرتكـز</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Cairo:wght@700&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="style.css" />
    <meta name="color-scheme" content="dark light" />
    <link rel="stylesheet" href="assets/css/darsi.css" />
  </head>
  <body>
    <div class="global-bg"></div>

    <!-- Navbar -->
    <div id="navbar" data-component="components/navbar.html"></div>

    <!-- Header -->
    <header>
      <div class="hero">
        <div class="brand-row">
          <h1 class="brand-name">مُـرتكز</h1>
        </div>
        <div class="tag">
          <span class="dot"></span>أســاسٌ عميق.. يُرسـِّخ الأثـَـر.
        </div>
      </div>
    </header>

    <main>
      <div class="container">
        <!-- المدخلات (قابلة للطي) -->
        <section class="card inputs-wrap" id="inputs">
          <div class="inputs-head">
            <h2 class="title" style="margin: 0">مدخلات الخطة</h2>
            <button class="btn" id="toggleInputs">إخفاء المدخلات</button>
          </div>

          <div class="inputs-body">
            <div class="cols-3">
              <div class="field">
                <label>نمط الإدخال</label>
                <select id="f-mode">
                  <option value="topic" selected>موضوع مختصر</option>
                  <option value="text">نص للتحليل</option>
                </select>
                <div class="muted-mini">
                  “نص للتحليل” يستنتج مستوى بلوم تلقائيًا.
                </div>
              </div>

              <div class="field">
                <label>الفئة العُمريّة</label>
                <select id="f-age">
                  <option value="p1">ابتدائي دُنيا</option>
                  <option value="p2" selected>ابتدائي عُليا</option>
                  <option value="m">متوسط</option>
                  <option value="h">ثانوي</option>
                </select>
              </div>

              <div class="field">
                <label>زمن الحصة (دقيقة)</label>
                <input
                  id="f-duration"
                  type="number"
                  min="15"
                  max="90"
                  step="5"
                  value="45"
                />
              </div>
            </div>

            <div class="cols-2" id="mode-topic">
              <div class="field">
                <label>المادة</label>
                <input
                  id="f-subject"
                  placeholder="رياضيات / علوم / لغة عربية …"
                />
              </div>
              <div class="field">
                <label>الموضوع</label>
                <input
                  id="f-topic"
                  placeholder="الكسور / دورة حياة النبات / المبتدأ والخبر …"
                />
              </div>
            </div>

            <div class="field" id="mode-text" style="display: none">
              <label>النص للتحليل</label>
              <textarea
                id="f-text"
                rows="5"
                placeholder="ألصقي فقرة من المصدر… (سنستنتج الأهداف ومستوى بلوم)"
              ></textarea>
            </div>

            <div class="cols-2">
              <div class="field">
                <label>مستوى بلوم الأساسي</label>
                <select id="f-bloom-main">
                  <option value="remember">تذكر</option>
                  <option value="understand" selected>فهم</option>
                  <option value="apply">تطبيق</option>
                  <option value="analyze">تحليل</option>
                  <option value="evaluate">تقويم</option>
                  <option value="create">إبداع</option>
                </select>
                <div class="muted-mini">قد يتغيّر تلقائيًا بعد التحليل.</div>
              </div>
              <div class="field">
                <label>مستوى بلوم الداعم (+2)</label>
                <select id="f-bloom-support">
                  <option value="">(اختياري)</option>
                  <option value="remember">تذكر</option>
                  <option value="understand">فهم</option>
                  <option value="apply" selected>تطبيق</option>
                  <option value="analyze">تحليل</option>
                  <option value="evaluate">تقويم</option>
                  <option value="create">إبداع</option>
                </select>
              </div>
            </div>

            <div class="cols-2">
              <div class="field">
                <label>عدد الأهداف</label>
                <select id="f-goal-count">
                  <option>1</option>
                  <option selected>2</option>
                  <option>3</option>
                </select>
              </div>
              <div class="field">
                <label>ملاحظات خاصة (اختياري)</label>
                <input id="f-notes" placeholder="قيود صفية، أدوات متاحة…" />
              </div>
            </div>

            <div class="cols-2">
              <div class="field">
                <label>التعلم التكيفي</label>
                <select id="f-adapt">
                  <option value="off" selected>بدون اختبار قبلي</option>
                  <option value="on">فعّل اختبار قبلي (3 أسئلة)</option>
                </select>
              </div>
              <div class="field">
                <label>تقدير أولي لمستوى الصف</label>
                <select id="f-level">
                  <option value="mixed" selected>متفاوت</option>
                  <option value="low">يحتاج دعم</option>
                  <option value="high">متقدم</option>
                </select>
              </div>
            </div>

            <!-- صف الأزرار الأساسي (تحليل + توليد) -->
            <div class="row-actions">
              <button class="btn" id="btn-analyze">تحليل المحتوى</button>
              <button class="btn primary" id="btn-generate">
                ولّد لي الخطة ✨
              </button>
            </div>
          </div>
        </section>

        <!-- الاختبار القبلي (يظهر فقط عند التفعيل) -->
        <section class="card" id="pre-quiz" style="display: none">
          <h2 class="title">اختبار قبلي سريع (3 أسئلة)</h2>
          <p class="lead">
            أدخل **عدد المخطئين** (من أصل عدد الطلبة) لكل سؤال، ثم اضغط “تطبيق
            التكيّف”.
          </p>
          <div class="cols-3" id="quizWrap"></div>
          <div class="row-actions">
            <button class="btn primary" id="btn-adapt-apply">
              تطبيق التكيّف
            </button>
          </div>
        </section>

        <!-- أزرار ما بعد التوليد -->
        <section class="card" id="post-actions" style="display: none">
          <div class="row-actions">
            <button class="btn" id="btn-copy-full">نسخ الخطة كاملة</button>
            <button class="btn" id="btn-classroom">
              نسخ كقالب Google Classroom
            </button>
            <button class="btn" id="btn-teams">
              نسخ لقالب Microsoft Teams
            </button>
            <button class="btn" id="btn-print">طباعة</button>
            <button class="btn" id="toggleInputs2">إظهار/إخفاء مدخلاتي</button>
          </div>
        </section>

        <!-- المخرجات -->
        <section class="card" id="out-summary" style="display: none">
          <h2 class="title">ملخص سريع</h2>
          <p class="lead" id="out-head">—</p>
          <div
            id="out-adapt"
            class="hl"
            style="display: none; margin-top: 8px"
          ></div>
          <ul class="list" id="out-bullets" style="margin-top: 8px"></ul>
          <div style="margin-top: 8px">
            <span class="pill" id="pill-main"></span>
            <span class="pill" id="pill-sup" style="display: none"></span>
            <span class="pill" id="pill-age"></span>
          </div>
        </section>

        <section class="grid" id="out-grid" style="display: none">
          <div class="box">
            <h3>مخطط الدرس (قبل / أثناء / بعد)</h3>
            <ul class="list" id="out-structure"></ul>
          </div>
          <div class="box">
            <h3>أنشطة ملائمة للعمر و(بلوم)</h3>
            <ol class="list" id="out-activities"></ol>
          </div>
          <div class="box">
            <h3>تقويم سريع متدرّج</h3>
            <ol class="list" id="out-assessment"></ol>
          </div>
          <div class="box">
            <h3>تمايز: دعم وإثراء</h3>
            <ul class="list" id="out-diff"></ul>
          </div>
        </section>

        <section class="card" id="out-goals" style="display: none">
          <h2 class="title">بطاقة أهداف (جاهزة للطباعة)</h2>
          <div class="printable" id="goalsCard">
            <h3 style="margin: 0 0 6px">
              أهداف الدرس: <span id="goalsTitleOut">—</span>
            </h3>
            <ul id="goalsList" class="list" style="margin: 0"></ul>
            <p style="margin-top: 6px">
              <strong>معايير النجاح:</strong> <span id="successOut">—</span>
            </p>
          </div>
          <div class="mini-actions">
            <button class="btn" id="btn-goals-copy">نسخ بطاقة الأهداف</button>
            <button class="btn" id="btn-goals-print">طباعة البطاقة</button>
          </div>
        </section>

        <section class="card" id="out-onemin" style="display: none">
          <h2 class="title">خطة الدقيقة الواحدة</h2>
          <div class="printable" id="oneMinCard">
            <h3 style="margin: 0 0 6px">الدقيقة الواحدة</h3>
            <div id="oneMinText" class="muted">—</div>
          </div>
        </section>

        <section class="card" id="out-ladder" style="display: none">
          <h2 class="title">سلم تقدير مبسّط (للطلاب)</h2>
          <div class="ladder" id="ladderWrap"></div>
        </section>
      </div>
    </main>

    <!-- Load shared footer component -->
    <div id="footer" data-component="components/footer.html"></div>

    <script>
      // سنة تلقائية في الفوتر
      (function waitSetYear(attempts) {
        attempts = attempts || 0;
        var el = document.getElementById("year");
        if (el) {
          el.textContent = new Date().getFullYear();
          return;
        }
        if (attempts < 50)
          setTimeout(function () {
            waitSetYear(attempts + 1);
          }, 100);
      })();
    </script>

    <div class="toast" id="toast"></div>

    <!-- سكربت عام المشروع -->
    <script defer src="app.js"></script>

    <!-- js files related to the page -->
    <script src="assets/js/darsi/darsi.js"></script>
    <script src="assets/js/darsi/darsi_ensure_auth.js"></script>

    <!-- Supabase -->
    <script defer src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script defer src="/assets/js/supabase-client.js"></script>

    <!-- Auth0 SDK -->
    <script
      defer
      src="https://cdn.auth0.com/js/auth0-spa-js/2/auth0-spa-js.production.js"
      onerror="this.onerror=null;this.src='/assets/vendor/auth0-spa-js.production.js'"
    ></script>
    <!-- Component loader + navbar behavior -->
    <script src="assets/js/component-loader.js"></script>
    <script src="assets/js/navbar.js"></script>
    <!-- حماية الصفحة -->
    <script defer src="/assets/js/require-auth.js"></script>
  </body>
</html>
