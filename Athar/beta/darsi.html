<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title> Ù…ÙÙ€Ø±ØªÙƒÙ€Ø²</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Amiri:wght@700&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="style.css" />
<meta name="color-scheme" content="dark light">
<style>
  /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø®ÙÙŠÙØ© ÙÙˆÙ‚ style.css â€” ÙƒÙ„Ù‡Ø§ Ù…ØªÙˆØ§ÙÙ‚Ø© Ù…Ø¹ Ù…ØªØºÙŠØ±Ø§ØªÙƒ */
  .field{ margin:10px 0 }
  .field label{ display:block; font-weight:700; margin:6px 0 }
  .field input,.field textarea,.field select{
    width:100%; padding:12px; border-radius:12px;
    border:1px solid rgba(59,130,246,.35); background:#fff; color:#0f172a;
  }
  .dark .field input,.dark .field textarea,.dark .field select{
    background:#0f172a; color:#f1f5f9; border-color:#3b82f6;
  }
  .muted-mini{ font-size:13px; opacity:.85 }
  .cols-2{ display:grid; gap:12px; grid-template-columns:1fr }
  .cols-3{ display:grid; gap:12px; grid-template-columns:1fr }
  @media(min-width:800px){
    .cols-2{ grid-template-columns:1fr 1fr }
    .cols-3{ grid-template-columns:1fr 1fr 1fr }
  }
  .row-actions{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:flex-start; margin-top:8px }
  .row-actions .btn{ min-width:180px }

  .printable{
    border:1px dashed rgba(59,130,246,.35); border-radius:12px; padding:14px; margin-top:8px;
    background:rgba(255,255,255,.5)
  }
  .dark .printable{ background:rgba(17,24,39,.35) }
  .list{ margin:0; padding-inline-start:1.2rem }
  .hl{ background:linear-gradient(90deg,#e6f2ff80,#ffffff00); border-radius:8px; padding:6px 8px }
  .pill{ display:inline-block; padding:.28rem .65rem; border-radius:999px; background:var(--sea-100); color:#0c4a6e; border:1px solid rgba(59,130,246,.25); font-size:.82rem }
  .dark .pill{ background:#0f172a; color:#e2e8f0; border-color:#3b82f6 }

  /* â€œØ³Ù„Ù… ØªÙ‚Ø¯ÙŠØ± Ù…Ø¨Ø³Ù‘Ø·â€ Ø¨Ø¯Ù„ Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠØ© */
  .ladder{ display:grid; gap:8px; margin-top:10px }
  .ladder .step{
    display:grid; gap:8px; grid-template-columns:120px 1fr;
    border:1px solid rgba(59,130,246,.22); border-radius:12px; padding:10px; background:var(--card);
  }
  .ladder .tag{ font-weight:800; text-align:center; align-self:center; padding:6px 10px; border-radius:999px; border:1px solid rgba(59,130,246,.25) }
  .ladder .ok{ background:#dcfce7; color:#166534; border-color:#bbf7d0 }
  .ladder .mid{ background:#fffbeb; color:#92400e; border-color:#fde68a }
  .ladder .need{ background:#fee2e2; color:#991b1b; border-color:#fecaca }

  /* â€œÙ…Ø¯Ø®Ù„Ø§ØªÙŠâ€ (Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø·ÙŠÙ‘) */
  .inputs-wrap.collapsed .inputs-body{ display:none }
  .inputs-wrap .inputs-head{
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    border-bottom:1px solid rgba(59,130,246,.15); padding-bottom:8px; margin-bottom:10px
  }

  /* Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©: Ø£Ø®ÙÙŠ Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… ÙˆÙƒÙ„ Ù…Ø§ Ù„Ø§ ÙŠÙ„Ø²Ù… */
  @media print{
    .topbar,.tag,.row-actions,.inputs-wrap,.btn,.toast{ display:none !important }
    header{ padding-bottom:0 }
    main{ padding-top:0 }
    .card{ box-shadow:none; border:none }
  .logo {
    font-family: 'Amiri', serif;
    font-weight: 700;
    font-size: 2.8rem;
    letter-spacing: 1px;
    margin: 0;
  }
</style>
</head>
<body>
  <!-- Ø®Ù„ÙÙŠØ§Øª -->
  <div class="backdrop"></div>
  <div class="pattern"></div>

  <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ (Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„Ø®Ø·Ø·) -->
  <div class="topbar">
    <div class="left-actions">
      <a class="btn" href="index.html" title="Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>

    </div>
    <div class="actions">
      <button class="btn" id="themeToggle" title="Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†/Ø§Ù„ÙØ§ØªØ­">ğŸŒ“</button>
    </div>
    <div class="user">
      <span id="nav-auth" style="display:none; gap:10px">
        <a class="btn" href="#" onclick="openModal('#modal-register');return false;">ØªØ³Ø¬ÙŠÙ„</a>
        <a class="btn" href="#" onclick="openModal('#modal-login');return false;">Ø¯Ø®ÙˆÙ„</a>
      </span>
      <a id="nav-programs" class="btn" href="programs.html" style="display:inline-flex">Ù…Ø³Ø§Ø­Ø© Ø¥Ø¨Ø¯Ø§Ø¹ÙŠ</a>
      <a id="nav-profile" class="btn" href="profile.html" style="display:none">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</a>
    </div>
  </div>

  <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
  <header>
    <div class="hero">
      <h1 class="logo">Ù…ÙÙ€Ø±ØªÙ€Ù€ÙƒØ²</h1>
      <div class="tag"><span class="dot"></span>Ø£Ø³Ù€Ù€Ø§Ø³ÙŒ Ø¹Ù…ÙŠÙ‚.. ÙŠÙØ±Ø³Ù€Ù‘ÙØ® Ø§Ù„Ø£Ø«Ù€ÙÙ€Ø±.</div>
    </div>
  
  </header>

  <main>
    <div class="container">

      <!-- Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª (Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø·ÙŠ) -->
      <section class="card inputs-wrap" id="inputs">
        <div class="inputs-head">
          <h2 class="title" style="margin:0">Ù…Ø¯Ø®Ù„Ø§Øª Ø§Ù„Ø®Ø·Ø©</h2>
          <button class="btn" id="toggleInputs">Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª</button>
        </div>

        <div class="inputs-body">
          <div class="cols-3">
            <div class="field">
              <label>Ù†Ù…Ø· Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„</label>
              <select id="f-mode">
                <option value="topic" selected>Ù…ÙˆØ¶ÙˆØ¹ Ù…Ø®ØªØµØ±</option>
                <option value="text">Ù†Øµ Ù„Ù„ØªØ­Ù„ÙŠÙ„</option>
              </select>
              <div class="muted-mini">â€œÙ†Øµ Ù„Ù„ØªØ­Ù„ÙŠÙ„â€ ÙŠØ³ØªÙ†ØªØ¬ Ù…Ø³ØªÙˆÙ‰ Ø¨Ù„ÙˆÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.</div>
            </div>

            <div class="field">
              <label>Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¹ÙÙ…Ø±ÙŠÙ‘Ø©</label>
              <select id="f-age">
                <option value="p1">Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ Ø¯ÙÙ†ÙŠØ§ </option>
                <option value="p2" selected>Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ Ø¹ÙÙ„ÙŠØ§</option>
                <option value="m">Ù…ØªÙˆØ³Ø·</option>
                <option value="h">Ø«Ø§Ù†ÙˆÙŠ</option>
              </select>
            </div>

            <div class="field">
              <label>Ø²Ù…Ù† Ø§Ù„Ø­ØµØ© (Ø¯Ù‚ÙŠÙ‚Ø©)</label>
              <input id="f-duration" type="number" min="15" max="90" step="5" value="45">
            </div>
          </div>

          <div class="cols-2" id="mode-topic">
            <div class="field">
              <label>Ø§Ù„Ù…Ø§Ø¯Ø©</label>
              <input id="f-subject" placeholder="Ø±ÙŠØ§Ø¶ÙŠØ§Øª / Ø¹Ù„ÙˆÙ… / Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ© â€¦">
            </div>
            <div class="field">
              <label>Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</label>
              <input id="f-topic" placeholder="Ø§Ù„ÙƒØ³ÙˆØ± / Ø¯ÙˆØ±Ø© Ø­ÙŠØ§Ø© Ø§Ù„Ù†Ø¨Ø§Øª / Ø§Ù„Ù…Ø¨ØªØ¯Ø£ ÙˆØ§Ù„Ø®Ø¨Ø± â€¦">
            </div>
          </div>

          <div class="field" id="mode-text" style="display:none">
            <label>Ø§Ù„Ù†Øµ Ù„Ù„ØªØ­Ù„ÙŠÙ„</label>
            <textarea id="f-text" rows="5" placeholder="Ø£Ù„ØµÙ‚ÙŠ ÙÙ‚Ø±Ø© Ù…Ù† Ø§Ù„Ù…ØµØ¯Ø±â€¦ (Ø³Ù†Ø³ØªÙ†ØªØ¬ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù ÙˆÙ…Ø³ØªÙˆÙ‰ Ø¨Ù„ÙˆÙ…)"></textarea>
          </div>

          <div class="cols-2">
            <div class="field">
              <label>Ù…Ø³ØªÙˆÙ‰ Ø¨Ù„ÙˆÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</label>
              <select id="f-bloom-main">
                <option value="remember">ØªØ°ÙƒØ±</option>
                <option value="understand" selected>ÙÙ‡Ù…</option>
                <option value="apply">ØªØ·Ø¨ÙŠÙ‚</option>
                <option value="analyze">ØªØ­Ù„ÙŠÙ„</option>
                <option value="evaluate">ØªÙ‚ÙˆÙŠÙ…</option>
                <option value="create">Ø¥Ø¨Ø¯Ø§Ø¹</option>
              </select>
              <div class="muted-mini">Ù‚Ø¯ ÙŠØªØºÙŠÙ‘Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù„ÙŠÙ„.</div>
            </div>
            <div class="field">
              <label>Ù…Ø³ØªÙˆÙ‰ Ø¨Ù„ÙˆÙ… Ø§Ù„Ø¯Ø§Ø¹Ù… (+2)</label>
              <select id="f-bloom-support">
                <option value="">(Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</option>
                <option value="remember">ØªØ°ÙƒØ±</option>
                <option value="understand">ÙÙ‡Ù…</option>
                <option value="apply" selected>ØªØ·Ø¨ÙŠÙ‚</option>
                <option value="analyze">ØªØ­Ù„ÙŠÙ„</option>
                <option value="evaluate">ØªÙ‚ÙˆÙŠÙ…</option>
                <option value="create">Ø¥Ø¨Ø¯Ø§Ø¹</option>
              </select>
            </div>
          </div>

          <div class="cols-2">
            <div class="field">
              <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù</label>
              <select id="f-goal-count"><option>1</option><option selected>2</option><option>3</option></select>
            </div>
            <div class="field">
              <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø®Ø§ØµØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
              <input id="f-notes" placeholder="Ù‚ÙŠÙˆØ¯ ØµÙÙŠØ©ØŒ Ø£Ø¯ÙˆØ§Øª Ù…ØªØ§Ø­Ø©â€¦">
            </div>
          </div>

          <div class="cols-2">
            <div class="field">
              <label>Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„ØªÙƒÙŠÙÙŠ</label>
              <select id="f-adapt">
                <option value="off" selected>Ø¨Ø¯ÙˆÙ† Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø¨Ù„ÙŠ</option>
                <option value="on">ÙØ¹Ù‘Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø¨Ù„ÙŠ (3 Ø£Ø³Ø¦Ù„Ø©)</option>
              </select>
            </div>
            <div class="field">
              <label>ØªÙ‚Ø¯ÙŠØ± Ø£ÙˆÙ„ÙŠ Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙ</label>
              <select id="f-level">
                <option value="mixed" selected>Ù…ØªÙØ§ÙˆØª</option>
                <option value="low">ÙŠØ­ØªØ§Ø¬ Ø¯Ø¹Ù…</option>
                <option value="high">Ù…ØªÙ‚Ø¯Ù…</option>
              </select>
            </div>
          </div>

          <!-- ØµÙ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (ØªØ­Ù„ÙŠÙ„ + ØªÙˆÙ„ÙŠØ¯) -->
          <div class="row-actions">
            <button class="btn" id="btn-analyze">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</button>
            <button class="btn primary" id="btn-generate">ÙˆÙ„Ù‘Ø¯ Ù„ÙŠ Ø§Ù„Ø®Ø·Ø© âœ¨</button>
          </div>
        </div>
      </section>

      <!-- Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù‚Ø¨Ù„ÙŠ (ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ¹ÙŠÙ„) -->
      <section class="card" id="pre-quiz" style="display:none">
        <h2 class="title">Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø¨Ù„ÙŠ Ø³Ø±ÙŠØ¹ (3 Ø£Ø³Ø¦Ù„Ø©)</h2>
        <p class="lead">Ø£Ø¯Ø®Ù„ **Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø®Ø·Ø¦ÙŠÙ†** (Ù…Ù† Ø£ØµÙ„ Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø©) Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„ØŒ Ø«Ù… Ø§Ø¶ØºØ· â€œØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙƒÙŠÙ‘Ùâ€.</p>
        <div class="cols-3" id="quizWrap"></div>
        <div class="row-actions">
          <button class="btn primary" id="btn-adapt-apply">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙƒÙŠÙ‘Ù</button>
        </div>
      </section>

      <!-- Ø£Ø²Ø±Ø§Ø± Ù…Ø§ Ø¨Ø¹Ø¯ Ø§Ù„ØªÙˆÙ„ÙŠØ¯ -->
      <section class="card" id="post-actions" style="display:none">
        <div class="row-actions">
          <button class="btn" id="btn-copy-full">Ù†Ø³Ø® Ø§Ù„Ø®Ø·Ø© ÙƒØ§Ù…Ù„Ø©</button>
          <button class="btn" id="btn-classroom">Ù†Ø³Ø® ÙƒÙ‚Ø§Ù„Ø¨ Google Classroom</button>
          <button class="btn" id="btn-teams">Ù†Ø³Ø® Ù„Ù‚Ø§Ù„Ø¨ Microsoft Teams</button>
          <button class="btn" id="btn-print">Ø·Ø¨Ø§Ø¹Ø©</button>
          <button class="btn" id="toggleInputs2">Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù…Ø¯Ø®Ù„Ø§ØªÙŠ</button>
        </div>
      </section>

      <!-- Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª -->
      <section class="card" id="out-summary" style="display:none">
        <h2 class="title">Ù…Ù„Ø®Øµ Ø³Ø±ÙŠØ¹</h2>
        <p class="lead" id="out-head">â€”</p>
        <div id="out-adapt" class="hl" style="display:none; margin-top:8px"></div>
        <ul class="list" id="out-bullets" style="margin-top:8px"></ul>
        <div style="margin-top:8px">
          <span class="pill" id="pill-main"></span>
          <span class="pill" id="pill-sup" style="display:none"></span>
          <span class="pill" id="pill-age"></span>
        </div>
      </section>

      <section class="grid" id="out-grid" style="display:none">
        <div class="box">
          <h3>Ù…Ø®Ø·Ø· Ø§Ù„Ø¯Ø±Ø³ (Ù‚Ø¨Ù„ / Ø£Ø«Ù†Ø§Ø¡ / Ø¨Ø¹Ø¯)</h3>
          <ul class="list" id="out-structure"></ul>
        </div>
        <div class="box">
          <h3>Ø£Ù†Ø´Ø·Ø© Ù…Ù„Ø§Ø¦Ù…Ø© Ù„Ù„Ø¹Ù…Ø± Ùˆ(Ø¨Ù„ÙˆÙ…)</h3>
          <ol class="list" id="out-activities"></ol>
        </div>
        <div class="box">
          <h3>ØªÙ‚ÙˆÙŠÙ… Ø³Ø±ÙŠØ¹ Ù…ØªØ¯Ø±Ù‘Ø¬</h3>
          <ol class="list" id="out-assessment"></ol>
        </div>
        <div class="box">
          <h3>ØªÙ…Ø§ÙŠØ²: Ø¯Ø¹Ù… ÙˆØ¥Ø«Ø±Ø§Ø¡</h3>
          <ul class="list" id="out-diff"></ul>
        </div>
      </section>

      <section class="card" id="out-goals" style="display:none">
        <h2 class="title">Ø¨Ø·Ø§Ù‚Ø© Ø£Ù‡Ø¯Ø§Ù (Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©)</h2>
        <div class="printable" id="goalsCard">
          <h3 style="margin:0 0 6px">Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø¯Ø±Ø³: <span id="goalsTitleOut">â€”</span></h3>
          <ul id="goalsList" class="list" style="margin:0"></ul>
          <p style="margin-top:6px"><strong>Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù†Ø¬Ø§Ø­:</strong> <span id="successOut">â€”</span></p>
        </div>
      </section>

      <section class="card" id="out-onemin" style="display:none">
        <h2 class="title">Ø®Ø·Ø© Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©</h2>
        <div class="printable" id="oneMinCard">
          <h3 style="margin:0 0 6px">Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©</h3>
          <div id="oneMinText" class="muted">â€”</div>
        </div>
      </section>

      <section class="card" id="out-ladder" style="display:none">
        <h2 class="title">Ø³Ù„Ù… ØªÙ‚Ø¯ÙŠØ± Ù…Ø¨Ø³Ù‘Ø· (Ù„Ù„Ø·Ù„Ø§Ø¨)</h2>
        <div class="ladder" id="ladderWrap">
          <!-- ÙŠÙØ¹Ø¨Ù‘Ø£ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ -->
        </div>
      </section>

    </div>
  </main>

  <footer>
    <p class="foot-line">Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø´Ø±Ø§Ø±Ø© ØµØºÙŠØ±Ø©â€¦ ØªÙØ¶ÙŠØ¡ Ø¹Ù‚ÙˆÙ„Ù‹Ø§ ÙƒØ¨ÙŠØ±Ø©.</p>
    <p class="foot-name">Ù†Ø¯Ù‰ Ø§Ù„Ù…Ø¬ÙŠØ±Ø´</p>
  </footer>

  <div class="toast" id="toast"></div>
  <script src="app.js"></script>
  <script>
    /* ===== Ù‚ÙˆØ§Ù…ÙŠØ³ ÙˆÙ…Ø¹ÙŠÙ†Ø§Øª ===== */
    const BLOOM_VERBS = {
      remember:['ÙŠØ¹Ø¯Ù‘Ø¯','ÙŠØ³Ù…Ù‘ÙŠ','ÙŠØ°ÙƒØ±','ÙŠØªØ¹Ø±Ù‘Ù'],
      understand:['ÙŠØ´Ø±Ø­','ÙŠÙ„Ø®Ù‘Øµ','ÙŠØ¹Ø·ÙŠ Ù…Ø«Ø§Ù„Ù‹Ø§','ÙŠÙØ³Ù‘Ø±','ÙŠØµÙ†Ù‘Ù'],
      apply:['ÙŠØ³ØªØ®Ø¯Ù…','ÙŠÙˆØ¸Ù‘Ù','ÙŠØ­Ù„Ù‘','ÙŠÙ†ÙÙ‘Ø°'],
      analyze:['ÙŠÙÙƒÙ‘Ùƒ','ÙŠÙ‚Ø§Ø±Ù†','ÙŠØ³ØªÙ†ØªØ¬','ÙŠØ±Ø¨Ø·','ÙŠØµÙ†Ù‘Ù Ø¨Ø¹Ù…Ù‚'],
      evaluate:['ÙŠØ¨Ø±Ù‘Ø±','ÙŠÙ†Ù‚Ø¯','ÙŠØ­ÙƒÙ…','ÙŠÙ‚ÙˆÙ‘Ù…'],
      create:['ÙŠØµÙ…Ù‘Ù…','ÙŠØ±ÙƒÙ‘Ø¨','ÙŠØ¨ØªÙƒØ±','ÙŠØ¤Ù„Ù']
    };
    const BLOOM_HINTS = {
      analyze:['Ø­Ù„Ù‘Ù„','Ø­Ù„Ù„','Ù‚Ø§Ø±Ù†','ÙØ±Ù‘Ù‚','Ø§Ø³ØªÙ†ØªØ¬','ØµÙ†Ù‘Ù','Ø±ØªÙ‘Ø¨'],
      evaluate:['Ù‚ÙŠÙ‘Ù…','Ø¨Ø±Ù‘Ø±','Ø§Ù†Ù‚Ø¯','Ø§Ø­ÙƒÙ…','Ù‚ÙˆÙ‘Ù…'],
      create:['ØµÙ…Ù‘Ù…','Ø§Ø¨ØªÙƒØ±','Ø±ÙƒÙ‘Ø¨','Ø£Ù„Ù‘Ù','Ø®Ø·Ù‘Ø·'],
      apply:['Ø·Ø¨Ù‘Ù‚','ÙˆØ¸Ù‘Ù','Ø§Ø³ØªØ®Ø¯Ù…','Ø­Ù„Ù‘','Ù†ÙÙ‘Ø°'],
      understand:['Ø§Ø´Ø±Ø­','Ù„Ø®Ù‘Øµ','Ù…Ø«Ø§Ù„','ÙØ³Ù‘Ø±','Ø¹Ø±Ù‘Ù'],
      remember:['Ø§Ø°ÙƒØ±','Ø¹Ø¯Ù‘Ø¯','Ø³Ù…ÙÙ‘','ØªØ¹Ø±Ù‘Ù']
    };
    const AGE_TEMPLATES = {
      p1:{before:['ØªÙ‡ÙŠØ¦Ø© Ø­Ø³Ù‘ÙŠØ© Ù‚ØµÙŠØ±Ø© (Ø¨Ø·Ø§Ù‚Ø§Øª/ØµÙˆØ±)','Ø³Ø¤Ø§Ù„ Ø¯Ø§ÙØ¦ Ø¨Ø³ÙŠØ·','ØªØ°ÙƒÙŠØ± Ù„Ø·ÙŠÙ Ø¨Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ØµÙ'],
          during:['Ù†Ø´Ø§Ø· Ø«Ù†Ø§Ø¦ÙŠ Ù‚ØµÙŠØ±','Ù„Ø¹Ø¨Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹','ØªÙÙƒÙŠØ± Ø¨ØµÙˆØª Ù…Ø³Ù…ÙˆØ¹'],
          after:['Ø±Ø³Ù… ÙŠØ¹Ø¨Ù‘Ø± Ø¹Ù† Ø§Ù„ÙÙƒØ±Ø©','ØªØ°ÙƒØ±Ø© Ø®Ø±ÙˆØ¬ Ø¨ÙƒÙ„Ù…Ø©/ØµÙˆØ±Ø©','Ø£ÙƒÙ…Ù„: â€œØªØ¹Ù„Ù‘Ù…Øª Ø§Ù„ÙŠÙˆÙ… Ø£Ù†â€¦â€']},
      p2:{before:['ØµÙˆØ±Ø©/Ù…Ù‚Ø·Ø¹ Ù‚ØµÙŠØ±','ØªÙ†Ø´ÙŠØ· Ø³Ø§Ø¨Ù‚ Ù…Ø¹Ø±ÙØ©','Ù‡Ø¯Ù Ø§Ù„ÙŠÙˆÙ… Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¨ÙˆØ±Ø©'],
          during:['Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ØµØºÙŠØ±Ø© Ø¨Ø£Ø¯ÙˆØ§Ø±','ØªØ¬Ø±Ø¨Ø© Ù…Ø¨Ø³Ø·Ø©','Ø¨Ø·Ø§Ù‚Ø© Ù…Ù‡Ù…Ø© Ø¨Ø®Ø·ÙˆØ§Øª ÙˆØ§Ø¶Ø­Ø©'],
          after:['ØªØ£Ù…Ù„ Ø³Ø±ÙŠØ¹: Ù…Ø§Ø°Ø§ Ø£ØªÙ‚Ù†ØŸ','Ù…Ù„Ø®Øµ Ù…Ù† 3 Ø£Ø³Ø·Ø±','Ø³Ø¤Ø§Ù„ Ø®ØªØ§Ù…ÙŠ']},
      m:{ before:['Ù…Ø´ÙƒÙ„Ø© Ù…Ø­ÙØ²Ø©','Ø®Ø±ÙŠØ·Ø© Ù…ÙØ§Ù‡ÙŠÙ… Ø®Ø§Ø·ÙØ©','Ø¥Ø·Ø§Ø± Ø§Ù„Ù†Ø¬Ø§Ø­'],
          during:['ØªØ¹Ù„Ù… ØªØ¹Ø§ÙˆÙ†ÙŠ','ØªØ­Ù‚ÙŠÙ‚/ØªØ¬Ø±Ø¨Ø© Ù‚ØµÙŠØ±Ø©','Ù…Ø³Ø§Ø¦Ù„ Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙŠØ§Øª'],
          after:['ØªØ°ÙƒØ±Ø© Ø®Ø±ÙˆØ¬ Ø¨Ù…Ø³ØªÙˆÙŠÙŠÙ†','Ø§Ù†Ø¹ÙƒØ§Ø³ Ù‚ØµÙŠØ±','ØªÙˆØ³Ø¹Ø© Ù„Ù„Ù…Ø´Ø±ÙˆØ¹']},
      h:{ before:['Ø³Ø¤Ø§Ù„ Ø¹Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªÙˆÙ‰','ØªØ­ÙÙŠØ² Ø§Ø³ØªÙ‚ØµØ§Ø¦ÙŠ Ù…Ø±ØªØ¨Ø· Ø¨Ø§Ù„Ø­ÙŠØ§Ø©','Ø§ØªÙØ§Ù‚ Ø¹Ù„Ù‰ Ø§Ù„Ù†ÙˆØ§ØªØ¬'],
          during:['Ù†Ù‚Ø§Ø´ Ù…Ù†Ø¸Ù‘Ù…','Ù…Ù‡Ù…Ø© Ø£Ø¯Ø§Ø¦ÙŠØ© Ù…ØµØºØ±Ø©','Ù‚Ø±Ø§Ø¡Ø© Ù…ÙˆØ¬Ù‡Ø© ÙˆØªØ­Ù„ÙŠÙ„'],
          after:['Ø³Ù„Ù… ØªÙ‚Ø¯ÙŠØ± Ø°Ø§ØªÙŠ','ØªØ°ÙƒØ±Ø© Ø®Ø±ÙˆØ¬ Ù†Ù‚Ø¯ÙŠØ©','ØªØ¯ÙˆÙŠÙ† Ø§Ù†Ø¹ÙƒØ§Ø³ + Ù‡Ø¯Ù Ø´Ø®ØµÙŠ']}
    };
    const AGE_NAME = { p1:'Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ Ø¯ÙÙ†ÙŠØ§', p2:'Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ Ø¹ÙÙ„ÙŠØ§', m:'Ù…ØªÙˆØ³Ø·', h:'Ø«Ø§Ù†ÙˆÙŠ' };

    function pick(a){ return a[Math.floor(Math.random()*a.length)] || '' }
    function bullets(el, arr){ el.innerHTML=''; arr.filter(Boolean).forEach(t=>{const li=document.createElement('li'); li.textContent=t; el.appendChild(li);});}
    function toastMsg(msg){ const t=document.getElementById('toast'); if(!t) return; t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1200); }
    function copyText(txt){ navigator.clipboard.writeText(txt).then(()=>toastMsg('ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ…')); }

    /* ===== ØªØ¨Ø¯ÙŠÙ„ â€œÙ†Ù…Ø· Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„â€ ===== */
    const modeSel   = document.getElementById('f-mode');
    const modeTopic = document.getElementById('mode-topic');
    const modeText  = document.getElementById('mode-text');
    modeSel.addEventListener('change', ()=>{
      const isText = modeSel.value === 'text';
      modeText.style.display  = isText ? '' : 'none';
      modeTopic.style.display = isText ? 'none' : '';
    });

    /* ===== Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªÙˆÙ„ÙŠØ¯ ===== */
    function inferBloomFrom(text){
      text = (text||'').replace(/[^\u0600-\u06FF\s]/g,' ');
      const rank=['create','evaluate','analyze','apply','understand','remember'];
      for(const lvl of rank){
        if((BLOOM_HINTS[lvl]||[]).some(k => text.includes(k))) return lvl;
      }
      return 'understand';
    }
    function genGoals(topic,count,mainBloom,supportBloom){
      const v1 = pick(BLOOM_VERBS[mainBloom]||['ÙŠÙˆØ¶Ø­']);
      const v2 = supportBloom ? pick(BLOOM_VERBS[supportBloom]||[]) : null;
      const out = [];
      out.push(`${v1} Ø§Ù„Ù…ØªØ¹Ù„Ù‘Ù…/Ù€Ø© Ù…ÙÙ‡ÙˆÙ… "${topic}" Ø¹Ù…Ù„ÙŠÙ‹Ø§.`);
      if(count>1) out.push(`Ø£Ù† ${v1} Ø§Ù„ÙÙƒØ±Ø© ÙÙŠ Ù…ÙˆØ§Ù‚Ù ØµÙÙŠØ© Ù‚ØµÙŠØ±Ø©.`);
      if(count>2 && v2) out.push(`Ø£Ù† ${v2} Ù†ÙˆØ§ØªØ¬ Ø§Ù„ØªØ¹Ù„Ù… Ø¨ØªÙ…Ø«ÙŠÙ„Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©.`);
      return out.slice(0,count);
    }
    function genSuccessCriteria(mainBloom){
      const v = pick(BLOOM_VERBS[mainBloom]||['ÙŠÙˆØ¶Ø­']);
      return `Ø£ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø·Ø§Ù„Ø¨ ${v} Ø§Ù„Ù…ÙÙ‡ÙˆÙ… Ø¨Ø¯Ù‚Ø©ØŒ ÙˆÙŠØ·Ø¨Ù‘Ù‚Ù‡ ÙÙŠ Ù…Ø«Ø§Ù„ Ø¬Ø¯ÙŠØ¯ Ø¯ÙˆÙ† Ù…Ø³Ø§Ø¹Ø¯Ø©.`;
    }
    function genActivities(age,mainBloom,supportBloom,topic){
      const t = AGE_TEMPLATES[age] || AGE_TEMPLATES.p2;
      const v1 = pick(BLOOM_VERBS[mainBloom]||[]);
      const v2 = supportBloom ? pick(BLOOM_VERBS[supportBloom]||[]) : null;
      return [
        `Ù‚Ø¨Ù„ Ø§Ù„ØªØ¹Ù„Ù…: ${pick(t.before)}.`,
        `Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ¹Ù„Ù… (Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ â€” ${v1}): Ù†Ø´Ø§Ø· ÙŠØ·Ø¨Ù‘Ù‚ "${topic}" Ø¨Ø®Ø·ÙˆØ§Øª ÙˆØ§Ø¶Ø­Ø©.`,
        v2 ? `Ù†Ø´Ø§Ø· Ø¯Ø§Ø¹Ù… â€” ${v2}: Ù„ØºØ²/Ù…ÙˆÙ‚Ù ØªØ·Ø¨ÙŠÙ‚ÙŠ Ù„ØªØ¹Ù…ÙŠÙ‚ "${topic}".` : null,
        `Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¹Ù„Ù…: ${pick(t.after)}.`
      ].filter(Boolean);
    }
    function genAssessment(mainBloom,supportBloom,topic){
      const easy='Ø¹Ø¯Ù‘Ø¯ Ù†Ù‚Ø·ØªÙŠÙ† Ø£Ø³Ø§Ø³ÙŠØªÙŠÙ†';
      const mid = pick(BLOOM_VERBS[mainBloom]||['Ø§Ø´Ø±Ø­']);
      const adv = pick(BLOOM_VERBS[supportBloom||mainBloom]||['ÙˆØ¸Ù‘Ù']);
      return [
        `Ø³Ù¡ (Ø³Ù‡Ù„): ${easy} Ø­ÙˆÙ„ "${topic}".`,
        `Ø³Ù¢ (Ù…ØªÙˆØ³Ø·): ${mid} Ø§Ù„ÙÙƒØ±Ø© Ø¨Ù…Ø«Ø§Ù„ Ù…Ù† Ø­ÙŠØ§ØªÙƒ.`,
        `Ø³Ù£ (Ù…ØªÙ‚Ø¯Ù…): ${adv} "${topic}" ÙÙŠ Ù…Ù‡Ù…Ø© ØµØºÙŠØ±Ø©.`
      ];
    }
    function genDiff(age,topic){
      return [
        `Ø¯Ø¹Ù…: Ø¨Ø·Ø§Ù‚Ø§Øª ØªÙ„Ù…ÙŠØ­/Ø£Ù…Ø«Ù„Ø© Ù…Ø­Ù„ÙˆÙ„Ø© Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù€"${topic}".`,
        `Ø¥Ø«Ø±Ø§Ø¡: ØªØ­Ø¯ÙŠ Ù‚ØµÙŠØ± ÙŠØ±Ø¨Ø· "${topic}" Ø¨Ø³ÙŠØ§Ù‚ Ø­Ù‚ÙŠÙ‚ÙŠ Ø£Ùˆ Ù…Ø§Ø¯Ø© Ø£Ø®Ø±Ù‰.`,
        `Ù…Ø±ÙˆÙ†Ø© Ø§Ù„Ø¹Ø±Ø¶: ÙƒØªØ§Ø¨Ø©/Ø±Ø³Ù…/Ø¹Ø±Ø¶ Ø´ÙÙ‡ÙŠ Ø­Ø³Ø¨ ØªÙØ¶ÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨.`
      ];
    }
    function genStructure(age,duration){
      const t = AGE_TEMPLATES[age] || AGE_TEMPLATES.p2;
      return [
        `Ù‚Ø¨Ù„: ${pick(t.before)} (5â€“7 Ø¯).`,
        `Ø£Ø«Ù†Ø§Ø¡: ØªØ¹Ù„Ù… Ù…ÙˆØ¬Ù‡ + ØªØ¹Ø§ÙˆÙ† (${Math.max(20, duration-15)} Ø¯).`,
        `Ø¨Ø¹Ø¯: ${pick(t.after)} (5â€“8 Ø¯).`
      ];
    }
    function genOneMinute(topic){
      return `ÙÙŠ Ø¯Ù‚ÙŠÙ‚Ø©: Ù„Ø®Ù‘ØµÙŠ "${topic}" ÙÙŠ Ø¬Ù…Ù„Ø©ØŒ Ø«Ù… Ø£Ø¹Ø·ÙŠ Ù…Ø«Ø§Ù„Ù‹Ø§ Ù…Ù† Ø­ÙŠØ§ØªÙƒ ÙŠØ¯Ø¹Ù… Ø§Ù„ÙÙƒØ±Ø©.`;
    }
    function makePreQuiz(topic, mainBloom, supportBloom){
      const q1 = `Ø³Ù¡ ØªÙ…Ù‡ÙŠØ¯ÙŠ: Ø§Ø°ÙƒØ±ÙŠ (Ø£Ùˆ Ø¹Ø±Ù‘ÙÙŠ) ÙÙƒØ±Ø© Ø£Ø³Ø§Ø³ÙŠØ© Ø¹Ù† "${topic}".`;
      const q2 = `Ø³Ù¢ ${pick(BLOOM_VERBS[mainBloom]||['Ø§Ø´Ø±Ø­'])}: Ø§Ø´Ø±Ø­ÙŠ "${topic}" Ø¨Ù…Ø«Ø§Ù„ Ù…Ø¨Ø³Ù‘Ø·.`;
      const q3 = `Ø³Ù£ ${pick(BLOOM_VERBS[supportBloom||mainBloom]||['Ø·Ø¨Ù‘Ù‚'])}: Ø·Ø¨Ù‘Ù‚ÙŠ "${topic}" ÙÙŠ Ù…ÙˆÙ‚Ù Ù‚ØµÙŠØ±.`;
      return [q1,q2,q3];
    }

    /* ===== Ø¹Ù†Ø§ØµØ± DOM ===== */
    const fAge = document.getElementById('f-age');
    const fDur = document.getElementById('f-duration');
    const fMain = document.getElementById('f-bloom-main');
    const fSup  = document.getElementById('f-bloom-support');
    const fGoal = document.getElementById('f-goal-count');
    const fNotes= document.getElementById('f-notes');
    const fAdapt= document.getElementById('f-adapt');
    const fLevel= document.getElementById('f-level');
    const inputsWrap = document.getElementById('inputs');

    const btnAnalyze = document.getElementById('btn-analyze');
    const btnGen     = document.getElementById('btn-generate');
    const btnCopy    = document.getElementById('btn-copy-full');
    const btnClass   = document.getElementById('btn-classroom');
    const btnTeams   = document.getElementById('btn-teams');
    const btnPrint   = document.getElementById('btn-print');
    const toggleInputs = document.getElementById('toggleInputs');
    const toggleInputs2= document.getElementById('toggleInputs2');

    const outSummary = document.getElementById('out-summary');
    const outGrid    = document.getElementById('out-grid');
    const outOneMin  = document.getElementById('out-onemin');
    const outGoals   = document.getElementById('out-goals');
    const outLadder  = document.getElementById('out-ladder');
    const postActions= document.getElementById('post-actions');

    const pillMain = document.getElementById('pill-main');
    const pillSup  = document.getElementById('pill-sup');
    const pillAge  = document.getElementById('pill-age');

    let CURRENT = { subject:'', topic:'', main:'understand', sup:'', age:'p2', duration:45, goals:[], success:'', activities:[], assessment:[], structure:[], oneMin:'', notes:'', adaptMsg:'' };

    /* ===== Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª ===== */
    function toggleInputsView(){
      inputsWrap.classList.toggle('collapsed');
      const collapsed = inputsWrap.classList.contains('collapsed');
      toggleInputs.textContent  = collapsed ? 'Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª' : 'Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª';
      if(toggleInputs2) toggleInputs2.textContent = collapsed ? 'Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¯Ø®Ù„Ø§ØªÙŠ' : 'Ø¥Ø®ÙØ§Ø¡ Ù…Ø¯Ø®Ù„Ø§ØªÙŠ';
    }
    toggleInputs.addEventListener('click', toggleInputsView);
    if(toggleInputs2) toggleInputs2.addEventListener('click', toggleInputsView);

    /* ===== ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ===== */
    btnAnalyze.addEventListener('click', ()=>{
      const mode = document.getElementById('f-mode').value;
      if(mode!=='text'){ toastMsg('Ø§Ø®ØªØ± : Ù†Øµ Ù„Ù„ØªØ­Ù„ÙŠÙ„ Ø£ÙˆÙ„Ù‹Ø§'); return; }
      const text = document.getElementById('f-text').value || '';
      if(!text.trim()){ toastMsg('Ø§Ù„ØµÙ‚ ÙÙ‚Ø±Ø© Ù„Ù„ØªØ­Ù„ÙŠÙ„'); return; }
      const inferred = inferBloomFrom(text);
      fMain.value = inferred;
      toastMsg(`ØªÙ… Ø§Ù„Ø§Ø³ØªØ¯Ù„Ø§Ù„ Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø¨Ù„ÙˆÙ…: ${inferred}`);
    });

    /* ===== ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø®Ø·Ø© ===== */
    btnGen.addEventListener('click', ()=>{
      const mode = document.getElementById('f-mode').value;
      const subject = (document.getElementById('f-subject')?.value||'').trim() || 'â€”';
      let topic = (document.getElementById('f-topic')?.value||'').trim();
      const sourceText = (document.getElementById('f-text')?.value||'').trim();

      const age = fAge.value; const duration = +fDur.value||45;
      const main = fMain.value; const sup = fSup.value||'';
      const goalCount = +fGoal.value||2; const notes = fNotes.value.trim();
      const level = fLevel.value; const adapt = fAdapt.value==='on';

      if(mode==='topic' && !topic){ toastMsg('Ø§ÙƒØªØ¨ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹â€¦'); return; }
      if(mode==='text'){
        if(!sourceText){ toastMsg('Ø§Ù„ØµÙ‚ Ù†ØµÙ‹Ø§ Ø£ÙˆÙ„Ù‹Ø§â€¦'); return; }
        topic = topic || (sourceText.split(/[.!ØŸ\n]/)[0].slice(0,60)+'â€¦');
      }

      const goals = genGoals(topic, goalCount, main, sup);
      const structure = genStructure(age, duration);
      const activities = genActivities(age, main, sup, topic);
      const assessment = genAssessment(main, sup, topic);
      const oneMin = genOneMinute(topic);
      const success = genSuccessCriteria(main);

      CURRENT = { subject, topic, main, sup, age, duration, goals, success, activities, assessment, structure, oneMin, notes, adaptMsg:'' };

      document.getElementById('out-head').textContent = `Ø§Ù„Ù…Ø§Ø¯Ø©: ${subject} â€” Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹: "${topic}" â€” Ø§Ù„Ø²Ù…Ù†: ${duration} Ø¯Ù‚ÙŠÙ‚Ø©`;
      bullets(document.getElementById('out-bullets'), [
        notes ? `Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ù…Ø¹Ù„Ù…: ${notes}` : null,
        (sup ? 'Ø¯Ù…Ø¬ Ù…Ø³ØªÙˆÙŠÙŠÙ† Ù…Ù† Ø¨Ù„ÙˆÙ… (Ø£Ø³Ø§Ø³ÙŠ + Ø¯Ø§Ø¹Ù…).' : 'ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø¨Ù„ÙˆÙ… Ø£Ø³Ø§Ø³ÙŠ ÙˆØ§Ø­Ø¯.')
      ]);
      const outAdapt = document.getElementById('out-adapt'); outAdapt.style.display='none'; outAdapt.textContent='';
      pillMain.textContent = 'Ø¨Ù„ÙˆÙ… (Ø£Ø³Ø§Ø³ÙŠ): '+main;
      pillSup.style.display = sup? 'inline-block':'none';
      if(sup) pillSup.textContent = 'Ø¨Ù„ÙˆÙ… (+2): '+sup;
      pillAge.textContent = 'Ø§Ù„Ø¹Ù…Ø±: '+(AGE_NAME[age]||age);

      bullets(document.getElementById('out-structure'), structure);
      bullets(document.getElementById('out-activities'), activities);
      bullets(document.getElementById('out-assessment'), assessment);
      bullets(document.getElementById('out-diff'), genDiff(age, topic));

      document.getElementById('oneMinText').textContent = oneMin;
      document.getElementById('goalsTitleOut').textContent = topic;
      const gl = document.getElementById('goalsList'); gl.innerHTML=''; goals.forEach(g=>{ const li=document.createElement('li'); li.textContent=g; gl.appendChild(li); });
      document.getElementById('successOut').textContent = success;

      // Ø³Ù„Ù‘Ù… ØªÙ‚Ø¯ÙŠØ± Ù…Ø¨Ø³Ù‘Ø· ÙˆØ§Ø¶Ø­
      const ladder = document.getElementById('ladderWrap');
      ladder.innerHTML = `
        <div class="step">
          <div class="tag ok">Ø£ØªÙ‚Ù† âœ”ï¸</div>
          <div>ÙŠØ­Ù‚Ù‚ Ø§Ù„Ù‡Ø¯Ù Ø¨Ø¯Ù‚Ø© ÙˆÙŠØ·Ø¨Ù‚ Ø§Ù„Ù…ÙÙ‡ÙˆÙ… ÙÙŠ Ù…Ø«Ø§Ù„ Ø¬Ø¯ÙŠØ¯ Ø¯ÙˆÙ† Ù…Ø³Ø§Ø¹Ø¯Ø©.</div>
        </div>
        <div class="step">
          <div class="tag mid">Ù…ØªÙˆØ³Ø· â—‰</div>
          <div>ÙŠÙÙ‡Ù… Ø§Ù„ÙÙƒØ±Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙˆÙŠØ­ØªØ§Ø¬ ØªÙˆØ¬ÙŠÙ‡Ù‹Ø§ Ø¨Ø³ÙŠØ·Ù‹Ø§ Ø¹Ù†Ø¯ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.</div>
        </div>
        <div class="step">
          <div class="tag need">Ø¨Ø­Ø§Ø¬Ø© Ø¯Ø¹Ù… âœ³ï¸</div>
          <div>ÙŠÙˆØ§Ø¬Ù‡ ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ø§Ù„ÙÙ‡Ù…/Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ â€” ÙŠÙÙ‚Ø¯ÙÙ‘Ù… Ù„Ù‡ Ù…Ø«Ø§Ù„ Ø¥Ø¶Ø§ÙÙŠ Ø£Ùˆ ØªØ¨Ø³ÙŠØ·.</div>
        </div>
      `;

      // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ + Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù„Ø§Ø­Ù‚Ø©
      outSummary.style.display=''; outGrid.style.display='';
      outGoals.style.display=''; outOneMin.style.display='';
      outLadder.style.display=''; postActions.style.display='';

      // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù‚Ø¨Ù„ÙŠ Ø¥Ù† Ø·ÙÙ„ÙØ¨
      const pq = document.getElementById('pre-quiz');
      if(adapt){
        pq.style.display='';
        const qs = makePreQuiz(topic, main, sup);
        const wrap = document.getElementById('quizWrap'); wrap.innerHTML='';
        qs.forEach((q,i)=>{
          const box = document.createElement('div');
          box.className='field';
          box.innerHTML = `
            <div class="printable" style="border-style:solid">
              <div class="muted" style="margin-bottom:6px">Ø³Ø¤Ø§Ù„ ${i+1}:</div>
              <div>${q}</div>
              <label style="display:block; margin-top:8px">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø®Ø·ÙØ¦ÙŠÙ†</label>
              <input type="number" min="0" value="0" data-q="${i}">
            </div>`;
          wrap.appendChild(box);
        });
      }else{
        pq.style.display='none';
      }

      // Ø·ÙŠÙ‘ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„ØªÙˆÙ„ÙŠØ¯ (Ø²Ø± "Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù…Ø¯Ø®Ù„Ø§ØªÙŠ" ÙŠØ¨Ù‚Ù‰)
      if(!inputsWrap.classList.contains('collapsed')) toggleInputsView();

      toastMsg('ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø®Ø·Ø© ğŸ‰');
      window.scrollTo({ top: outSummary.offsetTop - 10, behavior: 'smooth' });
    });

    /* ===== ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙƒÙŠÙ‘Ù Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù‚Ø¨Ù„ÙŠ ===== */
    document.getElementById('btn-adapt-apply').addEventListener('click', ()=>{
      const inputs = Array.from(document.querySelectorAll('#quizWrap input[type="number"]'));
      if(!inputs.length){ toastMsg('ÙˆÙ„Ù‘Ø¯ÙŠ Ø§Ù„Ø®Ø·Ø© Ø£ÙˆÙ„Ø§Ù‹'); return; }
      const wrong = inputs.map(i => +i.value||0);
      const totalWrong = wrong.reduce((a,b)=>a+b,0);

      let focus='';
      const maxIdx = wrong.indexOf(Math.max(...wrong));
      if(maxIdx===0) focus = 'ØªØ¹Ø²ÙŠØ² Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ÙˆØ§Ù„Ù…ÙØ§Ù‡ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (ØªØ°ÙƒÙ‘Ø±/ÙÙ‡Ù…).';
      else if(maxIdx===1) focus = 'ØªÙ‚ÙˆÙŠØ© Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ÙˆÙÙ‚ Ø¨Ù„ÙˆÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ.';
      else focus = 'Ø²ÙŠØ§Ø¯Ø© Ù…Ù‡Ø§Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚/Ø§Ù„ØªÙˆØ³ÙŠØ¹ (Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¯Ø§Ø¹Ù…).';

      CURRENT.adaptMsg = `ØªÙƒÙŠÙŠÙ ØªÙ„Ù‚Ø§Ø¦ÙŠ: ${focus} (Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø£Ø®Ø·Ø§Ø¡: ${totalWrong}).`;
      const outAdapt = document.getElementById('out-adapt');
      outAdapt.textContent = CURRENT.adaptMsg;
      outAdapt.style.display = '';

      const extra = (maxIdx===0) ? `Ø¥Ø¶Ø§ÙØ© Ø£Ù…Ø«Ù„Ø© Ù…Ø­Ø³ÙˆØ³Ø© Ø£ÙƒØ«Ø± ÙÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©.` :
                    (maxIdx===1) ? `ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¥Ù„Ù‰ Ø®Ø·ÙˆØ§Øª Ø£ÙˆØ¶Ø­.` :
                                   `ØªÙ…Ø±ÙŠÙ† ØªØ·Ø¨ÙŠÙ‚ÙŠ Ø¥Ø¶Ø§ÙÙŠ Ø¨ÙˆÙ‚Øª Ù‚ØµÙŠØ±.`;

      const acts = CURRENT.activities.slice();
      acts.push(`ğŸ”§ ØªØ¹Ø¯ÙŠÙ„ ØªÙƒÙŠÙÙŠ: ${extra}`);
      bullets(document.getElementById('out-activities'), acts);

      toastMsg('ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙƒÙŠÙ‘Ù âœ…');
    });

    /* ===== Ù†Ø³Ø®/Ø·Ø¨Ø§Ø¹Ø©/ØªØµØ¯ÙŠØ± ===== */
    function exportFullText(S){
      const lines = [];
      lines.push(`Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${S.topic} â€” (${S.subject})`);
      if(S.adaptMsg) lines.push(S.adaptMsg);
      lines.push(`Ø§Ù„Ø²Ù…Ù†: ${S.duration} Ø¯Ù‚ÙŠÙ‚Ø© â€” Ø§Ù„Ø¹Ù…Ø±: ${(AGE_NAME[S.age]||S.age)}`);
      lines.push(`Ø¨Ù„ÙˆÙ… (Ø£Ø³Ø§Ø³ÙŠ): ${S.main}${S.sup?(' + '+S.sup):''}`);
      if(S.notes) lines.push(`Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…: ${S.notes}`);
      lines.push('\nØ§Ù„Ø£Ù‡Ø¯Ø§Ù:'); S.goals.forEach((g,i)=>lines.push(`- ${g}`));
      lines.push('\nÙ…Ø®Ø·Ø· Ø§Ù„Ø¯Ø±Ø³:'); S.structure.forEach(s=>lines.push(`- ${s}`));
      lines.push('\nØ£Ù†Ø´Ø·Ø©:'); S.activities.forEach(a=>lines.push(`- ${a}`));
      lines.push('\nØªÙ‚ÙˆÙŠÙ… Ø³Ø±ÙŠØ¹:'); S.assessment.forEach(a=>lines.push(`- ${a}`));
      lines.push('\nØªÙ…Ø§ÙŠØ²:'); genDiff(S.age,S.topic).forEach(a=>lines.push(`- ${a}`));
      lines.push('\nØ§Ù„Ø¯Ù‚ÙŠÙ‚Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©:'); lines.push(`- ${S.oneMin}`);
      lines.push('\nÙ…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù†Ø¬Ø§Ø­:'); lines.push(`- ${S.success}`);
      return lines.join('\n');
    }
    function exportClassroom(S){
      return [
`[Google Classroom]
Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${S.topic} â€” ${S.subject}`,
`Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª:
- Ø§Ù‚Ø±Ø£/ÙŠ Ø§Ù„Ù‡Ø¯Ù: ${S.goals[0]||'-'}.
- Ù†ÙÙ‘Ø°ÙŠ Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø«Ù… Ø£Ø±Ø³Ù„ÙŠ ØªØ°ÙƒØ±Ø© Ø§Ù„Ø®Ø±ÙˆØ¬.`,
`Ø§Ù„Ù…ÙˆØ§Ø¯: (ÙŠÙØ­Ø¯Ù‘Ø¯ Ø§Ù„Ù…Ø¹Ù„Ù…)`,
`Ø§Ù„ØªØ§Ø±ÙŠØ®/Ø§Ù„ÙˆÙ‚Øª: (ÙŠÙØ­Ø¯Ù‘Ø¯ Ø§Ù„Ù…Ø¹Ù„Ù…)`,
`Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø³Ø±ÙŠØ¹:
1) ${S.assessment[0]||'-'}
2) ${S.assessment[1]||'-'}
3) ${S.assessment[2]||'-'}`,
`ØªÙ…Ø§ÙŠØ²:
- Ø¯Ø¹Ù…: ${genDiff(S.age,S.topic)[0]}
- Ø¥Ø«Ø±Ø§Ø¡: ${genDiff(S.age,S.topic)[1]}`
      ].join('\n');
    }
    function exportTeams(S){
      return [
`[Microsoft Teams Assignment]
Title: ${S.topic} â€” ${S.subject}
Instructions:
- Goals: ${S.goals.join(' | ')}
- Main Activity: ${S.activities[1]||'-'}
- Exit Ticket: ${S.assessment[0]||'-'}
Rubric: (paste from page)
Due: (set by teacher)`
      ].join('\n');
    }

    document.getElementById('btn-copy-full').addEventListener('click', ()=> {
      const txt = exportFullText(CURRENT);
      copyText(txt);
    });
    document.getElementById('btn-classroom').addEventListener('click', ()=> {
      copyText(exportClassroom(CURRENT));
    });
    document.getElementById('btn-teams').addEventListener('click', ()=> {
      copyText(exportTeams(CURRENT));
    });
    document.getElementById('btn-print').addEventListener('click', ()=> window.print());
  </script>
</body>
</html>
