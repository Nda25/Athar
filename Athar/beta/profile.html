<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØµØ§Ø­Ø¨ Ø§Ù„Ø£Ø«Ø± â€” Ø£Ø«Ù€Ù€Ø±</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&family=Amiri:wght@700&display=swap" rel="stylesheet">

  <!-- Ø­Ù…Ù‘Ù„ÙŠ Ù„ÙˆÙ† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸ Ù…Ø¨ÙƒØ±Ù‹Ø§ Ø¬Ø¯Ù‹Ø§ Ù„ØªÙØ§Ø¯ÙŠ Ø§Ù„ÙˆÙ…ÙŠØ¶ -->
  <script>
    (function(){
      try{
        var c = localStorage.getItem('athar:theme');
        if (c) document.documentElement.style.setProperty('--primary', c);
      }catch(_){}
    })();
  </script>

  <link rel="stylesheet" href="style.css">
  <meta name="color-scheme" content="dark light">

  <!-- ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¨Ø³ÙŠØ·Ø© Ø®Ø§ØµØ© Ø¨Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© (Ù„Ø§ ØªØºÙŠÙ‘Ø± Ù‡ÙˆÙŠØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹) -->
  <style>
    :root { --primary: var(--sea-600); }
    .card .title { display:flex; align-items:center; gap:10px; }
    .subheading { font-size:14px; color:#6b7280; font-weight:600; }
    .grid { display:grid; gap:16px; grid-template-columns: 1fr 1fr; }
    @media (max-width: 800px){ .grid { grid-template-columns: 1fr; } }

    .profile-box { display:grid; grid-template-columns:auto 1fr; gap:16px; align-items:center; }
    .avatar-wrap { position:relative; width:96px; height:96px; }
    .avatar { width:96px; height:96px; border-radius:50%; object-fit:cover; border:3px solid #eef; background:#f5f7ff; }
    .edit-badge { position:absolute; right:-6px; bottom:-6px; background:var(--primary); color:#fff; border-radius:16px; padding:4px 8px; font-size:12px; cursor:pointer; border:1px solid #fff; }
    .name-row { display:flex; align-items:center; gap:8px; font-weight:800; font-size:20px; }
    .icon-btn { border:1px solid #e5e7eb; background:#fff; cursor:pointer; padding:4px 8px; border-radius:8px; }
    .badge { padding:6px 10px; border:1px solid transparent; border-radius:10px; font-weight:700; display:inline-block; }
    .muted { color:#6b7280 }
    .row-actions { display:flex; gap:10px; flex-wrap:wrap; }
    .btn.ghost { background:#fff; border:1px solid #e5e7eb; }
    .section-title { font-weight:800; margin-bottom:8px; }

    .theme-picker { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .theme-picker button[data-color] { width:28px; height:28px; border-radius:50%; border:2px solid #fff; box-shadow:0 0 0 1px #e5e7eb; cursor:pointer; }
    .theme-note { font-size:12px; color:#6b7280; margin-top:6px; }
    .divider { height:1px; background:#f1f5f9; margin:12px 0; }
    .soon { opacity:.6; cursor:not-allowed; }

    /* ÙˆØ³Ù… Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù„ÙˆÙ‘Ù† (Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± Ø§Ù„Ù€ badge Ø§Ù„Ø¹Ø§Ù…Ù‘Ø©) */
    .state { padding:6px 10px; border-radius:999px; font-weight:800; border:1px solid #e5e7eb; background:#fff; }

    /* Ù…Ù†Ø¹ Ø§Ù„ÙˆÙ…ÙŠØ¶: Ù†Ø®ÙÙŠ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø­ØªÙ‰ ØªØ¬Ù‡Ø² Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
    .card[data-ready="0"] { opacity:.0; }
    .card[data-ready="1"] { opacity:1; transition:opacity .18s ease; }
  </style>
</head>

<body>
  <div class="global-bg"></div>
  <div class="backdrop"></div>
  <div class="pattern"></div>

  <div class="topbar">
    <div class="left-actions">
      <a class="btn" href="index.html" title="Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    </div>
    <div class="actions">
      <button class="btn" id="themeToggle" title="Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†/Ø§Ù„ÙØ§ØªØ­">ğŸŒ“</button>
      <a class="btn primary" href="pricing.html">Ø§Ù„Ø¯ÙØ¹ ÙˆØ§Ù„Ø¥Ø´ØªØ±Ø§Ùƒ</a>
    </div>
  </div>

  <header>
    <div class="hero">
      <div class="hero-plate"></div>
      <h1 class="logo">Ø£Ø«Ù€Ù€Ø±</h1>
      <div class="tag"><span class="dot"></span>ØµÙØ­ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©</div>
    </div>
  </header>

  <main>
    <div class="container">
      <section class="card" id="profileCard" data-ready="0">
        <h2 class="title">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØµØ§Ø­Ø¨ Ø§Ù„Ø£Ø«Ø± <span class="subheading">â€” ÙƒÙ„ Ù…Ø§ ÙŠØ®Øµ Ø­Ø³Ø§Ø¨Ùƒ ÙˆØªØ®ØµÙŠØµ ÙˆØ§Ø¬Ù‡ØªÙƒ</span></h2>

        <div class="grid">
          <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠØ³Ø±: Ø§Ù„Ù‡ÙˆÙŠØ© -->
          <div class="box profile-box">
            <div class="avatar-wrap">
              <img id="u-avatar" class="avatar" src="assets/img/avatar-placeholder.png" alt="ØµÙˆØ±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨">
              <label class="edit-badge" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©">
                âœ
                <input id="avatarInput" type="file" accept="image/*" hidden>
              </label>
            </div>

            <div>
              <div class="name-row">
                <span id="displayName" class="js-user-name">â€”</span>
                <button id="editNameBtn" class="icon-btn" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…">âœ</button>
              </div>

              <p><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯:</strong> <span id="u-email">â€”</span></p>
              <p><strong>Ø§Ù„Ù…Ø¹Ø±Ù‘Ù:</strong> <span id="u-sub">â€”</span></p>
              <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…:</strong> <span id="u-joined">â€”</span></p>

              <div class="divider"></div>

              <div style="display:flex; align-items:center; gap:10px; flex-wrap:wrap;">
                <span class="section-title">Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨:</span>
                <span id="u-status">â€”</span>
                <span id="sub-state" class="badge" style="display:none"></span>
              </div>

              <div class="row-actions" style="margin-top:12px">
                <a class="btn" href="pricing.html">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</a>
                <button id="invoicesBtn" class="btn ghost soon" title="Ù‚Ø±ÙŠØ¨Ù‹Ø§" disabled>Ø§Ù„ÙÙˆØ§ØªÙŠØ±</button>
              </div>
              <div class="muted" style="margin-top:6px">Ø§Ù„ÙÙˆØ§ØªÙŠØ±: <strong>Ù‚Ø±ÙŠØ¨Ù‹Ø§</strong> â€” Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ ÙÙˆØ± Ø±Ø¨Ø· Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¯ÙØ¹.</div>
            </div>
          </div>

          <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠÙ…Ù†: ØªØ®ØµÙŠØµ -->
          <div class="box">
            <h3 class="section-title">ØªØ®ØµÙŠØµ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©</h3>
            <div id="themePicker" class="theme-picker" aria-label="Ø§Ø®ØªÙŠØ§Ø± Ù„ÙˆÙ† Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬">
              <button data-color="#6366f1" title="Ø¨Ù†ÙØ³Ø¬ÙŠ"></button>
              <button data-color="#f472b6" title="Ø²Ù‡Ø±ÙŠ"></button>
              <button data-color="#22c55e" title="Ø£Ø®Ø¶Ø±"></button>
              <button data-color="#06b6d4" title="Ø³Ù…Ø§ÙˆÙŠ"></button>
              <button data-color="#f59e0b" title="Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ"></button>
              <button id="resetTheme" class="btn ghost" title="Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ">Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</button>
            </div>
            <div class="theme-note">Ø§Ø®ØªØ± Ù„ÙˆÙ†Ùƒ Ø§Ù„Ù…ÙØ¶Ù„ Ù„Ø¹Ù†ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ. ÙŠÙØ­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ ÙˆÙŠÙ…ÙƒÙ† Ù…Ø²Ø§Ù…Ù†ØªÙ‡ Ù…Ø¹ Ø­Ø³Ø§Ø¨Ùƒ.</div>

            <div class="divider"></div>

            <h3 class="section-title">Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</h3>
            <p class="muted">Ù„Ù„ØªÙØ¹ÙŠÙ„ Ø£Ùˆ Ø§Ù„ØªØ±Ù‚ÙŠØ© Ù‚Ù… Ø¨Ø²ÙŠØ§Ø±Ø© ØµÙØ­Ø© <a href="pricing.html">Ø§Ù„Ø¯ÙØ¹ ÙˆØ§Ù„Ø¥Ø´ØªØ±Ø§Ùƒ</a>.</p>
            <p class="muted">Ø¹Ù†Ø¯ ØªÙØ¹ÙŠÙ„ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¯ÙØ¹ Ø³ØªØ¸Ù‡Ø± ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø© ÙˆØ§Ù„ÙÙˆØ§ØªÙŠØ± Ù‡Ù†Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.</p>

            <div class="divider"></div>

            <div class="row-actions">
              <button id="logout" class="btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <footer>
    <p class="foot-line">Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø´Ø±Ø§Ø±Ø© ØµØºÙŠØ±Ø©â€¦ ØªÙØ¶ÙŠØ¡ Ø¹Ù‚ÙˆÙ„Ù‹Ø§ ÙƒØ¨ÙŠØ±Ø©.</p>
    <p class="foot-name">Ù†Ø¯Ù‰ Ø§Ù„Ù…Ø¬ÙŠØ±Ø´</p>
    <nav class="foot-links">
      <a href="privacy.html">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a><span class="sep">|</span>
      <a href="terms.html">Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…</a><span class="sep">|</span>
      <a href="refund-policy.html">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹</a><span class="sep">|</span>
      <a href="whatsapp.html">ØªÙˆØ§ØµÙ„ ÙˆØ§ØªØ³Ø§Ø¨</a><span class="sep">|</span>
      <a href="complaints.html">Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ ÙˆØ§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</a>
    </nav>
    <div class="foot-copy">Â© <span id="year"></span> Ø£Ø«Ù€Ù€Ø± â€” ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</div>
  </footer>

  <script>(function(){ var y=document.getElementById('year'); if(y) y.textContent=new Date().getFullYear(); })();</script>
  <div class="toast" id="toast"></div>

  <!-- Supabase SDK + Ø¹Ù…ÙŠÙ„ Ù…Ø´ØªØ±Ùƒ (Ù†Ø³ØªÙÙŠØ¯ Ù…Ù† Ù…Ù„ÙÙƒ assets/js/supabase-client.js Ø¥Ù† ÙˆÙØ¬Ø¯) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="assets/js/supabase-client.js"></script>
  <script>
    // ÙÙŠ Ø­Ø§Ù„ Ù…Ø§ ÙƒØ§Ù† Ø¹Ù†Ø¯Ùƒ supabase-client.js ÙŠØ¹Ø±Ù‘Ù window.supaØŒ Ù†Ù‡ÙŠØ¦ Ø¨Ø¯ÙŠÙ„ Ø¨Ø³ÙŠØ·
    (function ensureSupa(){
      if (!window.supa && window.supabase && window.__CFG && window.__CFG.supabase_url && window.__CFG.supabase_anon){
        try{
          window.supa = supabase.createClient(window.__CFG.supabase_url, window.__CFG.supabase_anon, { auth:{ persistSession:false }});
        }catch(_){}
      }
    })();
  </script>

  <!-- Ø³ÙƒØ±Ø¨ØªØ§Øª Ø¹Ø§Ù…Ø© -->
  <script src="app.js"></script>
  <script src="assets/js/storage.js"></script>

  <!-- Ù…Ù†Ø§Ø¯Ø§Ø© ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù‡ÙˆÙŠØ© + Ù…Ù†Ø·Ù‚ Ø§Ù„ØµÙØ­Ø© -->
  <script>
    function toast(msg){
      const t = document.getElementById('toast');
      if (!t) return;
      t.textContent = msg;
      t.classList.add('show');
      setTimeout(()=>t.classList.remove('show'), 1800);
    }

    async function initProfile(){
      const card = document.getElementById('profileCard');
      card?.setAttribute('data-ready','0');

      const client = window.auth0Client || window.auth;
      if (!client) return; // Ø³ÙŠÙØ¹Ø§Ø¯ Ø§Ù„Ù†Ø¯Ø§Ø¡ Ø¹Ù†Ø¯ auth0:ready

      const logged = await client.isAuthenticated?.().catch(()=>false);
      if (!logged) {
        await client.loginWithRedirect({ authorizationParams:{ redirect_uri: window.location.href } });
        return;
      }

      // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ùˆ Ø§Ù„Ù€ claims
      let user=null, claims=null;
      try { user = await client.getUser(); } catch(_){}
      try { claims = await client.getIdTokenClaims(); } catch(_){}

      // Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
      const name = user?.name || user?.nickname || 'â€”';
      document.querySelectorAll('.js-user-name,#displayName').forEach(n=> n.textContent = name);
      document.getElementById('u-email').textContent = user?.email || 'â€”';
      document.getElementById('u-sub').textContent   = user?.sub   || 'â€”';
      const joined = user?.updated_at || user?.created_at || null;
      document.getElementById('u-joined').textContent = joined ? new Date(joined).toLocaleDateString('ar-SA') : 'â€”';

      // Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù…Ù† Auth0ØŒ Ø«Ù… Ù…Ù† user_prefs (Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯)
      const avatarEl = document.getElementById('u-avatar');
      if (user?.picture) avatarEl.src = user.picture;

      // Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ù† Ø§Ù„Ù€ namespace Ø§Ù„Ø¬Ø¯ÙŠØ¯ + Ø§Ù„Ù‚Ø¯ÙŠÙ…
      const NS_NEW = "https://n-athar.co/";
      const NS_OLD = "https://athar.co/";
      const st = (claims && (claims[NS_NEW + "status"] || claims[NS_OLD + "status"])) || "";

      document.getElementById('u-status').textContent = st || 'â€”';

      const colorBy = {
        active:  {bg:'#dcfce7', fg:'#166534', br:'#bbf7d0', text:'Ù…ÙØ¹Ù„'},
        trial:   {bg:'#dbeafe', fg:'#1e3a8a', br:'#bfdbfe', text:'ØªØ¬Ø±ÙŠØ¨ÙŠ'},
        pending: {bg:'#fef9c3', fg:'#854d0e', br:'#fde68a', text:'Ù…Ø¹Ù„Ù‚'},
        inactive:{bg:'#fee2e2', fg:'#991b1b', br:'#fecaca', text:'ØºÙŠØ± Ù†Ø´Ø·'}
      };
      const badge = document.getElementById('sub-state');
      if (st) {
        const m = colorBy[st] || colorBy.inactive;
        badge.style.display='inline-block';
        badge.textContent=m.text; badge.style.background=m.bg; badge.style.color=m.fg; badge.style.borderColor=m.br;
      }

      // ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø§Ø³Ù…/ØµÙˆØ±Ø©/Ù„ÙˆÙ†) Ù…Ù† Supabase Ø¥Ù† ÙˆÙØ¬Ø¯Øª
      try {
        if (window.supa && user?.sub) {
          const { data: pref } = await window.supa
            .from('user_prefs').select('*').eq('user_sub', user.sub).maybeSingle();

          if (pref?.display_name) document.querySelectorAll('.js-user-name,#displayName').forEach(n=> n.textContent = pref.display_name);
          if (pref?.avatar_url)   avatarEl.src = pref.avatar_url;
          if (pref?.theme_color)  document.documentElement.style.setProperty('--primary', pref.theme_color);
        }
      } catch(_){}

      // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù… (ÙŠØ­ÙØ¸ ÙÙŠ user_prefs)
      document.getElementById('editNameBtn').onclick = async () => {
        const cur = document.getElementById('displayName').textContent.trim();
        const newName = prompt("Ø£Ø¯Ø®Ù„ÙŠ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶:", cur || name);
        if (!newName || !newName.trim()) return;
        document.querySelectorAll('.js-user-name,#displayName').forEach(n=> n.textContent = newName.trim());
        try {
          if (window.supa && user?.sub) {
            await window.supa.from('user_prefs').upsert(
              { user_sub: user.sub, display_name: newName.trim() },
              { onConflict: 'user_sub' }
            );
            toast("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù… âœ“");
          }
        } catch(e){ console.error(e); toast("ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø§Ù„Ø§Ø³Ù…"); }
      };

      // Ø±ÙØ¹ ØµÙˆØ±Ø© Ø´Ø®ØµÙŠØ© Ø¥Ù„Ù‰ Storage (bucket: avatars)
      document.getElementById('avatarInput').onchange = async (ev) => {
        const file = ev.target.files?.[0]; if (!file) return;
        try {
          if (!window.supa) throw new Error("Supabase unavailable");
          const safe = (user?.sub || 'u').replace(/[|]/g,'_');
          const path = `${safe}/${Date.now()}_${file.name}`;
          const up = await window.supa.storage.from('avatars').upload(path, file, { upsert:true });
          if (up.error) throw up.error;
          const { data } = window.supa.storage.from('avatars').getPublicUrl(path);
          const url = data.publicUrl;
          document.getElementById('u-avatar').src = url;
          await window.supa.from('user_prefs').upsert({ user_sub: user.sub, avatar_url: url }, { onConflict: 'user_sub' });
          toast("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø© âœ“");
        } catch(e){ console.error(e); toast("ØªØ¹Ø°Ø± Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©"); }
      };

      // Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ø±Ø¶
      card?.setAttribute('data-ready','1');
    }

    // Ù…ÙÙ†ØªÙ‚ÙŠ Ø§Ù„Ø£Ù„ÙˆØ§Ù† (ÙŠØ­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§ + ÙÙŠ user_prefs)
    (function themeInit(){
      const picker = document.getElementById('themePicker');
      const reset  = document.getElementById('resetTheme');
      if (!picker) return;

      picker.addEventListener('click', async (e)=>{
        const btn = e.target.closest('button[data-color]'); if (!btn) return;
        const color = btn.getAttribute('data-color');
        document.documentElement.style.setProperty('--primary', color);
        try { localStorage.setItem('athar:theme', color); } catch(_){}
        try {
          const u = await window.auth0Client?.getUser();
          if (u?.sub && window.supa) {
            await window.supa.from('user_prefs').upsert(
              { user_sub: u.sub, theme_color: color }, { onConflict: 'user_sub' }
            );
          }
        } catch(_){}
      });

      if (reset) reset.addEventListener('click', async ()=>{
        const def = getComputedStyle(document.documentElement).getPropertyValue('--sea-600') || '#1e40af';
        document.documentElement.style.setProperty('--primary', def.trim() || '#1e40af');
        try { localStorage.removeItem('athar:theme'); } catch(_){}
        try {
          const u = await window.auth0Client?.getUser();
          if (u?.sub && window.supa) {
            await window.supa.from('user_prefs').upsert(
              { user_sub: u.sub, theme_color: null }, { onConflict: 'user_sub' }
            );
          }
        } catch(_){}
        toast("Ø±Ø¬Ø¹Ù†Ø§ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ âœ“");
      });
    })();

    // Ø²Ø± Ø§Ù„Ø®Ø±ÙˆØ¬
    document.addEventListener('click', (e)=>{
      if (e.target && e.target.id === 'logout') {
        (window.auth0Client || window.auth)?.logout({ logoutParams:{ returnTo: window.location.origin } });
      }
    });

    // Ø´ØºÙ‘Ù„ÙŠ Ø¨Ø¹Ø¯ Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„Ø­Ø§Ø±Ø³
    window.addEventListener('auth0:ready', initProfile);
    if (window.auth0Client || window.auth) initProfile();
  </script>

  <!-- Ø­Ø§Ø±Ø³ Ø§Ù„ÙˆØµÙˆÙ„ -->
  <script src="assets/js/require-auth.js"></script>
</body>
</html>
