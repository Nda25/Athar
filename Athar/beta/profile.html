<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ุงูููู ุงูุดุฎุตู โ ุฃุซููุฑ</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&family=Amiri:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <meta name="color-scheme" content="dark light">
</head>
<body>
  <div class="global-bg"></div>
  <div class="backdrop"></div>
  <div class="pattern"></div>

  <div class="topbar">
    <div class="left-actions">
      <a class="btn" href="index.html" title="ุงูุฑุฆูุณูุฉ">ุงูุฑุฆูุณูุฉ</a>
    </div>
    <div class="actions">
      <button class="btn" id="themeToggle" title="ุงููุถุน ุงูุฏุงูู/ุงููุงุชุญ">๐</button>
      <a class="btn primary" href="pricing.html">ุงูุฏูุน ูุงูุฅุดุชุฑุงู</a>
    </div>
  </div>

  <header>
    <div class="hero">
      <div class="hero-plate"></div>
      <h1 class="logo">ุฃุซููุฑ</h1>
      <div class="tag"><span class="dot"></span>ููู ุงููุณุชุฎุฏู</div>
    </div>
  </header>

  <main>
    <div class="container">
      <section class="card">
        <h2 class="title">ุจูุงูุงุช ุงูุญุณุงุจ</h2>

        <div class="grid">
          <div class="box">
            <h3>ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ</h3>
            <p><strong>ุงูุงุณู:</strong> <span class="js-user-name">โ</span></p>
            <p><strong>ุงูุจุฑูุฏ:</strong> <span id="u-email">โ</span></p>
            <p><strong>ุงููุนุฑูู:</strong> <span id="u-sub">โ</span></p>
            <p><strong>ุงูุญุงูุฉ:</strong> <span id="u-status">โ</span></p>
          </div>

          <div class="box">
            <h3>ุงูุงุดุชุฑุงู</h3>
            <p id="sub-state" class="badge" style="display:none"></p>
            <p class="muted">ููุชูุนูู ุฃู ุงูุชุฑููุฉ ุชูุถูู ุฅูู ุตูุญุฉ <a href="pricing.html">ุงูุฏูุน ูุงูุฅุดุชุฑุงู</a>.</p>
          </div>
        </div>

        <div class="actions-row" style="margin-top:18px">
          <button id="logout" class="btn">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
        </div>
      </section>
    </div>
  </main>

  <footer>
    <p class="foot-line">ุงูุชุนููู ุดุฑุงุฑุฉ ุตุบูุฑุฉโฆ ุชูุถูุก ุนููููุง ูุจูุฑุฉ.</p>
    <p class="foot-name">ูุฏู ุงููุฌูุฑุด</p>
    <nav class="foot-links">
      <a href="privacy.html">ุณูุงุณุฉ ุงูุฎุตูุตูุฉ</a><span class="sep">|</span>
      <a href="terms.html">ุงูุดุฑูุท ูุงูุฃุญูุงู</a><span class="sep">|</span>
      <a href="refund-policy.html">ุณูุงุณุฉ ุงูุงุณุชุฑุฌุงุน</a><span class="sep">|</span>
      <a href="whatsapp.html">ุชูุงุตู ูุงุชุณุงุจ</a><span class="sep">|</span>
      <a href="complaints.html">ุงูุดูุงูู ูุงูุงูุชุฑุงุญุงุช</a>
    </nav>
    <div class="foot-copy">ยฉ <span id="year"></span> ุฃุซููุฑ โ ูู ุงูุญููู ูุญููุธุฉ.</div>
  </footer>

  <script>
    (function(){ var y=document.getElementById('year'); if(y) y.textContent=new Date().getFullYear(); })();
  </script>

  <div class="toast"></div>

  <!-- ุณูุฑุจุชุงุช -->
  <script src="app.js"></script>
  <script src="assets/js/storage.js"></script>
  <script>
    // ููุชุธุฑ ุฌุงูุฒูุฉ ุนููู ุงููููุฉ ูู require-auth.js
    async function initProfile(){
      const client = window.auth0Client;
      if (!client) return; // ุณูุนุงุฏ ุงููุฏุงุก ุนูุฏ ุญุฏุซ ุงูุฌุงูุฒูุฉ

      // ูู ูุง ูู ูุณุฌูู โ ููุฌูู ูุชุณุฌูู ุงูุฏุฎูู
      const ok = await client.isAuthenticated().catch(()=>false);
      if (!ok) {
        await client.loginWithRedirect({ authorizationParams:{ redirect_uri: window.location.href } });
        return;
      }

      // ุจูุงูุงุช ุงููุณุชุฎุฏู
      let user = null, claims = null;
      try { user = await client.getUser(); } catch(_){}
      try { claims = await client.getIdTokenClaims(); } catch(_){}

      document.querySelectorAll('.js-user-name').forEach(n=> n.textContent = user?.name || user?.nickname || 'โ');
      document.getElementById('u-email').textContent = user?.email || 'โ';
      document.getElementById('u-sub').textContent   = user?.sub   || 'โ';

      const st = (claims && (claims["https://athar.co/status"] || claims["https://athar/status"])) || '';
      document.getElementById('u-status').textContent = st || 'โ';

      const badge = document.getElementById('sub-state');
      if (st) {
        const active = (st === 'active');
        badge.style.display = 'inline-block';
        badge.textContent   = active ? 'ูุดุท' : 'ุบูุฑ ูุดุท';
        badge.style.background = active ? '#dcfce7' : '#fee2e2';
        badge.style.color      = active ? '#166534' : '#991b1b';
        badge.style.borderColor= active ? '#bbf7d0' : '#fecaca';
      }

      // ุฃุฒุฑุงุฑ
      document.getElementById('logout').addEventListener('click', () => {
        client.logout({ logoutParams:{ returnTo: window.location.origin } });
      });
    }

    window.addEventListener('auth0:ready', initProfile);
    if (window.auth0Client) initProfile(); // ูู ุญุงู ูุงู ุฌุงูุฒูุง ุฃุตูุงู
  </script>
  <script src="assets/js/require-auth.js"></script>
</body>
</html>
