<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>مُعين — الخطة الأسبوعية للدرس</title>
    <link rel="icon" type="image/x-icon" href="assets/icons/favicon.ico" />
    <link rel="shortcut icon" href="assets/icons/favicon.ico" />
    <link rel="apple-touch-icon" href="assets/icons/logo.png" />
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
    <meta name="color-scheme" content="dark light" />

    <!-- تطبيق لون الثيم (accent) مثل بقية الصفحات -->
    <script>
      (function () {
        var KEY = "athar:themeColor";

        function hexToRgb(hex) {
          hex = (hex || "").replace("#", "").trim();
          if (hex.length === 3)
            hex = hex
              .split("")
              .map((c) => c + c)
              .join("");
          var num = parseInt(hex, 16);
          if (isNaN(num)) return null;
          return { r: (num >> 16) & 255, g: (num >> 8) & 255, b: num & 255 };
        }

        function applyAccent(hex) {
          if (!hex) return;
          var root = document.documentElement;
          var rgb = hexToRgb(hex);

          var vars = [
            "--accent",
            "--primary",
            "--brand",
            "--brand-500",
            "--brand-600",
            "--sea-400",
            "--sea-500",
            "--sea-600"
          ];
          vars.forEach(function (v) {
            root.style.setProperty(v, hex);
          });

          if (rgb) {
            root.style.setProperty("--accent-r", rgb.r);
            root.style.setProperty("--accent-g", rgb.g);
            root.style.setProperty("--accent-b", rgb.b);
            root.style.setProperty(
              "--accent-20",
              "color-mix(in oklab, " + hex + " 20%, transparent)"
            );
            root.style.setProperty(
              "--accent-12",
              "color-mix(in oklab, " + hex + " 12%, transparent)"
            );
            root.style.setProperty(
              "--accent-08",
              "color-mix(in oklab, " + hex + " 8%, transparent)"
            );
          }
        }

        function getSaved() {
          try {
            var v = localStorage.getItem(KEY);
            if (v && typeof v === "string" && v.trim()) return v.trim();
          } catch (_) {}
          return null;
        }

        applyAccent(getSaved());

        window.addEventListener("athar:theme-color", function (e) {
          applyAccent(e && e.detail);
          try {
            localStorage.setItem(KEY, e.detail || "");
          } catch (_) {}
        });
      })();
    </script>

    <style>
      .muted {
        opacity: 0.85;
      }
      .card-day {
        border: 1px dashed rgba(59, 130, 246, 0.35);
        border-radius: 12px;
        padding: 12px;
        margin: 14px 0;
        background: var(--card);
      }
      .day-head {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        margin: 0 0 6px;
      }
      .chips {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }
      .chip {
        border-radius: 999px;
        padding: 4px 8px;
        background: color-mix(in oklab, var(--accent) 12%, #fff);
        font-size: 0.85rem;
      }
      .actions-row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
      }
      .btn.small {
        padding: 6px 10px;
        font-size: 0.9rem;
      }
      .list {
        margin: 0;
        padding-left: 1.2rem;
      }
      .list li {
        margin: 2px 0;
      }
    </style>
  </head>
  <body>
    <div class="global-bg"></div>

    <!-- شريط علوي موحّد -->
    <div id="navbar" data-component="components/navbar.html"></div>

    <header>
      <div class="hero">
        <h1 class="logo">مُعين</h1>
        <div class="tag">
          <span class="dot"></span>نُعينك على بناء خطة أسبوعية متكاملة لأهداف الدرس.
        </div>
      </div>
    </header>

    <main>
      <div class="container">
        <section class="card">
          <h2 class="title" style="margin-top: 0">مدخلات الخطة الأسبوعية</h2>
          <p class="muted">
            أدخلي بيانات الدرس، ودعي "مُعين" يساعدك في توزيع أهدافه ومفرداته على أيام الأسبوع.
          </p>

          <div class="grid" style="grid-template-columns: 1fr 1fr">
            <div class="field">
              <label>المرحلة/الصف</label>
              <select id="f-grade">
                <option value="أول ابتدائي">أول ابتدائي</option>
                <option value="ثاني ابتدائي">ثاني ابتدائي</option>
                <option value="ثالث ابتدائي">ثالث ابتدائي</option>
                <option value="رابع ابتدائي">رابع ابتدائي</option>
                <option value="خامس ابتدائي">خامس ابتدائي</option>
                <option value="سادس ابتدائي">سادس ابتدائي</option>
                <option value="أول متوسط">أول متوسط</option>
                <option value="ثاني متوسط">ثاني متوسط</option>
                <option value="ثالث متوسط">ثالث متوسط</option>
                <option value="أول ثانوي">أول ثانوي</option>
                <option value="ثاني ثانوي">ثاني ثانوي</option>
                <option value="ثالث ثانوي" selected>ثالث ثانوي</option>
              </select>
            </div>

            <div class="field">
              <label>المادة</label>
              <input id="f-subject" placeholder="مثلًا: فيزياء / رياضيات / لغة عربية" />
            </div>

            <div class="field">
              <label>اسم الدرس</label>
              <input id="f-lesson" placeholder="مثلًا: قانون حفظ الطاقة" />
            </div>

            <div class="field">
              <label>عدد حصص/أيام الدرس هذا الأسبوع</label>
              <select id="f-count">
                <option value="1">حصّة واحدة</option>
                <option value="2" selected>حصتان</option>
                <option value="3">ثلاث حصص</option>
                <option value="4">أربع حصص</option>
                <option value="5">خمس حصص</option>
              </select>
            </div>
          </div>

          <div class="actions-row" style="margin-top: 10px">
            <button id="btn-generate" class="btn primary">ولّدي الخطة</button>
            <button id="btn-copy-all" class="btn" disabled>نسخ الخطة كاملة</button>
            <button id="btn-print" class="btn" disabled>طباعة</button>
            <span id="status" class="muted"></span>
          </div>
        </section>

        <section class="card" id="out" style="display: none">
          <h2 class="title">خطة الأسبوع</h2>
          <div id="meta" class="chips" style="margin-bottom: 6px"></div>
          <div id="canon-box" class="card" style="margin: 10px 0; padding: 10px;">
            <h3 style="margin: 0 0 6px;">أهداف الدرس الأساسية ومفرداته</h3>
            <h4 style="margin: 4px 0;">الأهداف الرئيسة</h4>
            <ul id="canon-goals" class="list"></ul>
            <h4 style="margin: 8px 0 4px;">المفردات الجديدة</h4>
            <ul id="canon-vocab" class="list"></ul>
          </div>
          <div id="plan"></div>
        </section>
      </div>
    </main>

    <div id="footer" data-component="components/footer.html"></div>

    <div class="toast" id="toast"></div>

    <!-- SDKs / سكربتات مشتركة -->
    <script
      defer
      src="https://cdn.auth0.com/js/auth0-spa-js/2.1/auth0-spa-js.production.js"
      onerror="this.onerror=null;this.src='/assets/vendor/auth0-spa-js.production.js'"
    ></script>
    <script defer src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script defer src="assets/js/supabase-client.js"></script>
    <script defer src="assets/js/require-auth.js"></script>
    <script defer src="app.js"></script>

    <script src="assets/js/component-loader.js"></script>
    <script src="assets/js/navbar.js"></script>

    <!-- مُعين -->
    <script src="assets/js/mueen.js"></script>
  </body>
</html>
